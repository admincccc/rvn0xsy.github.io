<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta content="倾旋的博客" property="og:site_name">

  <meta content="一个暂时没有名字的项目" property="og:title">


  <meta content="article" property="og:type">


  <meta content="一个暂时没有名字的项目" property="og:description">


  <meta content="http://localhost:4000/archivers/2017-10-23/1" property="og:url">


  <meta content="2017-10-23T00:00:00+08:00" property="article:published_time">
  <meta content="http://localhost:4000/about/" property="article:author">


  <meta property="og:image" content="">


  
  <meta content="C++/C" property="article:section">
  


  

  <title>一个暂时没有名字的项目</title>
  <meta name="description" content="一个暂时没有名字的项目">
<script src="http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/static/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  
  <link href='http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/static/ptsans.css' rel='stylesheet' type='text/css'>
  <link href='http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/static/firamono.css' rel='stylesheet' type='text/css'>
  <link href='http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/static/lato.css' rel='stylesheet' type='text/css'>
  <link href='http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/static/sourcecodepro.css' rel='stylesheet' type='text/css'>
  <link href='http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/static/gentiumbasic.css' rel='stylesheet' type='text/css'>
  <link href='http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/static/alegreya.css' rel='stylesheet' type='text/css'>
  <link href='http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/static/lora.css' rel='stylesheet' type='text/css'>
  <link href='http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/static/firasans400.css' rel='stylesheet' type='text/css'>
  <script src="http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/static/jquery.min2.2.0.js"></script>
  <link href='http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/static/opensans.css' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-hQpvDQiCJaD2H465dQfA717v7lu5qHWtDbWNPvaTJ0ID5xnPUlVXnKzq7b8YUkbN" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/archivers/2017-10-23/1">
  <link rel="alternate" type="application/rss+xml" title="倾旋的博客" href="http://localhost:4000/feed.xml">
</head>


  <body>

<section>
<nav class="navbar navbar-default navbar-fixed-top">

  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">倾旋的博客</a>
    </div>


    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        
        
        <li><a href="/about/">关于我</a></li>

        

        
        
        <li><a href="/category/">文章分类</a></li>

        

        
        

        
        

        
        

        
        
        <li><a href="/other/">其他信息</a></li>

        

        


      </ul>

    <!--  <ul class="nav navbar-nav navbar-right">
        <li><a href="#">Know More!</a></li>

      </ul>-->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
</section>

<section>
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="jumbotron">
    <div class="container">
      <h1 class="post-title-main" itemprop="name headline">一个暂时没有名字的项目</h1>
      <p class="post-meta"><time datetime="2017-10-23T00:00:00+08:00" itemprop="datePublished">Oct 23, 2017</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">倾旋</span></span>
      
      <div class="bdsharebuttonbox" style="background-color: white;width: 27%;border-radius: 10px;padding-left: 10px; "><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a><a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_evernotecn" data-cmd="evernotecn" title="分享到印象笔记"></a><a href="#" class="bds_youdao" data-cmd="youdao" title="分享到有道云笔记"></a><a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a><a href="#" class="bds_copy" data-cmd="copy" title="分享到复制网址"></a><a href="#" class="bds_print" data-cmd="print" title="分享到打印"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","qzone","tsina","bdysc","weixin","sqq","youdao","mail","fbook","twi","linkedin","h163","evernotecn","copy","print"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
      </p>
      
    </div>

</div>


  <div class="post-content container" itemprop="articleBody">
    <p>一个暂时没有名字的项目
<!--more--></p>
<h2 id="0x00-简介">0x00 简介</h2>

<p>
<video src="http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/video/psql.mp4" controls="controls" width="500px">
哎呀~ 换个浏览器试试吧！
</video>
</p>

<h2 id="0x02-编译环境---linux-平台">0x02 编译环境 - Linux 平台</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/jtv/libpqxx.git <span class="c"># clone软件包</span>
apt-get <span class="nb">install </span>pkg-config
apt-get <span class="nb">install </span>make <span class="c"># 安装make</span>
apt-get <span class="nb">install </span>g++ <span class="c"># 安装g++编译器</span>
apt-get <span class="nb">install </span>libpq-dev
<span class="nb">cd </span>libpqxx
./configure
make
make <span class="nb">install</span>
</code></pre></div></div>

<p>libpqxx 是用来给其他C/C++程序提供连接、操作postgresql的库。</p>

<p>目录结构：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>├── CMakeLists.txt
├── Command.cpp
├── Command.h
├── Postgres.cpp
├── Postgres.h
├── cmake-build-debug
├── main.cpp
├── psql
└── psql.dSYM
</code></pre></div></div>

<h2 id="0x03-编译">0x03 编译</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>g++ main.cpp Postgres.cpp Command.cpp <span class="nt">-o</span> psql <span class="nt">-lpqxx</span> <span class="nt">-lpq</span> <span class="nt">-lpthread</span> <span class="nt">-std</span><span class="o">=</span>c++11 <span class="nt">-g</span>
</code></pre></div></div>

<h2 id="0x04-使用">0x04 使用</h2>

<p>使用方法已经在视频中了，后来我在慢慢完善数据库结构</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>liyingzhes-MBP:psql liyingzhe<span class="nv">$ </span>./psql
Connected Success <span class="o">!</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span>Console <span class="o">&gt;</span>list
<span class="o">[</span>-]Please input list <span class="o">[</span>&lt;Target&gt;&lt;Request&gt;&lt;Detection&gt;&lt;Techniques&gt;&lt;Injection&gt;&lt;Optimization&gt;&lt;Fingerprint&gt;&lt;Enumeration&gt;]
<span class="o">[</span><span class="k">*</span><span class="o">]</span>Console <span class="o">&gt;</span>list Target
opt_name    	           opt_value   	           explain     	           
direct      	                       	           Direct connection to the database.	           
logFile     	                       	           Parse targets from Burp or WebScarab logs	           
bulkFile    	                       	           Scan multiple targets enlisted <span class="k">in </span>a given textual file	           
requestFile 	                       	           Load HTTP request from a fil           
googleDork  	                       	           Rather than providing a target URL, <span class="nb">let </span>Google <span class="k">return </span>target	           
sitemapUrl  	                       	           Parse target<span class="o">(</span>s<span class="o">)</span> from remote sitemap<span class="o">(</span>.xml<span class="o">)</span> file.	           
url         	           http://127.0.0.1:8081/vulnerabilities/test.php?id<span class="o">=</span>2	           Target URL. 	           
<span class="nt">----------</span>
Rows : 7
<span class="o">[</span><span class="k">*</span><span class="o">]</span>Console <span class="o">&gt;</span>
</code></pre></div></div>

<p>list 中的每一个可选项对应一个数据表，用来保存我们设置的值。</p>

<p>该程序只要执行 exploit/run 即可进行攻击</p>

<h2 id="0x05-展望">0x05 展望</h2>

<p>由于Metasploit采用的数据库就是postgresql，笔者只研究了一段时间，然后用Python写了一个快速搜索msf模块的脚本，发现对于效率提升了很多，另外不需要开启msfconsole，它的加载速度太慢了。</p>

<p>程序中有很多东西都写死了，完全可以加到数据库的配置中，这样会更加灵活</p>

<p># 勿喷，要脸 —— 倾旋</p>

<p>只要花时间研究数据库结构，我想是可以集成更多的工具。 将它部署在Kali这种平台下，减少工作量，提高渗透效率。</p>

<p>附：数据库是个好东西</p>

<h2 id="0x06-忠告">0x06 忠告</h2>

<p>这个项目我只是突发奇想，锻炼自己的C++功底，创造自己所想的，程序中可能会出现SQL注入之类的问题，别跟我扯什么高大上的安全问题，我做我想做的，不会在意被人怎么看。</p>

<h2 id="0x07-源代码">0x07 源代码</h2>

<blockquote>
  <p>main.cpp</p>
</blockquote>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;iostream&gt;
#include &lt;pqxx/pqxx&gt;
#include &lt;iomanip&gt;
#include "Postgres.h"
#include &lt;vector&gt;
#include "Command.h"
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="n">Postgres</span> <span class="n">postSqler</span><span class="p">;</span>
    <span class="n">CommandHelper</span> <span class="o">*</span> <span class="n">Command</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CommandHelper</span><span class="p">;</span>
    <span class="c1">// std::string listOpt[] = {"Target","Request"};</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">listOpt</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Target"</span><span class="p">,</span><span class="s">"Request"</span><span class="p">,</span><span class="s">"Detection"</span><span class="p">,</span><span class="s">"Techniques"</span><span class="p">,</span><span class="s">"Injection"</span><span class="p">,</span><span class="s">"Optimization"</span><span class="p">,</span><span class="s">"Fingerprint"</span><span class="p">,</span><span class="s">"Enumeration"</span><span class="p">};</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">sqlmap</span> <span class="o">=</span> <span class="s">"sqlmap -c "</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">filename</span> <span class="o">=</span> <span class="s">"/Users/liyingzhe/Downloads/a.txt"</span><span class="p">;</span>
    <span class="k">try</span><span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">globalCommand</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">"sql"</span><span class="p">,</span><span class="s">"list"</span><span class="p">,</span><span class="s">"set"</span><span class="p">,</span><span class="s">"exploit"</span><span class="p">,</span><span class="s">"run"</span><span class="p">,</span><span class="s">"show"</span><span class="p">,</span><span class="s">"info"</span><span class="p">,</span><span class="s">"help"</span><span class="p">};</span>
        <span class="n">pqxx</span><span class="o">::</span><span class="n">connection</span> <span class="n">Link</span><span class="p">(</span><span class="s">"dbname=testdb user=liyingzhe password=kali1997 hostaddr=127.0.0.1 port=5432"</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Link</span><span class="p">.</span><span class="n">is_open</span><span class="p">()){</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Connected Success !"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">char</span>  <span class="n">line</span><span class="p">[</span><span class="mi">300</span><span class="p">];</span>
        <span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">){</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"[*]Console &gt;"</span><span class="p">;</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">getline</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="mi">299</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="c1">//std::cout &lt;&lt; "length : "  &lt;&lt; strlen(line) &lt;&lt; std::endl;</span>
            <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">Commandlines</span> <span class="o">=</span> <span class="n">Command</span><span class="o">-&gt;</span><span class="n">getCommandStr</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
            <span class="c1">//std::cout &lt;&lt; "length : "  &lt;&lt; strlen(line) &lt;&lt; std::endl;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">Commandlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">"sql"</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="n">Command</span><span class="o">-&gt;</span><span class="n">Sql</span><span class="p">(</span><span class="n">Commandlines</span><span class="p">,</span><span class="n">postSqler</span><span class="p">,</span><span class="n">Link</span><span class="p">)){</span>
                    <span class="k">continue</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"[-]sql &lt;SQL Query&gt;"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">Commandlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">"list"</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="n">Commandlines</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">||</span> <span class="o">!</span><span class="n">Command</span><span class="o">-&gt;</span><span class="n">findVectorSet</span><span class="p">(</span><span class="n">listOpt</span><span class="p">,</span><span class="n">Commandlines</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">listOpt</span><span class="p">))){</span>
                    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"[-]Please input list ["</span><span class="p">;</span>
                    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">p</span> <span class="o">&lt;</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">listOpt</span><span class="p">)</span><span class="o">/</span><span class="k">sizeof</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">));</span><span class="n">p</span><span class="o">++</span><span class="p">){</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"&lt;"</span> <span class="o">&lt;&lt;</span> <span class="n">listOpt</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">"&gt;"</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"]"</span> <span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                    <span class="k">continue</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"SELECT opt_name,opt_value,explain FROM "</span> <span class="o">+</span> <span class="n">Commandlines</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
                <span class="n">Command</span><span class="o">-&gt;</span><span class="n">Exec</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span><span class="n">postSqler</span><span class="p">,</span><span class="n">Link</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">Commandlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">"exit"</span><span class="p">){</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">Commandlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">"set"</span><span class="p">){</span>
                <span class="n">Command</span><span class="o">-&gt;</span><span class="n">SetVal</span><span class="p">(</span><span class="n">Commandlines</span><span class="p">,</span><span class="n">postSqler</span><span class="p">,</span><span class="n">Link</span><span class="p">);</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">Commandlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">"info"</span><span class="p">){</span>
                <span class="k">if</span><span class="p">(</span><span class="n">Commandlines</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="o">||</span> <span class="o">!</span><span class="n">Command</span><span class="o">-&gt;</span><span class="n">findVectorSet</span><span class="p">(</span><span class="n">listOpt</span><span class="p">,</span><span class="n">Commandlines</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">listOpt</span><span class="p">))){</span>
                    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"[-]Please input info ["</span><span class="p">;</span>
                    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">p</span> <span class="o">&lt;</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">listOpt</span><span class="p">)</span><span class="o">/</span><span class="k">sizeof</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">));</span><span class="n">p</span><span class="o">++</span><span class="p">){</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"&lt;"</span> <span class="o">&lt;&lt;</span> <span class="n">listOpt</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">"&gt;"</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"] &lt;opt_name&gt;"</span> <span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                    <span class="k">continue</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"SELECT * FROM "</span> <span class="o">+</span> <span class="n">Commandlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">" WHERE opt_name = '"</span> <span class="o">+</span> <span class="n">Commandlines</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s">"'"</span><span class="p">;</span>
                <span class="c1">// std::cout &lt;&lt; sql &lt;&lt;std::endl;</span>
                <span class="n">Command</span><span class="o">-&gt;</span><span class="n">Exec</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span><span class="n">postSqler</span><span class="p">,</span><span class="n">Link</span><span class="p">);</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">Commandlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">"save"</span><span class="p">){</span>

                <span class="n">Command</span><span class="o">-&gt;</span><span class="n">Save</span><span class="p">(</span><span class="n">listOpt</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">listOpt</span><span class="p">)</span><span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">),</span><span class="n">postSqler</span><span class="p">,</span><span class="n">Link</span><span class="p">,</span><span class="n">filename</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">Commandlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">"unset"</span><span class="p">){</span>
                <span class="n">Command</span><span class="o">-&gt;</span><span class="n">UnSetVal</span><span class="p">(</span><span class="n">Commandlines</span><span class="p">,</span><span class="n">postSqler</span><span class="p">,</span><span class="n">Link</span><span class="p">);</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">Commandlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">"exploit"</span> <span class="o">||</span> <span class="n">Commandlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">"run"</span><span class="p">){</span>
                <span class="n">Command</span><span class="o">-&gt;</span><span class="n">Save</span><span class="p">(</span><span class="n">listOpt</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">listOpt</span><span class="p">)</span><span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">),</span><span class="n">postSqler</span><span class="p">,</span><span class="n">Link</span><span class="p">,</span><span class="n">filename</span><span class="p">);</span>
                <span class="n">Command</span><span class="o">-&gt;</span><span class="n">Exploit</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">sqlmap</span><span class="p">);</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">Commandlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">"help"</span><span class="p">){</span>
                <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Usage :"</span>
                          <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span>
                          <span class="o">&lt;&lt;</span><span class="s">"list &lt;table name&gt;"</span><span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span>
                          <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s"> 查看局部配置项"</span>
                          <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span>
                          <span class="o">&lt;&lt;</span><span class="s">"set  &lt;table name&gt; &lt;opt_name&gt; &lt;opt_value&gt;"</span>
                          <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s"> 设置配置项"</span>
                          <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span>
                          <span class="o">&lt;&lt;</span> <span class="s">"info &lt;table name&gt; &lt;opt_name&gt;"</span>
                          <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s"> 查看单独配置项"</span>
                          <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span>
                          <span class="o">&lt;&lt;</span> <span class="s">"exploit"</span>
                          <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s"> 运行"</span>
                          <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">exception</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">){</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">delete</span> <span class="n">Command</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>Command.h</p>
</blockquote>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">//</span>
<span class="c1">// Created by liyingzhe on 20/10/17.</span>
<span class="c1">//</span>
<span class="cp">#include &lt;vector&gt;
#include &lt;iostream&gt;
#include &lt;string&gt;
#ifndef PSQL_COMMAND_H
#include "Postgres.h"
#define PSQL_COMMAND_H
#include &lt;pqxx/pqxx&gt;
</span><span class="k">class</span> <span class="nc">CommandHelper</span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="c1">//CommandHelper();</span>
    <span class="c1">//~CommandHelper();</span>
    <span class="cm">/**
     * 获取命令
     * @param line   命令行
     * @param cutStr 分割字符
     * @return
     */</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">getCommandStr</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span> <span class="n">line</span><span class="p">);</span>
    <span class="cm">/**
     * 判断元素是否存在vector
     * @param VecArray
     * @param strArr
     * @return
     */</span>
    <span class="kt">bool</span> <span class="n">findVectorSet</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">strArr</span><span class="p">[],</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Str</span><span class="p">,</span><span class="kt">int</span> <span class="n">strArrSize</span><span class="p">);</span>

    <span class="cm">/**
     * SQL命令：执行SQL语句
     * @param CommandArray
     * @param postSqler
     * @param Link
     * @return
     */</span>
    <span class="kt">bool</span> <span class="n">Sql</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">CommandArray</span><span class="p">,</span><span class="n">Postgres</span> <span class="n">postSqler</span><span class="p">,</span><span class="n">pqxx</span><span class="o">::</span><span class="n">connection</span> <span class="o">&amp;</span><span class="n">Link</span><span class="p">);</span>

    <span class="cm">/**
     * 执行SQL 且输出结果
     * @param sql
     * @param postSqler
     * @param Link
     * @return
     */</span>
    <span class="kt">bool</span> <span class="n">Exec</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">sql</span><span class="p">,</span><span class="n">Postgres</span> <span class="n">postSqler</span><span class="p">,</span><span class="n">pqxx</span><span class="o">::</span><span class="n">connection</span> <span class="o">&amp;</span><span class="n">Link</span><span class="p">);</span>

    <span class="cm">/**
     * 更改属性值
     * @param Commandline
     * @param postgres
     * @param Link
     * @return
     */</span>
    <span class="kt">bool</span> <span class="n">SetVal</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">Commandline</span><span class="p">,</span><span class="n">Postgres</span> <span class="n">postgres</span><span class="p">,</span><span class="n">pqxx</span><span class="o">::</span><span class="n">connection</span> <span class="o">&amp;</span><span class="n">Link</span><span class="p">);</span>

    <span class="cm">/**
     * 保存配置
     * @param tableList
     * @param tableLength
     * @param postgres
     * @param Link
     * @param filename
     * @return
     */</span>
    <span class="kt">bool</span> <span class="n">Save</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">tableList</span><span class="p">[],</span><span class="kt">int</span> <span class="n">tableLength</span><span class="p">,</span><span class="n">Postgres</span> <span class="n">postgres</span><span class="p">,</span><span class="n">pqxx</span><span class="o">::</span><span class="n">connection</span> <span class="o">&amp;</span><span class="n">Link</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">filename</span><span class="p">);</span>
    <span class="cm">/**
     * 清空属性
     * @param Commandline
     * @param postgres
     * @param Link
     * @return
     */</span>
    <span class="kt">bool</span> <span class="n">UnSetVal</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">Commandline</span><span class="p">,</span><span class="n">Postgres</span> <span class="n">postgres</span><span class="p">,</span><span class="n">pqxx</span><span class="o">::</span><span class="n">connection</span> <span class="o">&amp;</span><span class="n">Link</span><span class="p">);</span>

    <span class="cm">/**
     * 执行
     * @param filename
     * @param command
     * @return
     */</span>
    <span class="kt">bool</span> <span class="n">Exploit</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">filename</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">command</span><span class="p">);</span>
<span class="p">};</span>
<span class="cp">#endif //PSQL_COMMAND_H
</span>
</code></pre></div></div>

<blockquote>
  <p>Command.cpp</p>
</blockquote>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//</span>
<span class="c1">// Created by liyingzhe on 20/10/17.</span>
<span class="c1">//</span>

<span class="cp">#include "Command.h"
#include &lt;pqxx/pqxx&gt;
#include "Postgres.h"
#include &lt;fstream&gt;
#include &lt;stdio.h&gt;
</span><span class="kt">bool</span> <span class="n">CommandHelper</span><span class="o">::</span><span class="n">findVectorSet</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">strArr</span><span class="p">[],</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Str</span><span class="p">,</span><span class="kt">int</span> <span class="n">strArrSize</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">strArrSize</span> <span class="p">;</span> <span class="n">x</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">strArr</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="n">Str</span><span class="p">){</span>
            <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">CommandHelper</span><span class="o">::</span><span class="n">getCommandStr</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">line</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">CommandResult</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span> <span class="n">token</span> <span class="o">=</span> <span class="n">strtok</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s">" "</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="n">token</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">){</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">x</span> <span class="o">=</span> <span class="n">token</span><span class="p">;</span>
        <span class="n">CommandResult</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">strtok</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="s">" "</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">CommandResult</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">bool</span> <span class="n">CommandHelper</span><span class="o">::</span><span class="n">Sql</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">CommandArray</span><span class="p">,</span> <span class="n">Postgres</span> <span class="n">postSqler</span><span class="p">,</span> <span class="n">pqxx</span><span class="o">::</span><span class="n">connection</span> <span class="o">&amp;</span><span class="n">Link</span><span class="p">){</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">sqlQuery</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">x</span><span class="o">&lt;</span><span class="n">CommandArray</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="n">x</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span> <span class="k">continue</span><span class="p">;}</span>
        <span class="n">sqlQuery</span> <span class="o">+=</span> <span class="n">CommandArray</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="s">" "</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">CommandHelper</span><span class="o">::</span><span class="n">Exec</span><span class="p">(</span><span class="n">sqlQuery</span><span class="p">,</span><span class="n">postSqler</span><span class="p">,</span><span class="n">Link</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">CommandHelper</span><span class="o">::</span><span class="n">Exec</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">sql</span><span class="p">,</span> <span class="n">Postgres</span> <span class="n">postSqler</span><span class="p">,</span> <span class="n">pqxx</span><span class="o">::</span><span class="n">connection</span> <span class="o">&amp;</span><span class="n">Link</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span><span class="p">{</span>
        <span class="n">pqxx</span><span class="o">::</span><span class="n">result</span> <span class="n">res</span> <span class="o">=</span> <span class="n">postSqler</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">sql</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="n">Link</span><span class="p">);</span>
        <span class="n">postSqler</span><span class="p">.</span><span class="n">Print</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
    <span class="p">}</span><span class="k">catch</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">exception</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">CommandHelper</span><span class="o">::</span><span class="n">SetVal</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">Commandlines</span><span class="p">,</span> <span class="n">Postgres</span> <span class="n">postgres</span><span class="p">,</span> <span class="n">pqxx</span><span class="o">::</span><span class="n">connection</span> <span class="o">&amp;</span><span class="n">Link</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">Commandlines</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">){</span>
        <span class="c1">// set target url value</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"[-]set &lt;table name&gt; &lt;opt_name&gt; &lt;opt_value&gt;"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"UPDATE "</span> <span class="o">+</span> <span class="n">Commandlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">" SET opt_value = '"</span> <span class="o">+</span> <span class="n">Commandlines</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s">"' where opt_name = '"</span> <span class="o">+</span> <span class="n">Commandlines</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span><span class="s">"'"</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">CommandHelper</span><span class="o">::</span><span class="n">Exec</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span><span class="n">postgres</span><span class="p">,</span><span class="n">Link</span><span class="p">)){</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">CommandHelper</span><span class="o">::</span><span class="n">Save</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">tableList</span><span class="p">[],</span><span class="kt">int</span> <span class="n">tableLength</span><span class="p">,</span><span class="n">Postgres</span> <span class="n">postgres</span><span class="p">,</span><span class="n">pqxx</span><span class="o">::</span><span class="n">connection</span> <span class="o">&amp;</span><span class="n">Link</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">filename</span><span class="p">){</span>
    <span class="k">try</span><span class="p">{</span>
        <span class="c1">// std::ofstream</span>
        <span class="n">std</span><span class="o">::</span><span class="n">ofstream</span> <span class="n">Out</span><span class="p">(</span><span class="n">filename</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">Out</span><span class="p">.</span><span class="n">is_open</span><span class="p">()){</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"[-]Error Opened file ..."</span> <span class="o">&lt;&lt;</span> <span class="n">filename</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">tableLength</span> <span class="o">&amp;&amp;</span> <span class="n">Out</span><span class="p">.</span><span class="n">is_open</span><span class="p">();</span> <span class="n">y</span><span class="o">++</span><span class="p">){</span>
            <span class="n">Out</span> <span class="o">&lt;&lt;</span> <span class="s">"["</span> <span class="o">+</span> <span class="n">tableList</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span><span class="s">"]"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"SELECT opt_name,opt_value FROM "</span> <span class="o">+</span> <span class="n">tableList</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span><span class="s">" WHERE State = true"</span><span class="p">;</span>
            <span class="n">pqxx</span><span class="o">::</span><span class="n">result</span> <span class="n">res</span> <span class="o">=</span> <span class="n">postgres</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">sql</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="n">Link</span><span class="p">);</span>
            <span class="k">for</span><span class="p">(</span><span class="n">pqxx</span><span class="o">::</span><span class="n">result</span><span class="o">::</span><span class="n">const_iterator</span> <span class="n">c</span> <span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">res</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">Out</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">c_str</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" = "</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">c_str</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">Out</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span><span class="k">catch</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">exception</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">){</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kt">bool</span> <span class="n">CommandHelper</span><span class="o">::</span><span class="n">UnSetVal</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">Commandlines</span><span class="p">,</span> <span class="n">Postgres</span> <span class="n">postgres</span><span class="p">,</span> <span class="n">pqxx</span><span class="o">::</span><span class="n">connection</span> <span class="o">&amp;</span><span class="n">Link</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">Commandlines</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">){</span>
        <span class="c1">// set target url value</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"[-]unset &lt;table name&gt; &lt;opt_name&gt;"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"UPDATE "</span> <span class="o">+</span> <span class="n">Commandlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">" SET opt_value = '' where opt_name = '"</span> <span class="o">+</span> <span class="n">Commandlines</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span><span class="s">"'"</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">CommandHelper</span><span class="o">::</span><span class="n">Exec</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span><span class="n">postgres</span><span class="p">,</span><span class="n">Link</span><span class="p">)){</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">bool</span> <span class="n">CommandHelper</span><span class="o">::</span><span class="n">Exploit</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">filename</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">command</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">command</span> <span class="o">+=</span>  <span class="n">filename</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">line</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
    <span class="kt">FILE</span> <span class="o">*</span> <span class="n">FP</span> <span class="o">=</span> <span class="n">popen</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="s">"r"</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="n">fgets</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">FP</span><span class="p">)){</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">line</span> <span class="p">;</span>
    <span class="p">}</span>
    <span class="n">pclose</span><span class="p">(</span><span class="n">FP</span><span class="p">);</span>
    <span class="k">return</span>  <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<blockquote>
  <p>Postgres.h</p>
</blockquote>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;pqxx/pqxx&gt;
#include &lt;iostream&gt;
#include &lt;iomanip&gt;
#include &lt;pqxx/result&gt;
#ifndef PSQL_POSTGRES_H
#define PSQL_POSTGRES_H
</span><span class="k">class</span> <span class="nc">Postgres</span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="c1">// 初始化方法</span>
    <span class="c1">//void Connect(const char * connection_string,pqxx::connection &amp;C);</span>
    <span class="cm">/**
     * 查询并返回结果
     * @param sql 
     * @param C 
     * @return 
     */</span>
    <span class="n">pqxx</span><span class="o">::</span><span class="n">result</span> <span class="n">Select</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">sql</span><span class="p">,</span><span class="n">pqxx</span><span class="o">::</span><span class="n">connection</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">);</span>
    <span class="cm">/**
     * 执行插入操作
     * @param sql 
     * @param C 
     * @return 
     */</span>
    <span class="n">pqxx</span><span class="o">::</span><span class="n">result</span> <span class="n">Insert</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">sql</span><span class="p">,</span><span class="n">pqxx</span><span class="o">::</span><span class="n">connection</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">);</span>
    <span class="cm">/**
     * 打印查询结果
     * @param res 
     */</span>
    <span class="kt">void</span> <span class="n">Print</span><span class="p">(</span><span class="n">pqxx</span><span class="o">::</span><span class="n">result</span> <span class="n">res</span><span class="p">);</span>
    <span class="c1">//~Postgres(pqxx::connection C);</span>
<span class="p">};</span>
<span class="cp">#endif //PSQL_POSTGRES_H
</span></code></pre></div></div>

<blockquote>
  <p>Postgres.cpp</p>
</blockquote>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;pqxx/pqxx&gt;
#include &lt;iostream&gt;
#include "Postgres.h"
#include &lt;iomanip&gt;
#include &lt;pqxx/result&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">pqxx</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="c1">//    void Postgres::Connect(const char *connection_string,pqxx::connection &amp;C){</span>
<span class="c1">//      try{</span>
<span class="c1">//</span>
<span class="c1">//          C.(connection_string);</span>
<span class="c1">//          if(C.is_open()) {</span>
<span class="c1">//              std::cout &lt;&lt;"[*]Connection success "&lt;&lt; std::endl;</span>
<span class="c1">//          }</span>
<span class="c1">//      }catch (std::exception &amp;e){</span>
<span class="c1">//          std::cerr &lt;&lt; e.what() &lt;&lt; endl;</span>
<span class="c1">//          exit(-1);</span>
<span class="c1">//      }</span>
<span class="c1">//  }</span>
<span class="n">pqxx</span><span class="o">::</span><span class="n">result</span> <span class="n">Postgres</span><span class="o">::</span><span class="n">Insert</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">sql</span><span class="p">,</span><span class="n">pqxx</span><span class="o">::</span><span class="n">connection</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">){</span>
    <span class="n">pqxx</span><span class="o">::</span><span class="n">work</span> <span class="n">W</span><span class="p">(</span><span class="n">C</span><span class="p">);</span>
    <span class="n">pqxx</span><span class="o">::</span><span class="n">result</span> <span class="n">res</span> <span class="o">=</span> <span class="n">W</span><span class="p">.</span><span class="n">exec</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span>
    <span class="n">W</span><span class="p">.</span><span class="n">commit</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>



    <span class="n">pqxx</span><span class="o">::</span><span class="n">result</span> <span class="n">Postgres</span><span class="o">::</span><span class="n">Select</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">sql</span><span class="p">,</span><span class="n">pqxx</span><span class="o">::</span><span class="n">connection</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">){</span>
        <span class="n">pqxx</span><span class="o">::</span><span class="n">work</span> <span class="n">W</span><span class="p">(</span><span class="n">C</span><span class="p">);</span>
        <span class="n">pqxx</span><span class="o">::</span><span class="n">result</span> <span class="n">res</span> <span class="o">=</span> <span class="n">W</span><span class="p">.</span><span class="n">exec</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span>
        <span class="n">W</span><span class="p">.</span><span class="n">commit</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">Postgres</span><span class="o">::</span><span class="n">Print</span><span class="p">(</span><span class="n">pqxx</span><span class="o">::</span><span class="n">result</span> <span class="n">res</span><span class="p">){</span>
        <span class="c1">// std::cout &lt;&lt; "columns number :" &lt;&lt; res.columns() &lt;&lt; std::endl; // 字段数目</span>
        <span class="c1">// res.column_name() 字段名称</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">a</span><span class="o">&lt;</span><span class="n">res</span><span class="p">.</span><span class="n">columns</span><span class="p">();</span><span class="n">a</span><span class="o">++</span><span class="p">){</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">left</span><span class="p">;</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">setw</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
                      <span class="o">&lt;&lt;</span> <span class="n">res</span><span class="p">.</span><span class="n">column_name</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                      <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">setw</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="c1">//std::cout &lt;&lt; "ROW :"&lt;&lt;res.affected_rows() &lt;&lt; std::endl;</span>
        <span class="c1">//std::cout &lt;&lt; "id column_table :"&lt;&lt;res.column_table("id") &lt;&lt; std::endl;</span>
        <span class="c1">//std::cout &lt;&lt; "table_column :"&lt;&lt;res.table_column(1) &lt;&lt; std::endl;</span>
        <span class="k">for</span><span class="p">(</span><span class="n">pqxx</span><span class="o">::</span><span class="n">result</span><span class="o">::</span><span class="n">const_iterator</span> <span class="n">c</span> <span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">res</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//std::cout &lt;&lt; left;</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">res</span><span class="p">.</span><span class="n">columns</span><span class="p">();</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
                 <span class="n">std</span><span class="o">::</span><span class="n">cout</span>
                 <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">left</span>
                 <span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">setw</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
                 <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">c_str</span><span class="p">()</span>
                <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">setw</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

        <span class="p">}</span>
        <span class="n">string</span> <span class="n">s</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="sc">'-'</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Rows : "</span>  <span class="o">&lt;&lt;</span> <span class="n">res</span><span class="p">.</span><span class="n">affected_rows</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>数据库结构就先不共享了，看得懂的都应该知道、</p>



<div class="pull-right">
  <script type="text/javascript">
    function smoothscroll(){
    var currentScroll = document.documentElement.scrollTop || document.body.scrollTop;
    if (currentScroll > 0) {
         window.requestAnimationFrame(smoothscroll);
         window.scrollTo (0,currentScroll - (currentScroll/5));
    }
};
  </script>
<button class="btn btn-primary" onclick="smoothscroll()">回到顶部</button>
</div>
<br>


    <h3>本文许可协议</h3>

    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
    	<img alt="知识共享许可协议" style="border-width:0;height: 30px;width: 80px;" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">知识共享署名 4.0 国际许可协议</a>进行许可。
  </div>

</article>

</section>
<!-- 
<nav class="navbar navbar-default navbar-fixed-bottom">
  <div class="container footer-content">
    Jekyll Theme by Hemang Kumar/Powered By Jekyll/Site owner is 倾旋
  </div>
</nav>
-->
  </body>

</html>
